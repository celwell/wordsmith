["^ ","~:resource-id",["~:shadow.build.npm/resource","node_modules/konva/lib/Node.js"],"~:js","shadow$provide.module$node_modules$konva$lib$Node=function(global,require,module,exports){Object.defineProperty(exports,\"__esModule\",{value:!0});var Util_1=require(\"module$node_modules$konva$lib$Util\");global=require(\"module$node_modules$konva$lib$Factory\");var Canvas_1=require(\"module$node_modules$konva$lib$Canvas\"),Global_1=require(\"module$node_modules$konva$lib$Global\"),DragAndDrop_1=require(\"module$node_modules$konva$lib$DragAndDrop\");require=require(\"module$node_modules$konva$lib$Validators\");\nexports.ids={};exports.names={};exports._removeId=function(id,node){id&&exports.ids[id]===node&&delete exports.ids[id]};exports._addName=function(node,name){name&&(exports.names[name]||(exports.names[name]=[]),exports.names[name].push(node))};exports._removeName=function(name,_id){if(name){var nodes=exports.names[name];if(nodes){for(var n=0;n<nodes.length;n++)nodes[n]._id===_id&&nodes.splice(n,1);0===nodes.length&&delete exports.names[name]}}};var CLONE_BLACK_LIST=[\"id\"],emptyChildren=new Util_1.Collection,\nidCounter=1;module=function(){function Node(config){var _this=this;this._id=idCounter++;this.eventListeners={};this.attrs={};this.index=0;this.parent=null;this._cache=new Map;this._lastPos=null;this._isUnderCache=this._filterUpToDate=!1;this.children=emptyChildren;this._dragEventId=null;this.setAttrs(config);this.on(\"xChange.konva yChange.konva scaleXChange.konva scaleYChange.konva skewXChange.konva skewYChange.konva rotationChange.konva offsetXChange.konva offsetYChange.konva transformsEnabledChange.konva\",\nfunction(){_this._clearCache(\"transform\");_this._clearSelfAndDescendantCache(\"absoluteTransform\")});this.on(\"scaleXChange.konva scaleYChange.konva\",function(){_this._clearSelfAndDescendantCache(\"absoluteScale\")});this.on(\"visibleChange.konva\",function(){_this._clearSelfAndDescendantCache(\"visible\")});this.on(\"listeningChange.konva\",function(){_this._clearSelfAndDescendantCache(\"listening\")});this.on(\"opacityChange.konva\",function(){_this._clearSelfAndDescendantCache(\"absoluteOpacity\")})}Node.prototype.hasChildren=\nfunction(){return!1};Node.prototype.getChildren=function(){return emptyChildren};Node.prototype._clearCache=function(attr){attr?this._cache.delete(attr):this._cache.clear()};Node.prototype._getCache=function(attr,privateGetter){var cache=this._cache.get(attr);void 0===cache&&(cache=privateGetter.call(this),this._cache.set(attr,cache));return cache};Node.prototype._getCanvasCache=function(){return this._cache.get(\"canvas\")};Node.prototype._clearSelfAndDescendantCache=function(attr){this._clearCache(attr);\nthis._getCanvasCache()||this.children&&this.children.each(function(node){node._clearSelfAndDescendantCache(attr)})};Node.prototype.clearCache=function(){this._cache.delete(\"canvas\");this._clearSelfAndDescendantCache();return this};Node.prototype.cache=function(config){config=config||{};var rect={};if(void 0===config.x||void 0===config.y||void 0===config.width||void 0===config.height)rect=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()});var width=config.width||rect.width,height=config.height||\nrect.height,pixelRatio=config.pixelRatio,x=void 0===config.x?rect.x:config.x;rect=void 0===config.y?rect.y:config.y;var offset=config.offset||0,drawBorder=config.drawBorder||!1;if(width&&height){width+=2*offset;height+=2*offset;x-=offset;rect-=offset;offset=new Canvas_1.SceneCanvas({pixelRatio:pixelRatio,width:width,height:height});pixelRatio=new Canvas_1.SceneCanvas({pixelRatio:pixelRatio,width:width,height:height});var cachedHitCanvas=new Canvas_1.HitCanvas({pixelRatio:1,width:width,height:height}),\nsceneContext=offset.getContext(),hitContext=cachedHitCanvas.getContext();cachedHitCanvas.isCache=!0;this._cache.delete(\"canvas\");this._filterUpToDate=!1;!1===config.imageSmoothingEnabled&&(offset.getContext()._context.imageSmoothingEnabled=!1,pixelRatio.getContext()._context.imageSmoothingEnabled=!1,cachedHitCanvas.getContext()._context.imageSmoothingEnabled=!1);sceneContext.save();hitContext.save();sceneContext.translate(-x,-rect);hitContext.translate(-x,-rect);this._isUnderCache=!0;this._clearSelfAndDescendantCache(\"absoluteOpacity\");\nthis._clearSelfAndDescendantCache(\"absoluteScale\");this.drawScene(offset,this,!0);this.drawHit(cachedHitCanvas,this,!0);this._isUnderCache=!1;sceneContext.restore();hitContext.restore();drawBorder&&(sceneContext.save(),sceneContext.beginPath(),sceneContext.rect(0,0,width,height),sceneContext.closePath(),sceneContext.setAttr(\"strokeStyle\",\"red\"),sceneContext.setAttr(\"lineWidth\",5),sceneContext.stroke(),sceneContext.restore());this._cache.set(\"canvas\",{scene:offset,filter:pixelRatio,hit:cachedHitCanvas,\nx:x,y:rect});return this}Util_1.Util.error(\"Can not cache the node. Width or height of the node equals 0. Caching is skipped.\")};Node.prototype.isCached=function(){return this._cache.has(\"canvas\")};Node.prototype.getClientRect=function(config){throw Error('abstract \"getClientRect\" method call');};Node.prototype._transformedRect=function(rect,top){rect=[{x:rect.x,y:rect.y},{x:rect.x+rect.width,y:rect.y},{x:rect.x+rect.width,y:rect.y+rect.height},{x:rect.x,y:rect.y+rect.height}];var minX,minY,maxX,\nmaxY,trans=this.getAbsoluteTransform(top);rect.forEach(function(point){point=trans.point(point);void 0===minX&&(minX=maxX=point.x,minY=maxY=point.y);minX=Math.min(minX,point.x);minY=Math.min(minY,point.y);maxX=Math.max(maxX,point.x);maxY=Math.max(maxY,point.y)});return{x:minX,y:minY,width:maxX-minX,height:maxY-minY}};Node.prototype._drawCachedSceneCanvas=function(context){context.save();context._applyOpacity(this);context._applyGlobalCompositeOperation(this);var canvasCache=this._getCanvasCache();\ncontext.translate(canvasCache.x,canvasCache.y);canvasCache=this._getCachedSceneCanvas();var ratio=canvasCache.pixelRatio;context.drawImage(canvasCache._canvas,0,0,canvasCache.width/ratio,canvasCache.height/ratio);context.restore()};Node.prototype._drawCachedHitCanvas=function(context){var canvasCache=this._getCanvasCache(),hitCanvas=canvasCache.hit;context.save();context._applyGlobalCompositeOperation(this);context.translate(canvasCache.x,canvasCache.y);context.drawImage(hitCanvas._canvas,0,0);context.restore()};\nNode.prototype._getCachedSceneCanvas=function(){var filters=this.filters(),cachedCanvas=this._getCanvasCache(),sceneCanvas=cachedCanvas.scene;cachedCanvas=cachedCanvas.filter;var filterContext=cachedCanvas.getContext(),n;if(filters){if(!this._filterUpToDate){var ratio=sceneCanvas.pixelRatio;try{var len=filters.length;filterContext.clear();filterContext.drawImage(sceneCanvas._canvas,0,0,sceneCanvas.getWidth()/ratio,sceneCanvas.getHeight()/ratio);var imageData=filterContext.getImageData(0,0,cachedCanvas.getWidth(),\ncachedCanvas.getHeight());for(n=0;n<len;n++){var filter=filters[n];\"function\"!==typeof filter?Util_1.Util.error(\"Filter should be type of function, but got \"+typeof filter+\" insted. Please check correct filters\"):(filter.call(this,imageData),filterContext.putImageData(imageData,0,0))}}catch(e){Util_1.Util.error(\"Unable to apply filter. \"+e.message)}this._filterUpToDate=!0}return cachedCanvas}return sceneCanvas};Node.prototype.on=function(evtStr,handler){if(3===arguments.length)return this._delegate.apply(this,\narguments);var events=evtStr.split(\" \"),len=events.length,n;for(n=0;n<len;n++){var event=events[n];var parts=event.split(\".\");event=parts[0];parts=parts[1]||\"\";this.eventListeners[event]||(this.eventListeners[event]=[]);this.eventListeners[event].push({name:parts,handler:handler})}return this};Node.prototype.off=function(evtStr,callback){var events=(evtStr||\"\").split(\" \"),len=events.length,t;if(!evtStr)for(t in this.eventListeners)this._off(t);for(evtStr=0;evtStr<len;evtStr++){var event=events[evtStr];\nvar parts=event.split(\".\");event=parts[0];parts=parts[1];if(event)this.eventListeners[event]&&this._off(event,parts,callback);else for(t in this.eventListeners)this._off(t,parts,callback)}return this};Node.prototype.dispatchEvent=function(evt){this.fire(evt.type,{target:this,type:evt.type,evt:evt});return this};Node.prototype.addEventListener=function(type,handler){this.on(type,function(evt){handler.call(this,evt.evt)});return this};Node.prototype.removeEventListener=function(type){this.off(type);\nreturn this};Node.prototype._delegate=function(event,selector,handler){var stopNode=this;this.on(event,function(evt){for(var targets=evt.target.findAncestors(selector,!0,stopNode),i=0;i<targets.length;i++)evt=Util_1.Util.cloneObject(evt),evt.currentTarget=targets[i],handler.call(targets[i],evt)})};Node.prototype.remove=function(){this.isDragging()&&this.stopDrag();DragAndDrop_1.DD._dragElements.delete(this._id);this._remove();return this};Node.prototype._remove=function(){this._clearSelfAndDescendantCache(\"stage\");\nthis._clearSelfAndDescendantCache(\"absoluteTransform\");this._clearSelfAndDescendantCache(\"visible\");this._clearSelfAndDescendantCache(\"listening\");this._clearSelfAndDescendantCache(\"absoluteOpacity\");var parent=this.getParent();parent&&parent.children&&(parent.children.splice(this.index,1),parent._setChildrenIndices(),this.parent=null)};Node.prototype.destroy=function(){exports._removeId(this.id(),this);for(var names=(this.name()||\"\").split(/\\s/g),i=0;i<names.length;i++)exports._removeName(names[i],\nthis._id);this.remove();return this};Node.prototype.getAttr=function(attr){var method=\"get\"+Util_1.Util._capitalize(attr);return Util_1.Util._isFunction(this[method])?this[method]():this.attrs[attr]};Node.prototype.getAncestors=function(){for(var parent=this.getParent(),ancestors=new Util_1.Collection;parent;)ancestors.push(parent),parent=parent.getParent();return ancestors};Node.prototype.getAttrs=function(){return this.attrs||{}};Node.prototype.setAttrs=function(config){var key;if(!config)return this;\nfor(key in config)if(\"children\"!==key){var method=\"set\"+Util_1.Util._capitalize(key);if(Util_1.Util._isFunction(this[method]))this[method](config[key]);else this._setAttr(key,config[key])}return this};Node.prototype.isListening=function(){return this._getCache(\"listening\",this._isListening)};Node.prototype._isListening=function(){var listening=this.listening(),parent=this.getParent();return\"inherit\"===listening?parent?parent.isListening():!0:listening};Node.prototype.isVisible=function(){return this._getCache(\"visible\",\nthis._isVisible)};Node.prototype._isVisible=function(relativeTo){var visible=this.visible(),parent=this.getParent();return\"inherit\"===visible?parent&&parent!==relativeTo?parent._isVisible(relativeTo):!0:visible};Node.prototype.shouldDrawHit=function(){var layer=this.getLayer();return!layer&&this.isListening()&&this.isVisible()||layer&&layer.hitGraphEnabled()&&this.isListening()&&this.isVisible()};Node.prototype.show=function(){this.visible(!0);return this};Node.prototype.hide=function(){this.visible(!1);\nreturn this};Node.prototype.getZIndex=function(){return this.index||0};Node.prototype.getAbsoluteZIndex=function(){function addChildren(children){nodes=[];len=children.length;for(n=0;n<len;n++)child=children[n],index++,\"Shape\"!==child.nodeType&&(nodes=nodes.concat(child.getChildren().toArray())),child._id===that._id&&(n=len);0<nodes.length&&nodes[0].getDepth()<=depth&&addChildren(nodes)}var depth=this.getDepth(),that=this,index=0,nodes,len,n,child;\"Stage\"!==that.nodeType&&addChildren(that.getStage().getChildren());\nreturn index};Node.prototype.getDepth=function(){for(var depth=0,parent=this.parent;parent;)depth++,parent=parent.parent;return depth};Node.prototype.setPosition=function(pos){this.x(pos.x);this.y(pos.y);return this};Node.prototype.getPosition=function(){return{x:this.x(),y:this.y()}};Node.prototype.getAbsolutePosition=function(top){top=this.getAbsoluteTransform(top).getMatrix();var absoluteTransform=new Util_1.Transform,offset=this.offset();absoluteTransform.m=top.slice();absoluteTransform.translate(offset.x,\noffset.y);return absoluteTransform.getTranslation()};Node.prototype.setAbsolutePosition=function(pos){var origTrans=this._clearTransform();this.attrs.x=origTrans.x;this.attrs.y=origTrans.y;delete origTrans.x;delete origTrans.y;var it=this.getAbsoluteTransform();it.invert();it.translate(pos.x,pos.y);pos={x:this.attrs.x+it.getTranslation().x,y:this.attrs.y+it.getTranslation().y};this.setPosition({x:pos.x,y:pos.y});this._setTransform(origTrans);return this};Node.prototype._setTransform=function(trans){for(var key in trans)this.attrs[key]=\ntrans[key];this._clearCache(\"transform\");this._clearSelfAndDescendantCache(\"absoluteTransform\")};Node.prototype._clearTransform=function(){var trans={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};this.attrs.x=0;this.attrs.y=0;this.attrs.rotation=0;this.attrs.scaleX=1;this.attrs.scaleY=1;this.attrs.offsetX=0;this.attrs.offsetY=0;this.attrs.skewX=0;this.attrs.skewY=0;this._clearCache(\"transform\");\nthis._clearSelfAndDescendantCache(\"absoluteTransform\");return trans};Node.prototype.move=function(change){var changeX=change.x;change=change.y;var x=this.x(),y=this.y();void 0!==changeX&&(x+=changeX);void 0!==change&&(y+=change);this.setPosition({x:x,y:y});return this};Node.prototype._eachAncestorReverse=function(func,top){var family=[],parent=this.getParent();if(top&&top._id===this._id)func(this);else{for(family.unshift(this);parent&&(!top||parent._id!==top._id);)family.unshift(parent),parent=parent.parent;\ntop=family.length;for(parent=0;parent<top;parent++)func(family[parent])}};Node.prototype.rotate=function(theta){this.rotation(this.rotation()+theta);return this};Node.prototype.moveToTop=function(){if(!this.parent)return Util_1.Util.warn(\"Node has no parent. moveToTop function is ignored.\"),!1;this.parent.children.splice(this.index,1);this.parent.children.push(this);this.parent._setChildrenIndices();return!0};Node.prototype.moveUp=function(){if(!this.parent)return Util_1.Util.warn(\"Node has no parent. moveUp function is ignored.\"),\n!1;var index=this.index,len=this.parent.getChildren().length;return index<len-1?(this.parent.children.splice(index,1),this.parent.children.splice(index+1,0,this),this.parent._setChildrenIndices(),!0):!1};Node.prototype.moveDown=function(){if(!this.parent)return Util_1.Util.warn(\"Node has no parent. moveDown function is ignored.\"),!1;var index=this.index;return 0<index?(this.parent.children.splice(index,1),this.parent.children.splice(index-1,0,this),this.parent._setChildrenIndices(),!0):!1};Node.prototype.moveToBottom=\nfunction(){if(!this.parent)return Util_1.Util.warn(\"Node has no parent. moveToBottom function is ignored.\"),!1;var index=this.index;return 0<index?(this.parent.children.splice(index,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1};Node.prototype.setZIndex=function(zIndex){if(!this.parent)return Util_1.Util.warn(\"Node has no parent. zIndex parameter is ignored.\"),this;(0>zIndex||zIndex>=this.parent.children.length)&&Util_1.Util.warn(\"Unexpected value \"+zIndex+\" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to \"+\n(this.parent.children.length-1)+\".\");this.parent.children.splice(this.index,1);this.parent.children.splice(zIndex,0,this);this.parent._setChildrenIndices();return this};Node.prototype.getAbsoluteOpacity=function(){return this._getCache(\"absoluteOpacity\",this._getAbsoluteOpacity)};Node.prototype._getAbsoluteOpacity=function(){var absOpacity=this.opacity(),parent=this.getParent();parent&&!parent._isUnderCache&&(absOpacity*=parent.getAbsoluteOpacity());return absOpacity};Node.prototype.moveTo=function(newContainer){this.getParent()!==\nnewContainer&&(this._remove(),newContainer.add(this));return this};Node.prototype.toObject=function(){var obj={},attrs=this.getAttrs(),key;obj.attrs={};for(key in attrs){var val=attrs[key];var getter=Util_1.Util.isObject(val)&&!Util_1.Util._isPlainObject(val)&&!Util_1.Util._isArray(val);getter||(getter=\"function\"===typeof this[key]&&this[key],delete attrs[key],getter=getter?getter.call(this):null,attrs[key]=val,getter!==val&&(obj.attrs[key]=val))}obj.className=this.getClassName();return Util_1.Util._prepareToStringify(obj)};\nNode.prototype.toJSON=function(){return JSON.stringify(this.toObject())};Node.prototype.getParent=function(){return this.parent};Node.prototype.findAncestors=function(selector,includeSelf,stopNode){var res=[];includeSelf&&this._isMatch(selector)&&res.push(this);for(includeSelf=this.parent;includeSelf&&includeSelf!==stopNode;)includeSelf._isMatch(selector)&&res.push(includeSelf),includeSelf=includeSelf.parent;return res};Node.prototype.isAncestorOf=function(node){return!1};Node.prototype.findAncestor=\nfunction(selector,includeSelf,stopNode){return this.findAncestors(selector,includeSelf,stopNode)[0]};Node.prototype._isMatch=function(selector){if(!selector)return!1;if(\"function\"===typeof selector)return selector(this);selector=selector.replace(/ /g,\"\").split(\",\");var len=selector.length,n;for(n=0;n<len;n++){var sel=selector[n];Util_1.Util.isValidSelector(sel)||(Util_1.Util.warn('Selector \"'+sel+'\" is invalid. Allowed selectors examples are \"#foo\", \".bar\" or \"Group\".'),Util_1.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like \"Triangle\".'),\nUtil_1.Util.warn(\"Konva is awesome, right?\"));if(\"#\"===sel.charAt(0)){if(this.id()===sel.slice(1))return!0}else if(\".\"===sel.charAt(0)){if(this.hasName(sel.slice(1)))return!0}else if(this.className===sel||this.nodeType===sel)return!0}return!1};Node.prototype.getLayer=function(){var parent=this.getParent();return parent?parent.getLayer():null};Node.prototype.getStage=function(){return this._getCache(\"stage\",this._getStage)};Node.prototype._getStage=function(){var parent=this.getParent();if(parent)return parent.getStage()};\nNode.prototype.fire=function(eventType,evt,bubble){evt=evt||{};evt.target=evt.target||this;bubble?this._fireAndBubble(eventType,evt):this._fire(eventType,evt);return this};Node.prototype.getAbsoluteTransform=function(top){return top?this._getAbsoluteTransform(top):this._getCache(\"absoluteTransform\",this._getAbsoluteTransform)};Node.prototype._getAbsoluteTransform=function(top){var at=new Util_1.Transform;this._eachAncestorReverse(function(node){var transformsEnabled=node.getTransformsEnabled();\"all\"===\ntransformsEnabled?at.multiply(node.getTransform()):\"position\"===transformsEnabled&&at.translate(node.getX()-node.getOffsetX(),node.getY()-node.getOffsetY())},top);return at};Node.prototype.getAbsoluteScale=function(top){return top?this._getAbsoluteScale(top):this._getCache(\"absoluteScale\",this._getAbsoluteScale)};Node.prototype._getAbsoluteScale=function(top){for(var parent=this;parent;)parent._isUnderCache&&(top=parent),parent=parent.getParent();var scaleX=1,scaleY=1;this._eachAncestorReverse(function(node){scaleX*=\nnode.scaleX();scaleY*=node.scaleY()},top);return{x:scaleX,y:scaleY}};Node.prototype.getTransform=function(){return this._getCache(\"transform\",this._getTransform)};Node.prototype._getTransform=function(){var m=new Util_1.Transform,x=this.x(),y=this.y(),rotation=Global_1.Konva.getAngle(this.rotation()),scaleX=this.scaleX(),scaleY=this.scaleY(),skewX=this.skewX(),skewY=this.skewY(),offsetX=this.offsetX(),offsetY=this.offsetY();0===x&&0===y||m.translate(x,y);0!==rotation&&m.rotate(rotation);0===skewX&&\n0===skewY||m.skew(skewX,skewY);1===scaleX&&1===scaleY||m.scale(scaleX,scaleY);0===offsetX&&0===offsetY||m.translate(-1*offsetX,-1*offsetY);return m};Node.prototype.clone=function(obj){var attrs=Util_1.Util.cloneObject(this.attrs),key,n;for(n in CLONE_BLACK_LIST)delete attrs[CLONE_BLACK_LIST[n]];for(key in obj)attrs[key]=obj[key];var node=new this.constructor(attrs);for(key in this.eventListeners)for(obj=this.eventListeners[key],attrs=obj.length,n=0;n<attrs;n++){var listener=obj[n];0>listener.name.indexOf(\"konva\")&&\n(node.eventListeners[key]||(node.eventListeners[key]=[]),node.eventListeners[key].push(listener))}return node};Node.prototype._toKonvaCanvas=function(config){config=config||{};var box=this.getClientRect(),stage=this.getStage(),x=void 0!==config.x?config.x:box.x,y=void 0!==config.y?config.y:box.y,pixelRatio=config.pixelRatio||1;config=new Canvas_1.SceneCanvas({width:config.width||box.width||(stage?stage.width():0),height:config.height||box.height||(stage?stage.height():0),pixelRatio:pixelRatio});box=\nconfig.getContext();box.save();(x||y)&&box.translate(-1*x,-1*y);this.drawScene(config);box.restore();return config};Node.prototype.toCanvas=function(config){return this._toKonvaCanvas(config)._canvas};Node.prototype.toDataURL=function(config){config=config||{};var mimeType=config.mimeType||null,quality=config.quality||null;mimeType=this._toKonvaCanvas(config).toDataURL(mimeType,quality);config.callback&&config.callback(mimeType);return mimeType};Node.prototype.toImage=function(config){if(!config||\n!config.callback)throw\"callback required for toImage method config argument\";var callback=config.callback;delete config.callback;Util_1.Util._urlToImage(this.toDataURL(config),function(img){callback(img)})};Node.prototype.setSize=function(size){this.width(size.width);this.height(size.height);return this};Node.prototype.getSize=function(){return{width:this.width(),height:this.height()}};Node.prototype.getClassName=function(){return this.className||this.nodeType};Node.prototype.getType=function(){return this.nodeType};\nNode.prototype.getDragDistance=function(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Global_1.Konva.dragDistance};Node.prototype._off=function(type,name,callback){var evtListeners=this.eventListeners[type],i;for(i=0;i<evtListeners.length;i++){var evtName=evtListeners[i].name;var handler=evtListeners[i].handler;if(!(\"konva\"===evtName&&\"konva\"!==name||name&&evtName!==name||callback&&callback!==handler)){evtListeners.splice(i,1);if(0===evtListeners.length){delete this.eventListeners[type];\nbreak}i--}}};Node.prototype._fireChangeEvent=function(attr,oldVal,newVal){this._fire(attr+\"Change\",{oldVal:oldVal,newVal:newVal})};Node.prototype.setId=function(id){var oldId=this.id();exports._removeId(oldId,this);id&&(exports.ids[id]=this);this._setAttr(\"id\",id);return this};Node.prototype.setName=function(name){var oldNames=(this.name()||\"\").split(/\\s/g),newNames=(name||\"\").split(/\\s/g),i;for(i=0;i<oldNames.length;i++){var subname=oldNames[i];-1===newNames.indexOf(subname)&&subname&&exports._removeName(subname,\nthis._id)}for(i=0;i<newNames.length;i++)subname=newNames[i],-1===oldNames.indexOf(subname)&&subname&&exports._addName(this,subname);this._setAttr(\"name\",name);return this};Node.prototype.addName=function(name){if(!this.hasName(name)){var oldName=this.name();this.setName(oldName?oldName+\" \"+name:name)}return this};Node.prototype.hasName=function(name){if(!name)return!1;var fullName=this.name();return fullName?-1!==(fullName||\"\").split(/\\s/g).indexOf(name):!1};Node.prototype.removeName=function(name){var names=\n(this.name()||\"\").split(/\\s/g);name=names.indexOf(name);-1!==name&&(names.splice(name,1),this.setName(names.join(\" \")));return this};Node.prototype.setAttr=function(attr,val){var func=this[\"set\"+Util_1.Util._capitalize(attr)];Util_1.Util._isFunction(func)?func.call(this,val):this._setAttr(attr,val);return this};Node.prototype._setAttr=function(key,val){var oldVal=this.attrs[key];if(oldVal!==val||Util_1.Util.isObject(val))void 0===val||null===val?delete this.attrs[key]:this.attrs[key]=val,this._fireChangeEvent(key,\noldVal,val)};Node.prototype._setComponentAttr=function(key,component,val){var oldVal;void 0!==val&&((oldVal=this.attrs[key])||(this.attrs[key]=this.getAttr(key)),this.attrs[key][component]=val,this._fireChangeEvent(key,oldVal,val))};Node.prototype._fireAndBubble=function(eventType,evt,compareShape){evt&&\"Shape\"===this.nodeType&&(evt.target=this);if(\"mouseenter\"!==eventType&&\"mouseleave\"!==eventType||!(compareShape&&(this===compareShape||this.isAncestorOf&&this.isAncestorOf(compareShape))||\"Stage\"===\nthis.nodeType&&!compareShape)){this._fire(eventType,evt);var stopBubble=(\"mouseenter\"===eventType||\"mouseleave\"===eventType)&&compareShape&&compareShape.isAncestorOf&&compareShape.isAncestorOf(this)&&!compareShape.isAncestorOf(this.parent);(evt&&!evt.cancelBubble||!evt)&&this.parent&&this.parent.isListening()&&!stopBubble&&(compareShape&&compareShape.parent?this._fireAndBubble.call(this.parent,eventType,evt,compareShape.parent):this._fireAndBubble.call(this.parent,eventType,evt))}};Node.prototype._fire=\nfunction(eventType,evt){var events=this.eventListeners[eventType];if(events)for(evt=evt||{},evt.currentTarget=this,evt.type=eventType,eventType=0;eventType<events.length;eventType++)events[eventType].handler.call(this,evt)};Node.prototype.draw=function(){this.drawScene();this.drawHit();return this};Node.prototype._createDragElement=function(evt){evt=evt?evt.pointerId:void 0;var stage=this.getStage(),ap=this.getAbsolutePosition();stage=stage._getPointerById(evt)||stage._changedPointerPositions[0]||\nap;DragAndDrop_1.DD._dragElements.set(this._id,{node:this,startPointerPos:stage,offset:{x:stage.x-ap.x,y:stage.y-ap.y},dragStatus:\"ready\",pointerId:evt})};Node.prototype.startDrag=function(evt){DragAndDrop_1.DD._dragElements.has(this._id)||this._createDragElement(evt);DragAndDrop_1.DD._dragElements.get(this._id).dragStatus=\"dragging\";this.fire(\"dragstart\",{type:\"dragstart\",target:this,evt:evt&&evt.evt},!0)};Node.prototype._setDragPosition=function(evt,elem){var pos=this.getStage()._getPointerById(elem.pointerId),\ndbf=this.dragBoundFunc();pos&&(elem={x:pos.x-elem.offset.x,y:pos.y-elem.offset.y},void 0!==dbf&&(elem=dbf.call(this,elem,evt)),this._lastPos&&this._lastPos.x===elem.x&&this._lastPos.y===elem.y||(this.setAbsolutePosition(elem),this.getLayer()?this.getLayer().batchDraw():this.getStage()&&this.getStage().batchDraw()),this._lastPos=elem)};Node.prototype.stopDrag=function(evt){var elem=DragAndDrop_1.DD._dragElements.get(this._id);elem&&(elem.dragStatus=\"stopped\");DragAndDrop_1.DD._endDragBefore(evt);DragAndDrop_1.DD._endDragAfter(evt)};\nNode.prototype.setDraggable=function(draggable){this._setAttr(\"draggable\",draggable);this._dragChange()};Node.prototype.isDragging=function(){var elem=DragAndDrop_1.DD._dragElements.get(this._id);return elem?\"dragging\"===elem.dragStatus:!1};Node.prototype._listenDrag=function(){this._dragCleanup();this.on(\"mousedown.konva touchstart.konva\",function(evt){var _this=this;if((void 0===evt.evt.button||0<=Global_1.Konva.dragButtons.indexOf(evt.evt.button))&&!this.isDragging()){var hasDraggingChild=!1;DragAndDrop_1.DD._dragElements.forEach(function(elem){_this.isAncestorOf(elem.node)&&\n(hasDraggingChild=!0)});hasDraggingChild||this._createDragElement(evt)}})};Node.prototype._dragChange=function(){this.attrs.draggable?this._listenDrag():(this._dragCleanup(),this.getStage()&&DragAndDrop_1.DD._dragElements.has(this._id)&&this.stopDrag())};Node.prototype._dragCleanup=function(){this.off(\"mousedown.konva\");this.off(\"touchstart.konva\")};Node.create=function(data,container){Util_1.Util._isString(data)&&(data=JSON.parse(data));return this._createNode(data,container)};Node._createNode=function(obj,\ncontainer){var className=Node.prototype.getClassName.call(obj),children=obj.children;container&&(obj.attrs.container=container);Global_1._NODES_REGISTRY[className]||(Util_1.Util.warn('Can not find a node with class name \"'+className+'\". Fallback to \"Shape\".'),className=\"Shape\");obj=new Global_1._NODES_REGISTRY[className](obj.attrs);if(children)for(container=children.length,className=0;className<container;className++)obj.add(Node._createNode(children[className]));return obj};return Node}();exports.Node=\nmodule;module.prototype.nodeType=\"Node\";module.prototype._attrsAffectingSize=[];global.Factory.addGetterSetter(module,\"zIndex\");global.Factory.addGetterSetter(module,\"absolutePosition\");global.Factory.addGetterSetter(module,\"position\");global.Factory.addGetterSetter(module,\"x\",0,require.getNumberValidator());global.Factory.addGetterSetter(module,\"y\",0,require.getNumberValidator());global.Factory.addGetterSetter(module,\"globalCompositeOperation\",\"source-over\",require.getStringValidator());global.Factory.addGetterSetter(module,\n\"opacity\",1,require.getNumberValidator());global.Factory.addGetterSetter(module,\"name\",\"\",require.getStringValidator());global.Factory.addGetterSetter(module,\"id\",\"\",require.getStringValidator());global.Factory.addGetterSetter(module,\"rotation\",0,require.getNumberValidator());global.Factory.addComponentsGetterSetter(module,\"scale\",[\"x\",\"y\"]);global.Factory.addGetterSetter(module,\"scaleX\",1,require.getNumberValidator());global.Factory.addGetterSetter(module,\"scaleY\",1,require.getNumberValidator());\nglobal.Factory.addComponentsGetterSetter(module,\"skew\",[\"x\",\"y\"]);global.Factory.addGetterSetter(module,\"skewX\",0,require.getNumberValidator());global.Factory.addGetterSetter(module,\"skewY\",0,require.getNumberValidator());global.Factory.addComponentsGetterSetter(module,\"offset\",[\"x\",\"y\"]);global.Factory.addGetterSetter(module,\"offsetX\",0,require.getNumberValidator());global.Factory.addGetterSetter(module,\"offsetY\",0,require.getNumberValidator());global.Factory.addGetterSetter(module,\"dragDistance\",\nnull,require.getNumberValidator());global.Factory.addGetterSetter(module,\"width\",0,require.getNumberValidator());global.Factory.addGetterSetter(module,\"height\",0,require.getNumberValidator());global.Factory.addGetterSetter(module,\"listening\",\"inherit\",function(val){!0!==val&&!1!==val&&\"inherit\"!==val&&Util_1.Util.warn(val+' is a not valid value for \"listening\" attribute. The value may be true, false or \"inherit\".');return val});global.Factory.addGetterSetter(module,\"preventDefault\",!0,require.getBooleanValidator());\nglobal.Factory.addGetterSetter(module,\"filters\",null,function(val){this._filterUpToDate=!1;return val});global.Factory.addGetterSetter(module,\"visible\",\"inherit\",function(val){!0!==val&&!1!==val&&\"inherit\"!==val&&Util_1.Util.warn(val+' is a not valid value for \"visible\" attribute. The value may be true, false or \"inherit\".');return val});global.Factory.addGetterSetter(module,\"transformsEnabled\",\"all\",require.getStringValidator());global.Factory.addGetterSetter(module,\"size\");global.Factory.addGetterSetter(module,\n\"dragBoundFunc\");global.Factory.addGetterSetter(module,\"draggable\",!1,require.getBooleanValidator());global.Factory.backCompat(module,{rotateDeg:\"rotate\",setRotationDeg:\"setRotation\",getRotationDeg:\"getRotation\"});Util_1.Collection.mapMethods(module)}","~:source","shadow$provide[\"module$node_modules$konva$lib$Node\"] = function(global,require,module,exports) {\n\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"./Util\");\nvar Factory_1 = require(\"./Factory\");\nvar Canvas_1 = require(\"./Canvas\");\nvar Global_1 = require(\"./Global\");\nvar DragAndDrop_1 = require(\"./DragAndDrop\");\nvar Validators_1 = require(\"./Validators\");\nexports.ids = {};\nexports.names = {};\nvar _addId = function (node, id) {\n    if (!id) {\n        return;\n    }\n    exports.ids[id] = node;\n};\nexports._removeId = function (id, node) {\n    if (!id) {\n        return;\n    }\n    if (exports.ids[id] !== node) {\n        return;\n    }\n    delete exports.ids[id];\n};\nexports._addName = function (node, name) {\n    if (name) {\n        if (!exports.names[name]) {\n            exports.names[name] = [];\n        }\n        exports.names[name].push(node);\n    }\n};\nexports._removeName = function (name, _id) {\n    if (!name) {\n        return;\n    }\n    var nodes = exports.names[name];\n    if (!nodes) {\n        return;\n    }\n    for (var n = 0; n < nodes.length; n++) {\n        var no = nodes[n];\n        if (no._id === _id) {\n            nodes.splice(n, 1);\n        }\n    }\n    if (nodes.length === 0) {\n        delete exports.names[name];\n    }\n};\nvar ABSOLUTE_OPACITY = 'absoluteOpacity', ABSOLUTE_TRANSFORM = 'absoluteTransform', ABSOLUTE_SCALE = 'absoluteScale', CANVAS = 'canvas', CHANGE = 'Change', CHILDREN = 'children', KONVA = 'konva', LISTENING = 'listening', MOUSEENTER = 'mouseenter', MOUSELEAVE = 'mouseleave', NAME = 'name', SET = 'set', SHAPE = 'Shape', SPACE = ' ', STAGE = 'stage', TRANSFORM = 'transform', UPPER_STAGE = 'Stage', VISIBLE = 'visible', CLONE_BLACK_LIST = ['id'], TRANSFORM_CHANGE_STR = [\n    'xChange.konva',\n    'yChange.konva',\n    'scaleXChange.konva',\n    'scaleYChange.konva',\n    'skewXChange.konva',\n    'skewYChange.konva',\n    'rotationChange.konva',\n    'offsetXChange.konva',\n    'offsetYChange.konva',\n    'transformsEnabledChange.konva'\n].join(SPACE), SCALE_CHANGE_STR = ['scaleXChange.konva', 'scaleYChange.konva'].join(SPACE);\nvar emptyChildren = new Util_1.Collection();\nvar idCounter = 1;\nvar Node = (function () {\n    function Node(config) {\n        var _this = this;\n        this._id = idCounter++;\n        this.eventListeners = {};\n        this.attrs = {};\n        this.index = 0;\n        this.parent = null;\n        this._cache = new Map();\n        this._lastPos = null;\n        this._filterUpToDate = false;\n        this._isUnderCache = false;\n        this.children = emptyChildren;\n        this._dragEventId = null;\n        this.setAttrs(config);\n        this.on(TRANSFORM_CHANGE_STR, function () {\n            _this._clearCache(TRANSFORM);\n            _this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n        });\n        this.on(SCALE_CHANGE_STR, function () {\n            _this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n        });\n        this.on('visibleChange.konva', function () {\n            _this._clearSelfAndDescendantCache(VISIBLE);\n        });\n        this.on('listeningChange.konva', function () {\n            _this._clearSelfAndDescendantCache(LISTENING);\n        });\n        this.on('opacityChange.konva', function () {\n            _this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n        });\n    }\n    Node.prototype.hasChildren = function () {\n        return false;\n    };\n    Node.prototype.getChildren = function () {\n        return emptyChildren;\n    };\n    Node.prototype._clearCache = function (attr) {\n        if (attr) {\n            this._cache.delete(attr);\n        }\n        else {\n            this._cache.clear();\n        }\n    };\n    Node.prototype._getCache = function (attr, privateGetter) {\n        var cache = this._cache.get(attr);\n        if (cache === undefined) {\n            cache = privateGetter.call(this);\n            this._cache.set(attr, cache);\n        }\n        return cache;\n    };\n    Node.prototype._getCanvasCache = function () {\n        return this._cache.get(CANVAS);\n    };\n    Node.prototype._clearSelfAndDescendantCache = function (attr) {\n        this._clearCache(attr);\n        if (this._getCanvasCache()) {\n            return;\n        }\n        if (this.children) {\n            this.children.each(function (node) {\n                node._clearSelfAndDescendantCache(attr);\n            });\n        }\n    };\n    Node.prototype.clearCache = function () {\n        this._cache.delete(CANVAS);\n        this._clearSelfAndDescendantCache();\n        return this;\n    };\n    Node.prototype.cache = function (config) {\n        var conf = config || {};\n        var rect = {};\n        if (conf.x === undefined ||\n            conf.y === undefined ||\n            conf.width === undefined ||\n            conf.height === undefined) {\n            rect = this.getClientRect({\n                skipTransform: true,\n                relativeTo: this.getParent()\n            });\n        }\n        var width = conf.width || rect.width, height = conf.height || rect.height, pixelRatio = conf.pixelRatio, x = conf.x === undefined ? rect.x : conf.x, y = conf.y === undefined ? rect.y : conf.y, offset = conf.offset || 0, drawBorder = conf.drawBorder || false;\n        if (!width || !height) {\n            Util_1.Util.error('Can not cache the node. Width or height of the node equals 0. Caching is skipped.');\n            return;\n        }\n        width += offset * 2;\n        height += offset * 2;\n        x -= offset;\n        y -= offset;\n        var cachedSceneCanvas = new Canvas_1.SceneCanvas({\n            pixelRatio: pixelRatio,\n            width: width,\n            height: height\n        }), cachedFilterCanvas = new Canvas_1.SceneCanvas({\n            pixelRatio: pixelRatio,\n            width: width,\n            height: height\n        }), cachedHitCanvas = new Canvas_1.HitCanvas({\n            pixelRatio: 1,\n            width: width,\n            height: height\n        }), sceneContext = cachedSceneCanvas.getContext(), hitContext = cachedHitCanvas.getContext();\n        cachedHitCanvas.isCache = true;\n        this._cache.delete('canvas');\n        this._filterUpToDate = false;\n        if (conf.imageSmoothingEnabled === false) {\n            cachedSceneCanvas.getContext()._context.imageSmoothingEnabled = false;\n            cachedFilterCanvas.getContext()._context.imageSmoothingEnabled = false;\n            cachedHitCanvas.getContext()._context.imageSmoothingEnabled = false;\n        }\n        sceneContext.save();\n        hitContext.save();\n        sceneContext.translate(-x, -y);\n        hitContext.translate(-x, -y);\n        this._isUnderCache = true;\n        this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n        this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n        this.drawScene(cachedSceneCanvas, this, true);\n        this.drawHit(cachedHitCanvas, this, true);\n        this._isUnderCache = false;\n        sceneContext.restore();\n        hitContext.restore();\n        if (drawBorder) {\n            sceneContext.save();\n            sceneContext.beginPath();\n            sceneContext.rect(0, 0, width, height);\n            sceneContext.closePath();\n            sceneContext.setAttr('strokeStyle', 'red');\n            sceneContext.setAttr('lineWidth', 5);\n            sceneContext.stroke();\n            sceneContext.restore();\n        }\n        this._cache.set(CANVAS, {\n            scene: cachedSceneCanvas,\n            filter: cachedFilterCanvas,\n            hit: cachedHitCanvas,\n            x: x,\n            y: y\n        });\n        return this;\n    };\n    Node.prototype.isCached = function () {\n        return this._cache.has('canvas');\n    };\n    Node.prototype.getClientRect = function (config) {\n        throw new Error('abstract \"getClientRect\" method call');\n    };\n    Node.prototype._transformedRect = function (rect, top) {\n        var points = [\n            { x: rect.x, y: rect.y },\n            { x: rect.x + rect.width, y: rect.y },\n            { x: rect.x + rect.width, y: rect.y + rect.height },\n            { x: rect.x, y: rect.y + rect.height }\n        ];\n        var minX, minY, maxX, maxY;\n        var trans = this.getAbsoluteTransform(top);\n        points.forEach(function (point) {\n            var transformed = trans.point(point);\n            if (minX === undefined) {\n                minX = maxX = transformed.x;\n                minY = maxY = transformed.y;\n            }\n            minX = Math.min(minX, transformed.x);\n            minY = Math.min(minY, transformed.y);\n            maxX = Math.max(maxX, transformed.x);\n            maxY = Math.max(maxY, transformed.y);\n        });\n        return {\n            x: minX,\n            y: minY,\n            width: maxX - minX,\n            height: maxY - minY\n        };\n    };\n    Node.prototype._drawCachedSceneCanvas = function (context) {\n        context.save();\n        context._applyOpacity(this);\n        context._applyGlobalCompositeOperation(this);\n        var canvasCache = this._getCanvasCache();\n        context.translate(canvasCache.x, canvasCache.y);\n        var cacheCanvas = this._getCachedSceneCanvas();\n        var ratio = cacheCanvas.pixelRatio;\n        context.drawImage(cacheCanvas._canvas, 0, 0, cacheCanvas.width / ratio, cacheCanvas.height / ratio);\n        context.restore();\n    };\n    Node.prototype._drawCachedHitCanvas = function (context) {\n        var canvasCache = this._getCanvasCache(), hitCanvas = canvasCache.hit;\n        context.save();\n        context._applyGlobalCompositeOperation(this);\n        context.translate(canvasCache.x, canvasCache.y);\n        context.drawImage(hitCanvas._canvas, 0, 0);\n        context.restore();\n    };\n    Node.prototype._getCachedSceneCanvas = function () {\n        var filters = this.filters(), cachedCanvas = this._getCanvasCache(), sceneCanvas = cachedCanvas.scene, filterCanvas = cachedCanvas.filter, filterContext = filterCanvas.getContext(), len, imageData, n, filter;\n        if (filters) {\n            if (!this._filterUpToDate) {\n                var ratio = sceneCanvas.pixelRatio;\n                try {\n                    len = filters.length;\n                    filterContext.clear();\n                    filterContext.drawImage(sceneCanvas._canvas, 0, 0, sceneCanvas.getWidth() / ratio, sceneCanvas.getHeight() / ratio);\n                    imageData = filterContext.getImageData(0, 0, filterCanvas.getWidth(), filterCanvas.getHeight());\n                    for (n = 0; n < len; n++) {\n                        filter = filters[n];\n                        if (typeof filter !== 'function') {\n                            Util_1.Util.error('Filter should be type of function, but got ' +\n                                typeof filter +\n                                ' insted. Please check correct filters');\n                            continue;\n                        }\n                        filter.call(this, imageData);\n                        filterContext.putImageData(imageData, 0, 0);\n                    }\n                }\n                catch (e) {\n                    Util_1.Util.error('Unable to apply filter. ' + e.message);\n                }\n                this._filterUpToDate = true;\n            }\n            return filterCanvas;\n        }\n        return sceneCanvas;\n    };\n    Node.prototype.on = function (evtStr, handler) {\n        if (arguments.length === 3) {\n            return this._delegate.apply(this, arguments);\n        }\n        var events = evtStr.split(SPACE), len = events.length, n, event, parts, baseEvent, name;\n        for (n = 0; n < len; n++) {\n            event = events[n];\n            parts = event.split('.');\n            baseEvent = parts[0];\n            name = parts[1] || '';\n            if (!this.eventListeners[baseEvent]) {\n                this.eventListeners[baseEvent] = [];\n            }\n            this.eventListeners[baseEvent].push({\n                name: name,\n                handler: handler\n            });\n        }\n        return this;\n    };\n    Node.prototype.off = function (evtStr, callback) {\n        var events = (evtStr || '').split(SPACE), len = events.length, n, t, event, parts, baseEvent, name;\n        if (!evtStr) {\n            for (t in this.eventListeners) {\n                this._off(t);\n            }\n        }\n        for (n = 0; n < len; n++) {\n            event = events[n];\n            parts = event.split('.');\n            baseEvent = parts[0];\n            name = parts[1];\n            if (baseEvent) {\n                if (this.eventListeners[baseEvent]) {\n                    this._off(baseEvent, name, callback);\n                }\n            }\n            else {\n                for (t in this.eventListeners) {\n                    this._off(t, name, callback);\n                }\n            }\n        }\n        return this;\n    };\n    Node.prototype.dispatchEvent = function (evt) {\n        var e = {\n            target: this,\n            type: evt.type,\n            evt: evt\n        };\n        this.fire(evt.type, e);\n        return this;\n    };\n    Node.prototype.addEventListener = function (type, handler) {\n        this.on(type, function (evt) {\n            handler.call(this, evt.evt);\n        });\n        return this;\n    };\n    Node.prototype.removeEventListener = function (type) {\n        this.off(type);\n        return this;\n    };\n    Node.prototype._delegate = function (event, selector, handler) {\n        var stopNode = this;\n        this.on(event, function (evt) {\n            var targets = evt.target.findAncestors(selector, true, stopNode);\n            for (var i = 0; i < targets.length; i++) {\n                evt = Util_1.Util.cloneObject(evt);\n                evt.currentTarget = targets[i];\n                handler.call(targets[i], evt);\n            }\n        });\n    };\n    Node.prototype.remove = function () {\n        if (this.isDragging()) {\n            this.stopDrag();\n        }\n        DragAndDrop_1.DD._dragElements.delete(this._id);\n        this._remove();\n        return this;\n    };\n    Node.prototype._remove = function () {\n        this._clearSelfAndDescendantCache(STAGE);\n        this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n        this._clearSelfAndDescendantCache(VISIBLE);\n        this._clearSelfAndDescendantCache(LISTENING);\n        this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n        var parent = this.getParent();\n        if (parent && parent.children) {\n            parent.children.splice(this.index, 1);\n            parent._setChildrenIndices();\n            this.parent = null;\n        }\n    };\n    Node.prototype.destroy = function () {\n        exports._removeId(this.id(), this);\n        var names = (this.name() || '').split(/\\s/g);\n        for (var i = 0; i < names.length; i++) {\n            var subname = names[i];\n            exports._removeName(subname, this._id);\n        }\n        this.remove();\n        return this;\n    };\n    Node.prototype.getAttr = function (attr) {\n        var method = 'get' + Util_1.Util._capitalize(attr);\n        if (Util_1.Util._isFunction(this[method])) {\n            return this[method]();\n        }\n        return this.attrs[attr];\n    };\n    Node.prototype.getAncestors = function () {\n        var parent = this.getParent(), ancestors = new Util_1.Collection();\n        while (parent) {\n            ancestors.push(parent);\n            parent = parent.getParent();\n        }\n        return ancestors;\n    };\n    Node.prototype.getAttrs = function () {\n        return this.attrs || {};\n    };\n    Node.prototype.setAttrs = function (config) {\n        var key, method;\n        if (!config) {\n            return this;\n        }\n        for (key in config) {\n            if (key === CHILDREN) {\n                continue;\n            }\n            method = SET + Util_1.Util._capitalize(key);\n            if (Util_1.Util._isFunction(this[method])) {\n                this[method](config[key]);\n            }\n            else {\n                this._setAttr(key, config[key]);\n            }\n        }\n        return this;\n    };\n    Node.prototype.isListening = function () {\n        return this._getCache(LISTENING, this._isListening);\n    };\n    Node.prototype._isListening = function () {\n        var listening = this.listening(), parent = this.getParent();\n        if (listening === 'inherit') {\n            if (parent) {\n                return parent.isListening();\n            }\n            else {\n                return true;\n            }\n        }\n        else {\n            return listening;\n        }\n    };\n    Node.prototype.isVisible = function () {\n        return this._getCache(VISIBLE, this._isVisible);\n    };\n    Node.prototype._isVisible = function (relativeTo) {\n        var visible = this.visible(), parent = this.getParent();\n        if (visible === 'inherit') {\n            if (parent && parent !== relativeTo) {\n                return parent._isVisible(relativeTo);\n            }\n            else {\n                return true;\n            }\n        }\n        else {\n            return visible;\n        }\n    };\n    Node.prototype.shouldDrawHit = function () {\n        var layer = this.getLayer();\n        return ((!layer && this.isListening() && this.isVisible()) ||\n            (layer &&\n                layer.hitGraphEnabled() &&\n                this.isListening() &&\n                this.isVisible()));\n    };\n    Node.prototype.show = function () {\n        this.visible(true);\n        return this;\n    };\n    Node.prototype.hide = function () {\n        this.visible(false);\n        return this;\n    };\n    Node.prototype.getZIndex = function () {\n        return this.index || 0;\n    };\n    Node.prototype.getAbsoluteZIndex = function () {\n        var depth = this.getDepth(), that = this, index = 0, nodes, len, n, child;\n        function addChildren(children) {\n            nodes = [];\n            len = children.length;\n            for (n = 0; n < len; n++) {\n                child = children[n];\n                index++;\n                if (child.nodeType !== SHAPE) {\n                    nodes = nodes.concat(child.getChildren().toArray());\n                }\n                if (child._id === that._id) {\n                    n = len;\n                }\n            }\n            if (nodes.length > 0 && nodes[0].getDepth() <= depth) {\n                addChildren(nodes);\n            }\n        }\n        if (that.nodeType !== UPPER_STAGE) {\n            addChildren(that.getStage().getChildren());\n        }\n        return index;\n    };\n    Node.prototype.getDepth = function () {\n        var depth = 0, parent = this.parent;\n        while (parent) {\n            depth++;\n            parent = parent.parent;\n        }\n        return depth;\n    };\n    Node.prototype.setPosition = function (pos) {\n        this.x(pos.x);\n        this.y(pos.y);\n        return this;\n    };\n    Node.prototype.getPosition = function () {\n        return {\n            x: this.x(),\n            y: this.y()\n        };\n    };\n    Node.prototype.getAbsolutePosition = function (top) {\n        var absoluteMatrix = this.getAbsoluteTransform(top).getMatrix(), absoluteTransform = new Util_1.Transform(), offset = this.offset();\n        absoluteTransform.m = absoluteMatrix.slice();\n        absoluteTransform.translate(offset.x, offset.y);\n        return absoluteTransform.getTranslation();\n    };\n    Node.prototype.setAbsolutePosition = function (pos) {\n        var origTrans = this._clearTransform(), it;\n        this.attrs.x = origTrans.x;\n        this.attrs.y = origTrans.y;\n        delete origTrans.x;\n        delete origTrans.y;\n        it = this.getAbsoluteTransform();\n        it.invert();\n        it.translate(pos.x, pos.y);\n        pos = {\n            x: this.attrs.x + it.getTranslation().x,\n            y: this.attrs.y + it.getTranslation().y\n        };\n        this.setPosition({ x: pos.x, y: pos.y });\n        this._setTransform(origTrans);\n        return this;\n    };\n    Node.prototype._setTransform = function (trans) {\n        var key;\n        for (key in trans) {\n            this.attrs[key] = trans[key];\n        }\n        this._clearCache(TRANSFORM);\n        this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n    };\n    Node.prototype._clearTransform = function () {\n        var trans = {\n            x: this.x(),\n            y: this.y(),\n            rotation: this.rotation(),\n            scaleX: this.scaleX(),\n            scaleY: this.scaleY(),\n            offsetX: this.offsetX(),\n            offsetY: this.offsetY(),\n            skewX: this.skewX(),\n            skewY: this.skewY()\n        };\n        this.attrs.x = 0;\n        this.attrs.y = 0;\n        this.attrs.rotation = 0;\n        this.attrs.scaleX = 1;\n        this.attrs.scaleY = 1;\n        this.attrs.offsetX = 0;\n        this.attrs.offsetY = 0;\n        this.attrs.skewX = 0;\n        this.attrs.skewY = 0;\n        this._clearCache(TRANSFORM);\n        this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n        return trans;\n    };\n    Node.prototype.move = function (change) {\n        var changeX = change.x, changeY = change.y, x = this.x(), y = this.y();\n        if (changeX !== undefined) {\n            x += changeX;\n        }\n        if (changeY !== undefined) {\n            y += changeY;\n        }\n        this.setPosition({ x: x, y: y });\n        return this;\n    };\n    Node.prototype._eachAncestorReverse = function (func, top) {\n        var family = [], parent = this.getParent(), len, n;\n        if (top && top._id === this._id) {\n            func(this);\n            return;\n        }\n        family.unshift(this);\n        while (parent && (!top || parent._id !== top._id)) {\n            family.unshift(parent);\n            parent = parent.parent;\n        }\n        len = family.length;\n        for (n = 0; n < len; n++) {\n            func(family[n]);\n        }\n    };\n    Node.prototype.rotate = function (theta) {\n        this.rotation(this.rotation() + theta);\n        return this;\n    };\n    Node.prototype.moveToTop = function () {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveToTop function is ignored.');\n            return false;\n        }\n        var index = this.index;\n        this.parent.children.splice(index, 1);\n        this.parent.children.push(this);\n        this.parent._setChildrenIndices();\n        return true;\n    };\n    Node.prototype.moveUp = function () {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveUp function is ignored.');\n            return false;\n        }\n        var index = this.index, len = this.parent.getChildren().length;\n        if (index < len - 1) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.splice(index + 1, 0, this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    };\n    Node.prototype.moveDown = function () {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveDown function is ignored.');\n            return false;\n        }\n        var index = this.index;\n        if (index > 0) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.splice(index - 1, 0, this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    };\n    Node.prototype.moveToBottom = function () {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveToBottom function is ignored.');\n            return false;\n        }\n        var index = this.index;\n        if (index > 0) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.unshift(this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    };\n    Node.prototype.setZIndex = function (zIndex) {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. zIndex parameter is ignored.');\n            return this;\n        }\n        if (zIndex < 0 || zIndex >= this.parent.children.length) {\n            Util_1.Util.warn('Unexpected value ' +\n                zIndex +\n                ' for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to ' +\n                (this.parent.children.length - 1) +\n                '.');\n        }\n        var index = this.index;\n        this.parent.children.splice(index, 1);\n        this.parent.children.splice(zIndex, 0, this);\n        this.parent._setChildrenIndices();\n        return this;\n    };\n    Node.prototype.getAbsoluteOpacity = function () {\n        return this._getCache(ABSOLUTE_OPACITY, this._getAbsoluteOpacity);\n    };\n    Node.prototype._getAbsoluteOpacity = function () {\n        var absOpacity = this.opacity();\n        var parent = this.getParent();\n        if (parent && !parent._isUnderCache) {\n            absOpacity *= parent.getAbsoluteOpacity();\n        }\n        return absOpacity;\n    };\n    Node.prototype.moveTo = function (newContainer) {\n        if (this.getParent() !== newContainer) {\n            this._remove();\n            newContainer.add(this);\n        }\n        return this;\n    };\n    Node.prototype.toObject = function () {\n        var obj = {}, attrs = this.getAttrs(), key, val, getter, defaultValue, nonPlainObject;\n        obj.attrs = {};\n        for (key in attrs) {\n            val = attrs[key];\n            nonPlainObject =\n                Util_1.Util.isObject(val) && !Util_1.Util._isPlainObject(val) && !Util_1.Util._isArray(val);\n            if (nonPlainObject) {\n                continue;\n            }\n            getter = typeof this[key] === 'function' && this[key];\n            delete attrs[key];\n            defaultValue = getter ? getter.call(this) : null;\n            attrs[key] = val;\n            if (defaultValue !== val) {\n                obj.attrs[key] = val;\n            }\n        }\n        obj.className = this.getClassName();\n        return Util_1.Util._prepareToStringify(obj);\n    };\n    Node.prototype.toJSON = function () {\n        return JSON.stringify(this.toObject());\n    };\n    Node.prototype.getParent = function () {\n        return this.parent;\n    };\n    Node.prototype.findAncestors = function (selector, includeSelf, stopNode) {\n        var res = [];\n        if (includeSelf && this._isMatch(selector)) {\n            res.push(this);\n        }\n        var ancestor = this.parent;\n        while (ancestor) {\n            if (ancestor === stopNode) {\n                return res;\n            }\n            if (ancestor._isMatch(selector)) {\n                res.push(ancestor);\n            }\n            ancestor = ancestor.parent;\n        }\n        return res;\n    };\n    Node.prototype.isAncestorOf = function (node) {\n        return false;\n    };\n    Node.prototype.findAncestor = function (selector, includeSelf, stopNode) {\n        return this.findAncestors(selector, includeSelf, stopNode)[0];\n    };\n    Node.prototype._isMatch = function (selector) {\n        if (!selector) {\n            return false;\n        }\n        if (typeof selector === 'function') {\n            return selector(this);\n        }\n        var selectorArr = selector.replace(/ /g, '').split(','), len = selectorArr.length, n, sel;\n        for (n = 0; n < len; n++) {\n            sel = selectorArr[n];\n            if (!Util_1.Util.isValidSelector(sel)) {\n                Util_1.Util.warn('Selector \"' +\n                    sel +\n                    '\" is invalid. Allowed selectors examples are \"#foo\", \".bar\" or \"Group\".');\n                Util_1.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like \"Triangle\".');\n                Util_1.Util.warn('Konva is awesome, right?');\n            }\n            if (sel.charAt(0) === '#') {\n                if (this.id() === sel.slice(1)) {\n                    return true;\n                }\n            }\n            else if (sel.charAt(0) === '.') {\n                if (this.hasName(sel.slice(1))) {\n                    return true;\n                }\n            }\n            else if (this.className === sel || this.nodeType === sel) {\n                return true;\n            }\n        }\n        return false;\n    };\n    Node.prototype.getLayer = function () {\n        var parent = this.getParent();\n        return parent ? parent.getLayer() : null;\n    };\n    Node.prototype.getStage = function () {\n        return this._getCache(STAGE, this._getStage);\n    };\n    Node.prototype._getStage = function () {\n        var parent = this.getParent();\n        if (parent) {\n            return parent.getStage();\n        }\n        else {\n            return undefined;\n        }\n    };\n    Node.prototype.fire = function (eventType, evt, bubble) {\n        evt = evt || {};\n        evt.target = evt.target || this;\n        if (bubble) {\n            this._fireAndBubble(eventType, evt);\n        }\n        else {\n            this._fire(eventType, evt);\n        }\n        return this;\n    };\n    Node.prototype.getAbsoluteTransform = function (top) {\n        if (top) {\n            return this._getAbsoluteTransform(top);\n        }\n        else {\n            return this._getCache(ABSOLUTE_TRANSFORM, this._getAbsoluteTransform);\n        }\n    };\n    Node.prototype._getAbsoluteTransform = function (top) {\n        var at = new Util_1.Transform();\n        this._eachAncestorReverse(function (node) {\n            var transformsEnabled = node.getTransformsEnabled();\n            if (transformsEnabled === 'all') {\n                at.multiply(node.getTransform());\n            }\n            else if (transformsEnabled === 'position') {\n                at.translate(node.getX() - node.getOffsetX(), node.getY() - node.getOffsetY());\n            }\n        }, top);\n        return at;\n    };\n    Node.prototype.getAbsoluteScale = function (top) {\n        if (top) {\n            return this._getAbsoluteScale(top);\n        }\n        else {\n            return this._getCache(ABSOLUTE_SCALE, this._getAbsoluteScale);\n        }\n    };\n    Node.prototype._getAbsoluteScale = function (top) {\n        var parent = this;\n        while (parent) {\n            if (parent._isUnderCache) {\n                top = parent;\n            }\n            parent = parent.getParent();\n        }\n        var scaleX = 1, scaleY = 1;\n        this._eachAncestorReverse(function (node) {\n            scaleX *= node.scaleX();\n            scaleY *= node.scaleY();\n        }, top);\n        return {\n            x: scaleX,\n            y: scaleY\n        };\n    };\n    Node.prototype.getTransform = function () {\n        return this._getCache(TRANSFORM, this._getTransform);\n    };\n    Node.prototype._getTransform = function () {\n        var m = new Util_1.Transform(), x = this.x(), y = this.y(), rotation = Global_1.Konva.getAngle(this.rotation()), scaleX = this.scaleX(), scaleY = this.scaleY(), skewX = this.skewX(), skewY = this.skewY(), offsetX = this.offsetX(), offsetY = this.offsetY();\n        if (x !== 0 || y !== 0) {\n            m.translate(x, y);\n        }\n        if (rotation !== 0) {\n            m.rotate(rotation);\n        }\n        if (skewX !== 0 || skewY !== 0) {\n            m.skew(skewX, skewY);\n        }\n        if (scaleX !== 1 || scaleY !== 1) {\n            m.scale(scaleX, scaleY);\n        }\n        if (offsetX !== 0 || offsetY !== 0) {\n            m.translate(-1 * offsetX, -1 * offsetY);\n        }\n        return m;\n    };\n    Node.prototype.clone = function (obj) {\n        var attrs = Util_1.Util.cloneObject(this.attrs), key, allListeners, len, n, listener;\n        for (var i in CLONE_BLACK_LIST) {\n            var blockAttr = CLONE_BLACK_LIST[i];\n            delete attrs[blockAttr];\n        }\n        for (key in obj) {\n            attrs[key] = obj[key];\n        }\n        var node = new this.constructor(attrs);\n        for (key in this.eventListeners) {\n            allListeners = this.eventListeners[key];\n            len = allListeners.length;\n            for (n = 0; n < len; n++) {\n                listener = allListeners[n];\n                if (listener.name.indexOf(KONVA) < 0) {\n                    if (!node.eventListeners[key]) {\n                        node.eventListeners[key] = [];\n                    }\n                    node.eventListeners[key].push(listener);\n                }\n            }\n        }\n        return node;\n    };\n    Node.prototype._toKonvaCanvas = function (config) {\n        config = config || {};\n        var box = this.getClientRect();\n        var stage = this.getStage(), x = config.x !== undefined ? config.x : box.x, y = config.y !== undefined ? config.y : box.y, pixelRatio = config.pixelRatio || 1, canvas = new Canvas_1.SceneCanvas({\n            width: config.width || box.width || (stage ? stage.width() : 0),\n            height: config.height || box.height || (stage ? stage.height() : 0),\n            pixelRatio: pixelRatio\n        }), context = canvas.getContext();\n        context.save();\n        if (x || y) {\n            context.translate(-1 * x, -1 * y);\n        }\n        this.drawScene(canvas);\n        context.restore();\n        return canvas;\n    };\n    Node.prototype.toCanvas = function (config) {\n        return this._toKonvaCanvas(config)._canvas;\n    };\n    Node.prototype.toDataURL = function (config) {\n        config = config || {};\n        var mimeType = config.mimeType || null, quality = config.quality || null;\n        var url = this._toKonvaCanvas(config).toDataURL(mimeType, quality);\n        if (config.callback) {\n            config.callback(url);\n        }\n        return url;\n    };\n    Node.prototype.toImage = function (config) {\n        if (!config || !config.callback) {\n            throw 'callback required for toImage method config argument';\n        }\n        var callback = config.callback;\n        delete config.callback;\n        Util_1.Util._urlToImage(this.toDataURL(config), function (img) {\n            callback(img);\n        });\n    };\n    Node.prototype.setSize = function (size) {\n        this.width(size.width);\n        this.height(size.height);\n        return this;\n    };\n    Node.prototype.getSize = function () {\n        return {\n            width: this.width(),\n            height: this.height()\n        };\n    };\n    Node.prototype.getClassName = function () {\n        return this.className || this.nodeType;\n    };\n    Node.prototype.getType = function () {\n        return this.nodeType;\n    };\n    Node.prototype.getDragDistance = function () {\n        if (this.attrs.dragDistance !== undefined) {\n            return this.attrs.dragDistance;\n        }\n        else if (this.parent) {\n            return this.parent.getDragDistance();\n        }\n        else {\n            return Global_1.Konva.dragDistance;\n        }\n    };\n    Node.prototype._off = function (type, name, callback) {\n        var evtListeners = this.eventListeners[type], i, evtName, handler;\n        for (i = 0; i < evtListeners.length; i++) {\n            evtName = evtListeners[i].name;\n            handler = evtListeners[i].handler;\n            if ((evtName !== 'konva' || name === 'konva') &&\n                (!name || evtName === name) &&\n                (!callback || callback === handler)) {\n                evtListeners.splice(i, 1);\n                if (evtListeners.length === 0) {\n                    delete this.eventListeners[type];\n                    break;\n                }\n                i--;\n            }\n        }\n    };\n    Node.prototype._fireChangeEvent = function (attr, oldVal, newVal) {\n        this._fire(attr + CHANGE, {\n            oldVal: oldVal,\n            newVal: newVal\n        });\n    };\n    Node.prototype.setId = function (id) {\n        var oldId = this.id();\n        exports._removeId(oldId, this);\n        _addId(this, id);\n        this._setAttr('id', id);\n        return this;\n    };\n    Node.prototype.setName = function (name) {\n        var oldNames = (this.name() || '').split(/\\s/g);\n        var newNames = (name || '').split(/\\s/g);\n        var subname, i;\n        for (i = 0; i < oldNames.length; i++) {\n            subname = oldNames[i];\n            if (newNames.indexOf(subname) === -1 && subname) {\n                exports._removeName(subname, this._id);\n            }\n        }\n        for (i = 0; i < newNames.length; i++) {\n            subname = newNames[i];\n            if (oldNames.indexOf(subname) === -1 && subname) {\n                exports._addName(this, subname);\n            }\n        }\n        this._setAttr(NAME, name);\n        return this;\n    };\n    Node.prototype.addName = function (name) {\n        if (!this.hasName(name)) {\n            var oldName = this.name();\n            var newName = oldName ? oldName + ' ' + name : name;\n            this.setName(newName);\n        }\n        return this;\n    };\n    Node.prototype.hasName = function (name) {\n        if (!name) {\n            return false;\n        }\n        var fullName = this.name();\n        if (!fullName) {\n            return false;\n        }\n        var names = (fullName || '').split(/\\s/g);\n        return names.indexOf(name) !== -1;\n    };\n    Node.prototype.removeName = function (name) {\n        var names = (this.name() || '').split(/\\s/g);\n        var index = names.indexOf(name);\n        if (index !== -1) {\n            names.splice(index, 1);\n            this.setName(names.join(' '));\n        }\n        return this;\n    };\n    Node.prototype.setAttr = function (attr, val) {\n        var func = this[SET + Util_1.Util._capitalize(attr)];\n        if (Util_1.Util._isFunction(func)) {\n            func.call(this, val);\n        }\n        else {\n            this._setAttr(attr, val);\n        }\n        return this;\n    };\n    Node.prototype._setAttr = function (key, val) {\n        var oldVal = this.attrs[key];\n        if (oldVal === val && !Util_1.Util.isObject(val)) {\n            return;\n        }\n        if (val === undefined || val === null) {\n            delete this.attrs[key];\n        }\n        else {\n            this.attrs[key] = val;\n        }\n        this._fireChangeEvent(key, oldVal, val);\n    };\n    Node.prototype._setComponentAttr = function (key, component, val) {\n        var oldVal;\n        if (val !== undefined) {\n            oldVal = this.attrs[key];\n            if (!oldVal) {\n                this.attrs[key] = this.getAttr(key);\n            }\n            this.attrs[key][component] = val;\n            this._fireChangeEvent(key, oldVal, val);\n        }\n    };\n    Node.prototype._fireAndBubble = function (eventType, evt, compareShape) {\n        if (evt && this.nodeType === SHAPE) {\n            evt.target = this;\n        }\n        var shouldStop = (eventType === MOUSEENTER || eventType === MOUSELEAVE) &&\n            ((compareShape &&\n                (this === compareShape ||\n                    (this.isAncestorOf && this.isAncestorOf(compareShape)))) ||\n                (this.nodeType === 'Stage' && !compareShape));\n        if (!shouldStop) {\n            this._fire(eventType, evt);\n            var stopBubble = (eventType === MOUSEENTER || eventType === MOUSELEAVE) &&\n                (compareShape &&\n                    compareShape.isAncestorOf &&\n                    compareShape.isAncestorOf(this) &&\n                    !compareShape.isAncestorOf(this.parent));\n            if (((evt && !evt.cancelBubble) || !evt) &&\n                this.parent &&\n                this.parent.isListening() &&\n                !stopBubble) {\n                if (compareShape && compareShape.parent) {\n                    this._fireAndBubble.call(this.parent, eventType, evt, compareShape.parent);\n                }\n                else {\n                    this._fireAndBubble.call(this.parent, eventType, evt);\n                }\n            }\n        }\n    };\n    Node.prototype._fire = function (eventType, evt) {\n        var events = this.eventListeners[eventType], i;\n        if (events) {\n            evt = evt || {};\n            evt.currentTarget = this;\n            evt.type = eventType;\n            for (i = 0; i < events.length; i++) {\n                events[i].handler.call(this, evt);\n            }\n        }\n    };\n    Node.prototype.draw = function () {\n        this.drawScene();\n        this.drawHit();\n        return this;\n    };\n    Node.prototype._createDragElement = function (evt) {\n        var pointerId = evt ? evt.pointerId : undefined;\n        var stage = this.getStage();\n        var ap = this.getAbsolutePosition();\n        var pos = stage._getPointerById(pointerId) ||\n            stage._changedPointerPositions[0] ||\n            ap;\n        DragAndDrop_1.DD._dragElements.set(this._id, {\n            node: this,\n            startPointerPos: pos,\n            offset: {\n                x: pos.x - ap.x,\n                y: pos.y - ap.y\n            },\n            dragStatus: 'ready',\n            pointerId: pointerId\n        });\n    };\n    Node.prototype.startDrag = function (evt) {\n        if (!DragAndDrop_1.DD._dragElements.has(this._id)) {\n            this._createDragElement(evt);\n        }\n        var elem = DragAndDrop_1.DD._dragElements.get(this._id);\n        elem.dragStatus = 'dragging';\n        this.fire('dragstart', {\n            type: 'dragstart',\n            target: this,\n            evt: evt && evt.evt\n        }, true);\n    };\n    Node.prototype._setDragPosition = function (evt, elem) {\n        var pos = this.getStage()._getPointerById(elem.pointerId);\n        var dbf = this.dragBoundFunc();\n        if (!pos) {\n            return;\n        }\n        var newNodePos = {\n            x: pos.x - elem.offset.x,\n            y: pos.y - elem.offset.y\n        };\n        if (dbf !== undefined) {\n            newNodePos = dbf.call(this, newNodePos, evt);\n        }\n        if (!this._lastPos ||\n            this._lastPos.x !== newNodePos.x ||\n            this._lastPos.y !== newNodePos.y) {\n            this.setAbsolutePosition(newNodePos);\n            if (this.getLayer()) {\n                this.getLayer().batchDraw();\n            }\n            else if (this.getStage()) {\n                this.getStage().batchDraw();\n            }\n        }\n        this._lastPos = newNodePos;\n    };\n    Node.prototype.stopDrag = function (evt) {\n        var elem = DragAndDrop_1.DD._dragElements.get(this._id);\n        if (elem) {\n            elem.dragStatus = 'stopped';\n        }\n        DragAndDrop_1.DD._endDragBefore(evt);\n        DragAndDrop_1.DD._endDragAfter(evt);\n    };\n    Node.prototype.setDraggable = function (draggable) {\n        this._setAttr('draggable', draggable);\n        this._dragChange();\n    };\n    Node.prototype.isDragging = function () {\n        var elem = DragAndDrop_1.DD._dragElements.get(this._id);\n        return elem ? elem.dragStatus === 'dragging' : false;\n    };\n    Node.prototype._listenDrag = function () {\n        this._dragCleanup();\n        this.on('mousedown.konva touchstart.konva', function (evt) {\n            var _this = this;\n            var shouldCheckButton = evt.evt['button'] !== undefined;\n            var canDrag = !shouldCheckButton || Global_1.Konva.dragButtons.indexOf(evt.evt['button']) >= 0;\n            if (!canDrag) {\n                return;\n            }\n            if (this.isDragging()) {\n                return;\n            }\n            var hasDraggingChild = false;\n            DragAndDrop_1.DD._dragElements.forEach(function (elem) {\n                if (_this.isAncestorOf(elem.node)) {\n                    hasDraggingChild = true;\n                }\n            });\n            if (!hasDraggingChild) {\n                this._createDragElement(evt);\n            }\n        });\n    };\n    Node.prototype._dragChange = function () {\n        if (this.attrs.draggable) {\n            this._listenDrag();\n        }\n        else {\n            this._dragCleanup();\n            var stage = this.getStage();\n            if (stage && DragAndDrop_1.DD._dragElements.has(this._id)) {\n                this.stopDrag();\n            }\n        }\n    };\n    Node.prototype._dragCleanup = function () {\n        this.off('mousedown.konva');\n        this.off('touchstart.konva');\n    };\n    Node.create = function (data, container) {\n        if (Util_1.Util._isString(data)) {\n            data = JSON.parse(data);\n        }\n        return this._createNode(data, container);\n    };\n    Node._createNode = function (obj, container) {\n        var className = Node.prototype.getClassName.call(obj), children = obj.children, no, len, n;\n        if (container) {\n            obj.attrs.container = container;\n        }\n        if (!Global_1._NODES_REGISTRY[className]) {\n            Util_1.Util.warn('Can not find a node with class name \"' +\n                className +\n                '\". Fallback to \"Shape\".');\n            className = 'Shape';\n        }\n        var Class = Global_1._NODES_REGISTRY[className];\n        no = new Class(obj.attrs);\n        if (children) {\n            len = children.length;\n            for (n = 0; n < len; n++) {\n                no.add(Node._createNode(children[n]));\n            }\n        }\n        return no;\n    };\n    return Node;\n}());\nexports.Node = Node;\nNode.prototype.nodeType = 'Node';\nNode.prototype._attrsAffectingSize = [];\nFactory_1.Factory.addGetterSetter(Node, 'zIndex');\nFactory_1.Factory.addGetterSetter(Node, 'absolutePosition');\nFactory_1.Factory.addGetterSetter(Node, 'position');\nFactory_1.Factory.addGetterSetter(Node, 'x', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'y', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'globalCompositeOperation', 'source-over', Validators_1.getStringValidator());\nFactory_1.Factory.addGetterSetter(Node, 'opacity', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'name', '', Validators_1.getStringValidator());\nFactory_1.Factory.addGetterSetter(Node, 'id', '', Validators_1.getStringValidator());\nFactory_1.Factory.addGetterSetter(Node, 'rotation', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'scale', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Node, 'scaleX', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'scaleY', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'skew', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Node, 'skewX', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'skewY', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'offset', ['x', 'y']);\nFactory_1.Factory.addGetterSetter(Node, 'offsetX', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'offsetY', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'dragDistance', null, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'width', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'height', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Node, 'listening', 'inherit', function (val) {\n    var isValid = val === true || val === false || val === 'inherit';\n    if (!isValid) {\n        Util_1.Util.warn(val +\n            ' is a not valid value for \"listening\" attribute. The value may be true, false or \"inherit\".');\n    }\n    return val;\n});\nFactory_1.Factory.addGetterSetter(Node, 'preventDefault', true, Validators_1.getBooleanValidator());\nFactory_1.Factory.addGetterSetter(Node, 'filters', null, function (val) {\n    this._filterUpToDate = false;\n    return val;\n});\nFactory_1.Factory.addGetterSetter(Node, 'visible', 'inherit', function (val) {\n    var isValid = val === true || val === false || val === 'inherit';\n    if (!isValid) {\n        Util_1.Util.warn(val +\n            ' is a not valid value for \"visible\" attribute. The value may be true, false or \"inherit\".');\n    }\n    return val;\n});\nFactory_1.Factory.addGetterSetter(Node, 'transformsEnabled', 'all', Validators_1.getStringValidator());\nFactory_1.Factory.addGetterSetter(Node, 'size');\nFactory_1.Factory.addGetterSetter(Node, 'dragBoundFunc');\nFactory_1.Factory.addGetterSetter(Node, 'draggable', false, Validators_1.getBooleanValidator());\nFactory_1.Factory.backCompat(Node, {\n    rotateDeg: 'rotate',\n    setRotationDeg: 'setRotation',\n    getRotationDeg: 'getRotation'\n});\nUtil_1.Collection.mapMethods(Node);\n\n};","~:removed-requires",["~#set",[]],"~:actual-requires",["^5",["~$module$node_modules$konva$lib$Factory","~$module$node_modules$konva$lib$DragAndDrop","~$module$node_modules$konva$lib$Validators","~$shadow.js","~$module$node_modules$konva$lib$Global","~$module$node_modules$konva$lib$Canvas","~$module$node_modules$konva$lib$Util"]],"~:properties",["^5",["startPointerPos","_removeName","getAbsolutePosition","getChildren","_createNode","_getCanvasCache","_eachAncestorReverse","attrs","handler","setDraggable","width","_isVisible","isDragging","getRotationDeg","toObject","hide","_dragCleanup","index","getType","currentTarget","off","offset","setPosition","_drawCachedSceneCanvas","eventListeners","height","hasName","getAbsoluteOpacity","setRotationDeg","removeEventListener","_clearTransform","className","getDragDistance","_toKonvaCanvas","getPosition","getClassName","_createDragElement","parent","children","x","__esModule","_getCache","addName","imageSmoothingEnabled","isCache","setName","toDataURL","_setTransform","_isMatch","_fireChangeEvent","skewY","_lastPos","_setAttr","_dragChange","_cache","newVal","cache","getLayer","scaleX","setId","removeName","name","getZIndex","clearCache","ids","getAbsoluteTransform","pixelRatio","nodeType","value","_drawCachedHitCanvas","show","destroy","_setDragPosition","moveDown","getAttr","_dragEventId","pointerId","moveToTop","setAttrs","startDrag","getParent","_getAbsoluteScale","_getTransform","remove","moveUp","on","_fireAndBubble","_clearSelfAndDescendantCache","filter","setAbsolutePosition","scaleY","rotation","rotateDeg","evt","_getStage","isAncestorOf","names","skipTransform","move","_fire","getAttrs","_getAbsoluteTransform","moveTo","type","_transformedRect","_removeId","y","isListening","draw","dragStatus","moveToBottom","_clearCache","_isUnderCache","isVisible","setSize","getClientRect","_getAbsoluteOpacity","setZIndex","_id","_remove","hit","_listenDrag","getAbsoluteScale","target","offsetX","clone","skewX","_attrsAffectingSize","_getCachedSceneCanvas","dispatchEvent","create","relativeTo","findAncestor","_addName","findAncestors","toImage","toCanvas","shouldDrawHit","oldVal","_delegate","hasChildren","setAttr","getTransform","addEventListener","getAbsoluteZIndex","stopDrag","getSize","m","getAncestors","rotate","Node","offsetY","getStage","_off","isCached","_isListening","_filterUpToDate","node","_setComponentAttr","getDepth","container","fire","scene","toJSON"]],"~:compiled-at",1568562085225,"~:source-map-json","{\n\"version\":3,\n\"file\":\"module$node_modules$konva$lib$Node.js\",\n\"lineCount\":59,\n\"mappings\":\"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\",\n\"sources\":[\"node_modules/konva/lib/Node.js\"],\n\"sourcesContent\":[\"shadow$provide[\\\"module$node_modules$konva$lib$Node\\\"] = function(global,require,module,exports) {\\n\\\"use strict\\\";\\nObject.defineProperty(exports, \\\"__esModule\\\", { value: true });\\nvar Util_1 = require(\\\"./Util\\\");\\nvar Factory_1 = require(\\\"./Factory\\\");\\nvar Canvas_1 = require(\\\"./Canvas\\\");\\nvar Global_1 = require(\\\"./Global\\\");\\nvar DragAndDrop_1 = require(\\\"./DragAndDrop\\\");\\nvar Validators_1 = require(\\\"./Validators\\\");\\nexports.ids = {};\\nexports.names = {};\\nvar _addId = function (node, id) {\\n    if (!id) {\\n        return;\\n    }\\n    exports.ids[id] = node;\\n};\\nexports._removeId = function (id, node) {\\n    if (!id) {\\n        return;\\n    }\\n    if (exports.ids[id] !== node) {\\n        return;\\n    }\\n    delete exports.ids[id];\\n};\\nexports._addName = function (node, name) {\\n    if (name) {\\n        if (!exports.names[name]) {\\n            exports.names[name] = [];\\n        }\\n        exports.names[name].push(node);\\n    }\\n};\\nexports._removeName = function (name, _id) {\\n    if (!name) {\\n        return;\\n    }\\n    var nodes = exports.names[name];\\n    if (!nodes) {\\n        return;\\n    }\\n    for (var n = 0; n < nodes.length; n++) {\\n        var no = nodes[n];\\n        if (no._id === _id) {\\n            nodes.splice(n, 1);\\n        }\\n    }\\n    if (nodes.length === 0) {\\n        delete exports.names[name];\\n    }\\n};\\nvar ABSOLUTE_OPACITY = 'absoluteOpacity', ABSOLUTE_TRANSFORM = 'absoluteTransform', ABSOLUTE_SCALE = 'absoluteScale', CANVAS = 'canvas', CHANGE = 'Change', CHILDREN = 'children', KONVA = 'konva', LISTENING = 'listening', MOUSEENTER = 'mouseenter', MOUSELEAVE = 'mouseleave', NAME = 'name', SET = 'set', SHAPE = 'Shape', SPACE = ' ', STAGE = 'stage', TRANSFORM = 'transform', UPPER_STAGE = 'Stage', VISIBLE = 'visible', CLONE_BLACK_LIST = ['id'], TRANSFORM_CHANGE_STR = [\\n    'xChange.konva',\\n    'yChange.konva',\\n    'scaleXChange.konva',\\n    'scaleYChange.konva',\\n    'skewXChange.konva',\\n    'skewYChange.konva',\\n    'rotationChange.konva',\\n    'offsetXChange.konva',\\n    'offsetYChange.konva',\\n    'transformsEnabledChange.konva'\\n].join(SPACE), SCALE_CHANGE_STR = ['scaleXChange.konva', 'scaleYChange.konva'].join(SPACE);\\nvar emptyChildren = new Util_1.Collection();\\nvar idCounter = 1;\\nvar Node = (function () {\\n    function Node(config) {\\n        var _this = this;\\n        this._id = idCounter++;\\n        this.eventListeners = {};\\n        this.attrs = {};\\n        this.index = 0;\\n        this.parent = null;\\n        this._cache = new Map();\\n        this._lastPos = null;\\n        this._filterUpToDate = false;\\n        this._isUnderCache = false;\\n        this.children = emptyChildren;\\n        this._dragEventId = null;\\n        this.setAttrs(config);\\n        this.on(TRANSFORM_CHANGE_STR, function () {\\n            _this._clearCache(TRANSFORM);\\n            _this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\\n        });\\n        this.on(SCALE_CHANGE_STR, function () {\\n            _this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\\n        });\\n        this.on('visibleChange.konva', function () {\\n            _this._clearSelfAndDescendantCache(VISIBLE);\\n        });\\n        this.on('listeningChange.konva', function () {\\n            _this._clearSelfAndDescendantCache(LISTENING);\\n        });\\n        this.on('opacityChange.konva', function () {\\n            _this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\\n        });\\n    }\\n    Node.prototype.hasChildren = function () {\\n        return false;\\n    };\\n    Node.prototype.getChildren = function () {\\n        return emptyChildren;\\n    };\\n    Node.prototype._clearCache = function (attr) {\\n        if (attr) {\\n            this._cache.delete(attr);\\n        }\\n        else {\\n            this._cache.clear();\\n        }\\n    };\\n    Node.prototype._getCache = function (attr, privateGetter) {\\n        var cache = this._cache.get(attr);\\n        if (cache === undefined) {\\n            cache = privateGetter.call(this);\\n            this._cache.set(attr, cache);\\n        }\\n        return cache;\\n    };\\n    Node.prototype._getCanvasCache = function () {\\n        return this._cache.get(CANVAS);\\n    };\\n    Node.prototype._clearSelfAndDescendantCache = function (attr) {\\n        this._clearCache(attr);\\n        if (this._getCanvasCache()) {\\n            return;\\n        }\\n        if (this.children) {\\n            this.children.each(function (node) {\\n                node._clearSelfAndDescendantCache(attr);\\n            });\\n        }\\n    };\\n    Node.prototype.clearCache = function () {\\n        this._cache.delete(CANVAS);\\n        this._clearSelfAndDescendantCache();\\n        return this;\\n    };\\n    Node.prototype.cache = function (config) {\\n        var conf = config || {};\\n        var rect = {};\\n        if (conf.x === undefined ||\\n            conf.y === undefined ||\\n            conf.width === undefined ||\\n            conf.height === undefined) {\\n            rect = this.getClientRect({\\n                skipTransform: true,\\n                relativeTo: this.getParent()\\n            });\\n        }\\n        var width = conf.width || rect.width, height = conf.height || rect.height, pixelRatio = conf.pixelRatio, x = conf.x === undefined ? rect.x : conf.x, y = conf.y === undefined ? rect.y : conf.y, offset = conf.offset || 0, drawBorder = conf.drawBorder || false;\\n        if (!width || !height) {\\n            Util_1.Util.error('Can not cache the node. Width or height of the node equals 0. Caching is skipped.');\\n            return;\\n        }\\n        width += offset * 2;\\n        height += offset * 2;\\n        x -= offset;\\n        y -= offset;\\n        var cachedSceneCanvas = new Canvas_1.SceneCanvas({\\n            pixelRatio: pixelRatio,\\n            width: width,\\n            height: height\\n        }), cachedFilterCanvas = new Canvas_1.SceneCanvas({\\n            pixelRatio: pixelRatio,\\n            width: width,\\n            height: height\\n        }), cachedHitCanvas = new Canvas_1.HitCanvas({\\n            pixelRatio: 1,\\n            width: width,\\n            height: height\\n        }), sceneContext = cachedSceneCanvas.getContext(), hitContext = cachedHitCanvas.getContext();\\n        cachedHitCanvas.isCache = true;\\n        this._cache.delete('canvas');\\n        this._filterUpToDate = false;\\n        if (conf.imageSmoothingEnabled === false) {\\n            cachedSceneCanvas.getContext()._context.imageSmoothingEnabled = false;\\n            cachedFilterCanvas.getContext()._context.imageSmoothingEnabled = false;\\n            cachedHitCanvas.getContext()._context.imageSmoothingEnabled = false;\\n        }\\n        sceneContext.save();\\n        hitContext.save();\\n        sceneContext.translate(-x, -y);\\n        hitContext.translate(-x, -y);\\n        this._isUnderCache = true;\\n        this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\\n        this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\\n        this.drawScene(cachedSceneCanvas, this, true);\\n        this.drawHit(cachedHitCanvas, this, true);\\n        this._isUnderCache = false;\\n        sceneContext.restore();\\n        hitContext.restore();\\n        if (drawBorder) {\\n            sceneContext.save();\\n            sceneContext.beginPath();\\n            sceneContext.rect(0, 0, width, height);\\n            sceneContext.closePath();\\n            sceneContext.setAttr('strokeStyle', 'red');\\n            sceneContext.setAttr('lineWidth', 5);\\n            sceneContext.stroke();\\n            sceneContext.restore();\\n        }\\n        this._cache.set(CANVAS, {\\n            scene: cachedSceneCanvas,\\n            filter: cachedFilterCanvas,\\n            hit: cachedHitCanvas,\\n            x: x,\\n            y: y\\n        });\\n        return this;\\n    };\\n    Node.prototype.isCached = function () {\\n        return this._cache.has('canvas');\\n    };\\n    Node.prototype.getClientRect = function (config) {\\n        throw new Error('abstract \\\"getClientRect\\\" method call');\\n    };\\n    Node.prototype._transformedRect = function (rect, top) {\\n        var points = [\\n            { x: rect.x, y: rect.y },\\n            { x: rect.x + rect.width, y: rect.y },\\n            { x: rect.x + rect.width, y: rect.y + rect.height },\\n            { x: rect.x, y: rect.y + rect.height }\\n        ];\\n        var minX, minY, maxX, maxY;\\n        var trans = this.getAbsoluteTransform(top);\\n        points.forEach(function (point) {\\n            var transformed = trans.point(point);\\n            if (minX === undefined) {\\n                minX = maxX = transformed.x;\\n                minY = maxY = transformed.y;\\n            }\\n            minX = Math.min(minX, transformed.x);\\n            minY = Math.min(minY, transformed.y);\\n            maxX = Math.max(maxX, transformed.x);\\n            maxY = Math.max(maxY, transformed.y);\\n        });\\n        return {\\n            x: minX,\\n            y: minY,\\n            width: maxX - minX,\\n            height: maxY - minY\\n        };\\n    };\\n    Node.prototype._drawCachedSceneCanvas = function (context) {\\n        context.save();\\n        context._applyOpacity(this);\\n        context._applyGlobalCompositeOperation(this);\\n        var canvasCache = this._getCanvasCache();\\n        context.translate(canvasCache.x, canvasCache.y);\\n        var cacheCanvas = this._getCachedSceneCanvas();\\n        var ratio = cacheCanvas.pixelRatio;\\n        context.drawImage(cacheCanvas._canvas, 0, 0, cacheCanvas.width / ratio, cacheCanvas.height / ratio);\\n        context.restore();\\n    };\\n    Node.prototype._drawCachedHitCanvas = function (context) {\\n        var canvasCache = this._getCanvasCache(), hitCanvas = canvasCache.hit;\\n        context.save();\\n        context._applyGlobalCompositeOperation(this);\\n        context.translate(canvasCache.x, canvasCache.y);\\n        context.drawImage(hitCanvas._canvas, 0, 0);\\n        context.restore();\\n    };\\n    Node.prototype._getCachedSceneCanvas = function () {\\n        var filters = this.filters(), cachedCanvas = this._getCanvasCache(), sceneCanvas = cachedCanvas.scene, filterCanvas = cachedCanvas.filter, filterContext = filterCanvas.getContext(), len, imageData, n, filter;\\n        if (filters) {\\n            if (!this._filterUpToDate) {\\n                var ratio = sceneCanvas.pixelRatio;\\n                try {\\n                    len = filters.length;\\n                    filterContext.clear();\\n                    filterContext.drawImage(sceneCanvas._canvas, 0, 0, sceneCanvas.getWidth() / ratio, sceneCanvas.getHeight() / ratio);\\n                    imageData = filterContext.getImageData(0, 0, filterCanvas.getWidth(), filterCanvas.getHeight());\\n                    for (n = 0; n < len; n++) {\\n                        filter = filters[n];\\n                        if (typeof filter !== 'function') {\\n                            Util_1.Util.error('Filter should be type of function, but got ' +\\n                                typeof filter +\\n                                ' insted. Please check correct filters');\\n                            continue;\\n                        }\\n                        filter.call(this, imageData);\\n                        filterContext.putImageData(imageData, 0, 0);\\n                    }\\n                }\\n                catch (e) {\\n                    Util_1.Util.error('Unable to apply filter. ' + e.message);\\n                }\\n                this._filterUpToDate = true;\\n            }\\n            return filterCanvas;\\n        }\\n        return sceneCanvas;\\n    };\\n    Node.prototype.on = function (evtStr, handler) {\\n        if (arguments.length === 3) {\\n            return this._delegate.apply(this, arguments);\\n        }\\n        var events = evtStr.split(SPACE), len = events.length, n, event, parts, baseEvent, name;\\n        for (n = 0; n < len; n++) {\\n            event = events[n];\\n            parts = event.split('.');\\n            baseEvent = parts[0];\\n            name = parts[1] || '';\\n            if (!this.eventListeners[baseEvent]) {\\n                this.eventListeners[baseEvent] = [];\\n            }\\n            this.eventListeners[baseEvent].push({\\n                name: name,\\n                handler: handler\\n            });\\n        }\\n        return this;\\n    };\\n    Node.prototype.off = function (evtStr, callback) {\\n        var events = (evtStr || '').split(SPACE), len = events.length, n, t, event, parts, baseEvent, name;\\n        if (!evtStr) {\\n            for (t in this.eventListeners) {\\n                this._off(t);\\n            }\\n        }\\n        for (n = 0; n < len; n++) {\\n            event = events[n];\\n            parts = event.split('.');\\n            baseEvent = parts[0];\\n            name = parts[1];\\n            if (baseEvent) {\\n                if (this.eventListeners[baseEvent]) {\\n                    this._off(baseEvent, name, callback);\\n                }\\n            }\\n            else {\\n                for (t in this.eventListeners) {\\n                    this._off(t, name, callback);\\n                }\\n            }\\n        }\\n        return this;\\n    };\\n    Node.prototype.dispatchEvent = function (evt) {\\n        var e = {\\n            target: this,\\n            type: evt.type,\\n            evt: evt\\n        };\\n        this.fire(evt.type, e);\\n        return this;\\n    };\\n    Node.prototype.addEventListener = function (type, handler) {\\n        this.on(type, function (evt) {\\n            handler.call(this, evt.evt);\\n        });\\n        return this;\\n    };\\n    Node.prototype.removeEventListener = function (type) {\\n        this.off(type);\\n        return this;\\n    };\\n    Node.prototype._delegate = function (event, selector, handler) {\\n        var stopNode = this;\\n        this.on(event, function (evt) {\\n            var targets = evt.target.findAncestors(selector, true, stopNode);\\n            for (var i = 0; i < targets.length; i++) {\\n                evt = Util_1.Util.cloneObject(evt);\\n                evt.currentTarget = targets[i];\\n                handler.call(targets[i], evt);\\n            }\\n        });\\n    };\\n    Node.prototype.remove = function () {\\n        if (this.isDragging()) {\\n            this.stopDrag();\\n        }\\n        DragAndDrop_1.DD._dragElements.delete(this._id);\\n        this._remove();\\n        return this;\\n    };\\n    Node.prototype._remove = function () {\\n        this._clearSelfAndDescendantCache(STAGE);\\n        this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\\n        this._clearSelfAndDescendantCache(VISIBLE);\\n        this._clearSelfAndDescendantCache(LISTENING);\\n        this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\\n        var parent = this.getParent();\\n        if (parent && parent.children) {\\n            parent.children.splice(this.index, 1);\\n            parent._setChildrenIndices();\\n            this.parent = null;\\n        }\\n    };\\n    Node.prototype.destroy = function () {\\n        exports._removeId(this.id(), this);\\n        var names = (this.name() || '').split(/\\\\s/g);\\n        for (var i = 0; i < names.length; i++) {\\n            var subname = names[i];\\n            exports._removeName(subname, this._id);\\n        }\\n        this.remove();\\n        return this;\\n    };\\n    Node.prototype.getAttr = function (attr) {\\n        var method = 'get' + Util_1.Util._capitalize(attr);\\n        if (Util_1.Util._isFunction(this[method])) {\\n            return this[method]();\\n        }\\n        return this.attrs[attr];\\n    };\\n    Node.prototype.getAncestors = function () {\\n        var parent = this.getParent(), ancestors = new Util_1.Collection();\\n        while (parent) {\\n            ancestors.push(parent);\\n            parent = parent.getParent();\\n        }\\n        return ancestors;\\n    };\\n    Node.prototype.getAttrs = function () {\\n        return this.attrs || {};\\n    };\\n    Node.prototype.setAttrs = function (config) {\\n        var key, method;\\n        if (!config) {\\n            return this;\\n        }\\n        for (key in config) {\\n            if (key === CHILDREN) {\\n                continue;\\n            }\\n            method = SET + Util_1.Util._capitalize(key);\\n            if (Util_1.Util._isFunction(this[method])) {\\n                this[method](config[key]);\\n            }\\n            else {\\n                this._setAttr(key, config[key]);\\n            }\\n        }\\n        return this;\\n    };\\n    Node.prototype.isListening = function () {\\n        return this._getCache(LISTENING, this._isListening);\\n    };\\n    Node.prototype._isListening = function () {\\n        var listening = this.listening(), parent = this.getParent();\\n        if (listening === 'inherit') {\\n            if (parent) {\\n                return parent.isListening();\\n            }\\n            else {\\n                return true;\\n            }\\n        }\\n        else {\\n            return listening;\\n        }\\n    };\\n    Node.prototype.isVisible = function () {\\n        return this._getCache(VISIBLE, this._isVisible);\\n    };\\n    Node.prototype._isVisible = function (relativeTo) {\\n        var visible = this.visible(), parent = this.getParent();\\n        if (visible === 'inherit') {\\n            if (parent && parent !== relativeTo) {\\n                return parent._isVisible(relativeTo);\\n            }\\n            else {\\n                return true;\\n            }\\n        }\\n        else {\\n            return visible;\\n        }\\n    };\\n    Node.prototype.shouldDrawHit = function () {\\n        var layer = this.getLayer();\\n        return ((!layer && this.isListening() && this.isVisible()) ||\\n            (layer &&\\n                layer.hitGraphEnabled() &&\\n                this.isListening() &&\\n                this.isVisible()));\\n    };\\n    Node.prototype.show = function () {\\n        this.visible(true);\\n        return this;\\n    };\\n    Node.prototype.hide = function () {\\n        this.visible(false);\\n        return this;\\n    };\\n    Node.prototype.getZIndex = function () {\\n        return this.index || 0;\\n    };\\n    Node.prototype.getAbsoluteZIndex = function () {\\n        var depth = this.getDepth(), that = this, index = 0, nodes, len, n, child;\\n        function addChildren(children) {\\n            nodes = [];\\n            len = children.length;\\n            for (n = 0; n < len; n++) {\\n                child = children[n];\\n                index++;\\n                if (child.nodeType !== SHAPE) {\\n                    nodes = nodes.concat(child.getChildren().toArray());\\n                }\\n                if (child._id === that._id) {\\n                    n = len;\\n                }\\n            }\\n            if (nodes.length > 0 && nodes[0].getDepth() <= depth) {\\n                addChildren(nodes);\\n            }\\n        }\\n        if (that.nodeType !== UPPER_STAGE) {\\n            addChildren(that.getStage().getChildren());\\n        }\\n        return index;\\n    };\\n    Node.prototype.getDepth = function () {\\n        var depth = 0, parent = this.parent;\\n        while (parent) {\\n            depth++;\\n            parent = parent.parent;\\n        }\\n        return depth;\\n    };\\n    Node.prototype.setPosition = function (pos) {\\n        this.x(pos.x);\\n        this.y(pos.y);\\n        return this;\\n    };\\n    Node.prototype.getPosition = function () {\\n        return {\\n            x: this.x(),\\n            y: this.y()\\n        };\\n    };\\n    Node.prototype.getAbsolutePosition = function (top) {\\n        var absoluteMatrix = this.getAbsoluteTransform(top).getMatrix(), absoluteTransform = new Util_1.Transform(), offset = this.offset();\\n        absoluteTransform.m = absoluteMatrix.slice();\\n        absoluteTransform.translate(offset.x, offset.y);\\n        return absoluteTransform.getTranslation();\\n    };\\n    Node.prototype.setAbsolutePosition = function (pos) {\\n        var origTrans = this._clearTransform(), it;\\n        this.attrs.x = origTrans.x;\\n        this.attrs.y = origTrans.y;\\n        delete origTrans.x;\\n        delete origTrans.y;\\n        it = this.getAbsoluteTransform();\\n        it.invert();\\n        it.translate(pos.x, pos.y);\\n        pos = {\\n            x: this.attrs.x + it.getTranslation().x,\\n            y: this.attrs.y + it.getTranslation().y\\n        };\\n        this.setPosition({ x: pos.x, y: pos.y });\\n        this._setTransform(origTrans);\\n        return this;\\n    };\\n    Node.prototype._setTransform = function (trans) {\\n        var key;\\n        for (key in trans) {\\n            this.attrs[key] = trans[key];\\n        }\\n        this._clearCache(TRANSFORM);\\n        this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\\n    };\\n    Node.prototype._clearTransform = function () {\\n        var trans = {\\n            x: this.x(),\\n            y: this.y(),\\n            rotation: this.rotation(),\\n            scaleX: this.scaleX(),\\n            scaleY: this.scaleY(),\\n            offsetX: this.offsetX(),\\n            offsetY: this.offsetY(),\\n            skewX: this.skewX(),\\n            skewY: this.skewY()\\n        };\\n        this.attrs.x = 0;\\n        this.attrs.y = 0;\\n        this.attrs.rotation = 0;\\n        this.attrs.scaleX = 1;\\n        this.attrs.scaleY = 1;\\n        this.attrs.offsetX = 0;\\n        this.attrs.offsetY = 0;\\n        this.attrs.skewX = 0;\\n        this.attrs.skewY = 0;\\n        this._clearCache(TRANSFORM);\\n        this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\\n        return trans;\\n    };\\n    Node.prototype.move = function (change) {\\n        var changeX = change.x, changeY = change.y, x = this.x(), y = this.y();\\n        if (changeX !== undefined) {\\n            x += changeX;\\n        }\\n        if (changeY !== undefined) {\\n            y += changeY;\\n        }\\n        this.setPosition({ x: x, y: y });\\n        return this;\\n    };\\n    Node.prototype._eachAncestorReverse = function (func, top) {\\n        var family = [], parent = this.getParent(), len, n;\\n        if (top && top._id === this._id) {\\n            func(this);\\n            return;\\n        }\\n        family.unshift(this);\\n        while (parent && (!top || parent._id !== top._id)) {\\n            family.unshift(parent);\\n            parent = parent.parent;\\n        }\\n        len = family.length;\\n        for (n = 0; n < len; n++) {\\n            func(family[n]);\\n        }\\n    };\\n    Node.prototype.rotate = function (theta) {\\n        this.rotation(this.rotation() + theta);\\n        return this;\\n    };\\n    Node.prototype.moveToTop = function () {\\n        if (!this.parent) {\\n            Util_1.Util.warn('Node has no parent. moveToTop function is ignored.');\\n            return false;\\n        }\\n        var index = this.index;\\n        this.parent.children.splice(index, 1);\\n        this.parent.children.push(this);\\n        this.parent._setChildrenIndices();\\n        return true;\\n    };\\n    Node.prototype.moveUp = function () {\\n        if (!this.parent) {\\n            Util_1.Util.warn('Node has no parent. moveUp function is ignored.');\\n            return false;\\n        }\\n        var index = this.index, len = this.parent.getChildren().length;\\n        if (index < len - 1) {\\n            this.parent.children.splice(index, 1);\\n            this.parent.children.splice(index + 1, 0, this);\\n            this.parent._setChildrenIndices();\\n            return true;\\n        }\\n        return false;\\n    };\\n    Node.prototype.moveDown = function () {\\n        if (!this.parent) {\\n            Util_1.Util.warn('Node has no parent. moveDown function is ignored.');\\n            return false;\\n        }\\n        var index = this.index;\\n        if (index > 0) {\\n            this.parent.children.splice(index, 1);\\n            this.parent.children.splice(index - 1, 0, this);\\n            this.parent._setChildrenIndices();\\n            return true;\\n        }\\n        return false;\\n    };\\n    Node.prototype.moveToBottom = function () {\\n        if (!this.parent) {\\n            Util_1.Util.warn('Node has no parent. moveToBottom function is ignored.');\\n            return false;\\n        }\\n        var index = this.index;\\n        if (index > 0) {\\n            this.parent.children.splice(index, 1);\\n            this.parent.children.unshift(this);\\n            this.parent._setChildrenIndices();\\n            return true;\\n        }\\n        return false;\\n    };\\n    Node.prototype.setZIndex = function (zIndex) {\\n        if (!this.parent) {\\n            Util_1.Util.warn('Node has no parent. zIndex parameter is ignored.');\\n            return this;\\n        }\\n        if (zIndex < 0 || zIndex >= this.parent.children.length) {\\n            Util_1.Util.warn('Unexpected value ' +\\n                zIndex +\\n                ' for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to ' +\\n                (this.parent.children.length - 1) +\\n                '.');\\n        }\\n        var index = this.index;\\n        this.parent.children.splice(index, 1);\\n        this.parent.children.splice(zIndex, 0, this);\\n        this.parent._setChildrenIndices();\\n        return this;\\n    };\\n    Node.prototype.getAbsoluteOpacity = function () {\\n        return this._getCache(ABSOLUTE_OPACITY, this._getAbsoluteOpacity);\\n    };\\n    Node.prototype._getAbsoluteOpacity = function () {\\n        var absOpacity = this.opacity();\\n        var parent = this.getParent();\\n        if (parent && !parent._isUnderCache) {\\n            absOpacity *= parent.getAbsoluteOpacity();\\n        }\\n        return absOpacity;\\n    };\\n    Node.prototype.moveTo = function (newContainer) {\\n        if (this.getParent() !== newContainer) {\\n            this._remove();\\n            newContainer.add(this);\\n        }\\n        return this;\\n    };\\n    Node.prototype.toObject = function () {\\n        var obj = {}, attrs = this.getAttrs(), key, val, getter, defaultValue, nonPlainObject;\\n        obj.attrs = {};\\n        for (key in attrs) {\\n            val = attrs[key];\\n            nonPlainObject =\\n                Util_1.Util.isObject(val) && !Util_1.Util._isPlainObject(val) && !Util_1.Util._isArray(val);\\n            if (nonPlainObject) {\\n                continue;\\n            }\\n            getter = typeof this[key] === 'function' && this[key];\\n            delete attrs[key];\\n            defaultValue = getter ? getter.call(this) : null;\\n            attrs[key] = val;\\n            if (defaultValue !== val) {\\n                obj.attrs[key] = val;\\n            }\\n        }\\n        obj.className = this.getClassName();\\n        return Util_1.Util._prepareToStringify(obj);\\n    };\\n    Node.prototype.toJSON = function () {\\n        return JSON.stringify(this.toObject());\\n    };\\n    Node.prototype.getParent = function () {\\n        return this.parent;\\n    };\\n    Node.prototype.findAncestors = function (selector, includeSelf, stopNode) {\\n        var res = [];\\n        if (includeSelf && this._isMatch(selector)) {\\n            res.push(this);\\n        }\\n        var ancestor = this.parent;\\n        while (ancestor) {\\n            if (ancestor === stopNode) {\\n                return res;\\n            }\\n            if (ancestor._isMatch(selector)) {\\n                res.push(ancestor);\\n            }\\n            ancestor = ancestor.parent;\\n        }\\n        return res;\\n    };\\n    Node.prototype.isAncestorOf = function (node) {\\n        return false;\\n    };\\n    Node.prototype.findAncestor = function (selector, includeSelf, stopNode) {\\n        return this.findAncestors(selector, includeSelf, stopNode)[0];\\n    };\\n    Node.prototype._isMatch = function (selector) {\\n        if (!selector) {\\n            return false;\\n        }\\n        if (typeof selector === 'function') {\\n            return selector(this);\\n        }\\n        var selectorArr = selector.replace(/ /g, '').split(','), len = selectorArr.length, n, sel;\\n        for (n = 0; n < len; n++) {\\n            sel = selectorArr[n];\\n            if (!Util_1.Util.isValidSelector(sel)) {\\n                Util_1.Util.warn('Selector \\\"' +\\n                    sel +\\n                    '\\\" is invalid. Allowed selectors examples are \\\"#foo\\\", \\\".bar\\\" or \\\"Group\\\".');\\n                Util_1.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like \\\"Triangle\\\".');\\n                Util_1.Util.warn('Konva is awesome, right?');\\n            }\\n            if (sel.charAt(0) === '#') {\\n                if (this.id() === sel.slice(1)) {\\n                    return true;\\n                }\\n            }\\n            else if (sel.charAt(0) === '.') {\\n                if (this.hasName(sel.slice(1))) {\\n                    return true;\\n                }\\n            }\\n            else if (this.className === sel || this.nodeType === sel) {\\n                return true;\\n            }\\n        }\\n        return false;\\n    };\\n    Node.prototype.getLayer = function () {\\n        var parent = this.getParent();\\n        return parent ? parent.getLayer() : null;\\n    };\\n    Node.prototype.getStage = function () {\\n        return this._getCache(STAGE, this._getStage);\\n    };\\n    Node.prototype._getStage = function () {\\n        var parent = this.getParent();\\n        if (parent) {\\n            return parent.getStage();\\n        }\\n        else {\\n            return undefined;\\n        }\\n    };\\n    Node.prototype.fire = function (eventType, evt, bubble) {\\n        evt = evt || {};\\n        evt.target = evt.target || this;\\n        if (bubble) {\\n            this._fireAndBubble(eventType, evt);\\n        }\\n        else {\\n            this._fire(eventType, evt);\\n        }\\n        return this;\\n    };\\n    Node.prototype.getAbsoluteTransform = function (top) {\\n        if (top) {\\n            return this._getAbsoluteTransform(top);\\n        }\\n        else {\\n            return this._getCache(ABSOLUTE_TRANSFORM, this._getAbsoluteTransform);\\n        }\\n    };\\n    Node.prototype._getAbsoluteTransform = function (top) {\\n        var at = new Util_1.Transform();\\n        this._eachAncestorReverse(function (node) {\\n            var transformsEnabled = node.getTransformsEnabled();\\n            if (transformsEnabled === 'all') {\\n                at.multiply(node.getTransform());\\n            }\\n            else if (transformsEnabled === 'position') {\\n                at.translate(node.getX() - node.getOffsetX(), node.getY() - node.getOffsetY());\\n            }\\n        }, top);\\n        return at;\\n    };\\n    Node.prototype.getAbsoluteScale = function (top) {\\n        if (top) {\\n            return this._getAbsoluteScale(top);\\n        }\\n        else {\\n            return this._getCache(ABSOLUTE_SCALE, this._getAbsoluteScale);\\n        }\\n    };\\n    Node.prototype._getAbsoluteScale = function (top) {\\n        var parent = this;\\n        while (parent) {\\n            if (parent._isUnderCache) {\\n                top = parent;\\n            }\\n            parent = parent.getParent();\\n        }\\n        var scaleX = 1, scaleY = 1;\\n        this._eachAncestorReverse(function (node) {\\n            scaleX *= node.scaleX();\\n            scaleY *= node.scaleY();\\n        }, top);\\n        return {\\n            x: scaleX,\\n            y: scaleY\\n        };\\n    };\\n    Node.prototype.getTransform = function () {\\n        return this._getCache(TRANSFORM, this._getTransform);\\n    };\\n    Node.prototype._getTransform = function () {\\n        var m = new Util_1.Transform(), x = this.x(), y = this.y(), rotation = Global_1.Konva.getAngle(this.rotation()), scaleX = this.scaleX(), scaleY = this.scaleY(), skewX = this.skewX(), skewY = this.skewY(), offsetX = this.offsetX(), offsetY = this.offsetY();\\n        if (x !== 0 || y !== 0) {\\n            m.translate(x, y);\\n        }\\n        if (rotation !== 0) {\\n            m.rotate(rotation);\\n        }\\n        if (skewX !== 0 || skewY !== 0) {\\n            m.skew(skewX, skewY);\\n        }\\n        if (scaleX !== 1 || scaleY !== 1) {\\n            m.scale(scaleX, scaleY);\\n        }\\n        if (offsetX !== 0 || offsetY !== 0) {\\n            m.translate(-1 * offsetX, -1 * offsetY);\\n        }\\n        return m;\\n    };\\n    Node.prototype.clone = function (obj) {\\n        var attrs = Util_1.Util.cloneObject(this.attrs), key, allListeners, len, n, listener;\\n        for (var i in CLONE_BLACK_LIST) {\\n            var blockAttr = CLONE_BLACK_LIST[i];\\n            delete attrs[blockAttr];\\n        }\\n        for (key in obj) {\\n            attrs[key] = obj[key];\\n        }\\n        var node = new this.constructor(attrs);\\n        for (key in this.eventListeners) {\\n            allListeners = this.eventListeners[key];\\n            len = allListeners.length;\\n            for (n = 0; n < len; n++) {\\n                listener = allListeners[n];\\n                if (listener.name.indexOf(KONVA) < 0) {\\n                    if (!node.eventListeners[key]) {\\n                        node.eventListeners[key] = [];\\n                    }\\n                    node.eventListeners[key].push(listener);\\n                }\\n            }\\n        }\\n        return node;\\n    };\\n    Node.prototype._toKonvaCanvas = function (config) {\\n        config = config || {};\\n        var box = this.getClientRect();\\n        var stage = this.getStage(), x = config.x !== undefined ? config.x : box.x, y = config.y !== undefined ? config.y : box.y, pixelRatio = config.pixelRatio || 1, canvas = new Canvas_1.SceneCanvas({\\n            width: config.width || box.width || (stage ? stage.width() : 0),\\n            height: config.height || box.height || (stage ? stage.height() : 0),\\n            pixelRatio: pixelRatio\\n        }), context = canvas.getContext();\\n        context.save();\\n        if (x || y) {\\n            context.translate(-1 * x, -1 * y);\\n        }\\n        this.drawScene(canvas);\\n        context.restore();\\n        return canvas;\\n    };\\n    Node.prototype.toCanvas = function (config) {\\n        return this._toKonvaCanvas(config)._canvas;\\n    };\\n    Node.prototype.toDataURL = function (config) {\\n        config = config || {};\\n        var mimeType = config.mimeType || null, quality = config.quality || null;\\n        var url = this._toKonvaCanvas(config).toDataURL(mimeType, quality);\\n        if (config.callback) {\\n            config.callback(url);\\n        }\\n        return url;\\n    };\\n    Node.prototype.toImage = function (config) {\\n        if (!config || !config.callback) {\\n            throw 'callback required for toImage method config argument';\\n        }\\n        var callback = config.callback;\\n        delete config.callback;\\n        Util_1.Util._urlToImage(this.toDataURL(config), function (img) {\\n            callback(img);\\n        });\\n    };\\n    Node.prototype.setSize = function (size) {\\n        this.width(size.width);\\n        this.height(size.height);\\n        return this;\\n    };\\n    Node.prototype.getSize = function () {\\n        return {\\n            width: this.width(),\\n            height: this.height()\\n        };\\n    };\\n    Node.prototype.getClassName = function () {\\n        return this.className || this.nodeType;\\n    };\\n    Node.prototype.getType = function () {\\n        return this.nodeType;\\n    };\\n    Node.prototype.getDragDistance = function () {\\n        if (this.attrs.dragDistance !== undefined) {\\n            return this.attrs.dragDistance;\\n        }\\n        else if (this.parent) {\\n            return this.parent.getDragDistance();\\n        }\\n        else {\\n            return Global_1.Konva.dragDistance;\\n        }\\n    };\\n    Node.prototype._off = function (type, name, callback) {\\n        var evtListeners = this.eventListeners[type], i, evtName, handler;\\n        for (i = 0; i < evtListeners.length; i++) {\\n            evtName = evtListeners[i].name;\\n            handler = evtListeners[i].handler;\\n            if ((evtName !== 'konva' || name === 'konva') &&\\n                (!name || evtName === name) &&\\n                (!callback || callback === handler)) {\\n                evtListeners.splice(i, 1);\\n                if (evtListeners.length === 0) {\\n                    delete this.eventListeners[type];\\n                    break;\\n                }\\n                i--;\\n            }\\n        }\\n    };\\n    Node.prototype._fireChangeEvent = function (attr, oldVal, newVal) {\\n        this._fire(attr + CHANGE, {\\n            oldVal: oldVal,\\n            newVal: newVal\\n        });\\n    };\\n    Node.prototype.setId = function (id) {\\n        var oldId = this.id();\\n        exports._removeId(oldId, this);\\n        _addId(this, id);\\n        this._setAttr('id', id);\\n        return this;\\n    };\\n    Node.prototype.setName = function (name) {\\n        var oldNames = (this.name() || '').split(/\\\\s/g);\\n        var newNames = (name || '').split(/\\\\s/g);\\n        var subname, i;\\n        for (i = 0; i < oldNames.length; i++) {\\n            subname = oldNames[i];\\n            if (newNames.indexOf(subname) === -1 && subname) {\\n                exports._removeName(subname, this._id);\\n            }\\n        }\\n        for (i = 0; i < newNames.length; i++) {\\n            subname = newNames[i];\\n            if (oldNames.indexOf(subname) === -1 && subname) {\\n                exports._addName(this, subname);\\n            }\\n        }\\n        this._setAttr(NAME, name);\\n        return this;\\n    };\\n    Node.prototype.addName = function (name) {\\n        if (!this.hasName(name)) {\\n            var oldName = this.name();\\n            var newName = oldName ? oldName + ' ' + name : name;\\n            this.setName(newName);\\n        }\\n        return this;\\n    };\\n    Node.prototype.hasName = function (name) {\\n        if (!name) {\\n            return false;\\n        }\\n        var fullName = this.name();\\n        if (!fullName) {\\n            return false;\\n        }\\n        var names = (fullName || '').split(/\\\\s/g);\\n        return names.indexOf(name) !== -1;\\n    };\\n    Node.prototype.removeName = function (name) {\\n        var names = (this.name() || '').split(/\\\\s/g);\\n        var index = names.indexOf(name);\\n        if (index !== -1) {\\n            names.splice(index, 1);\\n            this.setName(names.join(' '));\\n        }\\n        return this;\\n    };\\n    Node.prototype.setAttr = function (attr, val) {\\n        var func = this[SET + Util_1.Util._capitalize(attr)];\\n        if (Util_1.Util._isFunction(func)) {\\n            func.call(this, val);\\n        }\\n        else {\\n            this._setAttr(attr, val);\\n        }\\n        return this;\\n    };\\n    Node.prototype._setAttr = function (key, val) {\\n        var oldVal = this.attrs[key];\\n        if (oldVal === val && !Util_1.Util.isObject(val)) {\\n            return;\\n        }\\n        if (val === undefined || val === null) {\\n            delete this.attrs[key];\\n        }\\n        else {\\n            this.attrs[key] = val;\\n        }\\n        this._fireChangeEvent(key, oldVal, val);\\n    };\\n    Node.prototype._setComponentAttr = function (key, component, val) {\\n        var oldVal;\\n        if (val !== undefined) {\\n            oldVal = this.attrs[key];\\n            if (!oldVal) {\\n                this.attrs[key] = this.getAttr(key);\\n            }\\n            this.attrs[key][component] = val;\\n            this._fireChangeEvent(key, oldVal, val);\\n        }\\n    };\\n    Node.prototype._fireAndBubble = function (eventType, evt, compareShape) {\\n        if (evt && this.nodeType === SHAPE) {\\n            evt.target = this;\\n        }\\n        var shouldStop = (eventType === MOUSEENTER || eventType === MOUSELEAVE) &&\\n            ((compareShape &&\\n                (this === compareShape ||\\n                    (this.isAncestorOf && this.isAncestorOf(compareShape)))) ||\\n                (this.nodeType === 'Stage' && !compareShape));\\n        if (!shouldStop) {\\n            this._fire(eventType, evt);\\n            var stopBubble = (eventType === MOUSEENTER || eventType === MOUSELEAVE) &&\\n                (compareShape &&\\n                    compareShape.isAncestorOf &&\\n                    compareShape.isAncestorOf(this) &&\\n                    !compareShape.isAncestorOf(this.parent));\\n            if (((evt && !evt.cancelBubble) || !evt) &&\\n                this.parent &&\\n                this.parent.isListening() &&\\n                !stopBubble) {\\n                if (compareShape && compareShape.parent) {\\n                    this._fireAndBubble.call(this.parent, eventType, evt, compareShape.parent);\\n                }\\n                else {\\n                    this._fireAndBubble.call(this.parent, eventType, evt);\\n                }\\n            }\\n        }\\n    };\\n    Node.prototype._fire = function (eventType, evt) {\\n        var events = this.eventListeners[eventType], i;\\n        if (events) {\\n            evt = evt || {};\\n            evt.currentTarget = this;\\n            evt.type = eventType;\\n            for (i = 0; i < events.length; i++) {\\n                events[i].handler.call(this, evt);\\n            }\\n        }\\n    };\\n    Node.prototype.draw = function () {\\n        this.drawScene();\\n        this.drawHit();\\n        return this;\\n    };\\n    Node.prototype._createDragElement = function (evt) {\\n        var pointerId = evt ? evt.pointerId : undefined;\\n        var stage = this.getStage();\\n        var ap = this.getAbsolutePosition();\\n        var pos = stage._getPointerById(pointerId) ||\\n            stage._changedPointerPositions[0] ||\\n            ap;\\n        DragAndDrop_1.DD._dragElements.set(this._id, {\\n            node: this,\\n            startPointerPos: pos,\\n            offset: {\\n                x: pos.x - ap.x,\\n                y: pos.y - ap.y\\n            },\\n            dragStatus: 'ready',\\n            pointerId: pointerId\\n        });\\n    };\\n    Node.prototype.startDrag = function (evt) {\\n        if (!DragAndDrop_1.DD._dragElements.has(this._id)) {\\n            this._createDragElement(evt);\\n        }\\n        var elem = DragAndDrop_1.DD._dragElements.get(this._id);\\n        elem.dragStatus = 'dragging';\\n        this.fire('dragstart', {\\n            type: 'dragstart',\\n            target: this,\\n            evt: evt && evt.evt\\n        }, true);\\n    };\\n    Node.prototype._setDragPosition = function (evt, elem) {\\n        var pos = this.getStage()._getPointerById(elem.pointerId);\\n        var dbf = this.dragBoundFunc();\\n        if (!pos) {\\n            return;\\n        }\\n        var newNodePos = {\\n            x: pos.x - elem.offset.x,\\n            y: pos.y - elem.offset.y\\n        };\\n        if (dbf !== undefined) {\\n            newNodePos = dbf.call(this, newNodePos, evt);\\n        }\\n        if (!this._lastPos ||\\n            this._lastPos.x !== newNodePos.x ||\\n            this._lastPos.y !== newNodePos.y) {\\n            this.setAbsolutePosition(newNodePos);\\n            if (this.getLayer()) {\\n                this.getLayer().batchDraw();\\n            }\\n            else if (this.getStage()) {\\n                this.getStage().batchDraw();\\n            }\\n        }\\n        this._lastPos = newNodePos;\\n    };\\n    Node.prototype.stopDrag = function (evt) {\\n        var elem = DragAndDrop_1.DD._dragElements.get(this._id);\\n        if (elem) {\\n            elem.dragStatus = 'stopped';\\n        }\\n        DragAndDrop_1.DD._endDragBefore(evt);\\n        DragAndDrop_1.DD._endDragAfter(evt);\\n    };\\n    Node.prototype.setDraggable = function (draggable) {\\n        this._setAttr('draggable', draggable);\\n        this._dragChange();\\n    };\\n    Node.prototype.isDragging = function () {\\n        var elem = DragAndDrop_1.DD._dragElements.get(this._id);\\n        return elem ? elem.dragStatus === 'dragging' : false;\\n    };\\n    Node.prototype._listenDrag = function () {\\n        this._dragCleanup();\\n        this.on('mousedown.konva touchstart.konva', function (evt) {\\n            var _this = this;\\n            var shouldCheckButton = evt.evt['button'] !== undefined;\\n            var canDrag = !shouldCheckButton || Global_1.Konva.dragButtons.indexOf(evt.evt['button']) >= 0;\\n            if (!canDrag) {\\n                return;\\n            }\\n            if (this.isDragging()) {\\n                return;\\n            }\\n            var hasDraggingChild = false;\\n            DragAndDrop_1.DD._dragElements.forEach(function (elem) {\\n                if (_this.isAncestorOf(elem.node)) {\\n                    hasDraggingChild = true;\\n                }\\n            });\\n            if (!hasDraggingChild) {\\n                this._createDragElement(evt);\\n            }\\n        });\\n    };\\n    Node.prototype._dragChange = function () {\\n        if (this.attrs.draggable) {\\n            this._listenDrag();\\n        }\\n        else {\\n            this._dragCleanup();\\n            var stage = this.getStage();\\n            if (stage && DragAndDrop_1.DD._dragElements.has(this._id)) {\\n                this.stopDrag();\\n            }\\n        }\\n    };\\n    Node.prototype._dragCleanup = function () {\\n        this.off('mousedown.konva');\\n        this.off('touchstart.konva');\\n    };\\n    Node.create = function (data, container) {\\n        if (Util_1.Util._isString(data)) {\\n            data = JSON.parse(data);\\n        }\\n        return this._createNode(data, container);\\n    };\\n    Node._createNode = function (obj, container) {\\n        var className = Node.prototype.getClassName.call(obj), children = obj.children, no, len, n;\\n        if (container) {\\n            obj.attrs.container = container;\\n        }\\n        if (!Global_1._NODES_REGISTRY[className]) {\\n            Util_1.Util.warn('Can not find a node with class name \\\"' +\\n                className +\\n                '\\\". Fallback to \\\"Shape\\\".');\\n            className = 'Shape';\\n        }\\n        var Class = Global_1._NODES_REGISTRY[className];\\n        no = new Class(obj.attrs);\\n        if (children) {\\n            len = children.length;\\n            for (n = 0; n < len; n++) {\\n                no.add(Node._createNode(children[n]));\\n            }\\n        }\\n        return no;\\n    };\\n    return Node;\\n}());\\nexports.Node = Node;\\nNode.prototype.nodeType = 'Node';\\nNode.prototype._attrsAffectingSize = [];\\nFactory_1.Factory.addGetterSetter(Node, 'zIndex');\\nFactory_1.Factory.addGetterSetter(Node, 'absolutePosition');\\nFactory_1.Factory.addGetterSetter(Node, 'position');\\nFactory_1.Factory.addGetterSetter(Node, 'x', 0, Validators_1.getNumberValidator());\\nFactory_1.Factory.addGetterSetter(Node, 'y', 0, Validators_1.getNumberValidator());\\nFactory_1.Factory.addGetterSetter(Node, 'globalCompositeOperation', 'source-over', Validators_1.getStringValidator());\\nFactory_1.Factory.addGetterSetter(Node, 'opacity', 1, Validators_1.getNumberValidator());\\nFactory_1.Factory.addGetterSetter(Node, 'name', '', Validators_1.getStringValidator());\\nFactory_1.Factory.addGetterSetter(Node, 'id', '', Validators_1.getStringValidator());\\nFactory_1.Factory.addGetterSetter(Node, 'rotation', 0, Validators_1.getNumberValidator());\\nFactory_1.Factory.addComponentsGetterSetter(Node, 'scale', ['x', 'y']);\\nFactory_1.Factory.addGetterSetter(Node, 'scaleX', 1, Validators_1.getNumberValidator());\\nFactory_1.Factory.addGetterSetter(Node, 'scaleY', 1, Validators_1.getNumberValidator());\\nFactory_1.Factory.addComponentsGetterSetter(Node, 'skew', ['x', 'y']);\\nFactory_1.Factory.addGetterSetter(Node, 'skewX', 0, Validators_1.getNumberValidator());\\nFactory_1.Factory.addGetterSetter(Node, 'skewY', 0, Validators_1.getNumberValidator());\\nFactory_1.Factory.addComponentsGetterSetter(Node, 'offset', ['x', 'y']);\\nFactory_1.Factory.addGetterSetter(Node, 'offsetX', 0, Validators_1.getNumberValidator());\\nFactory_1.Factory.addGetterSetter(Node, 'offsetY', 0, Validators_1.getNumberValidator());\\nFactory_1.Factory.addGetterSetter(Node, 'dragDistance', null, Validators_1.getNumberValidator());\\nFactory_1.Factory.addGetterSetter(Node, 'width', 0, Validators_1.getNumberValidator());\\nFactory_1.Factory.addGetterSetter(Node, 'height', 0, Validators_1.getNumberValidator());\\nFactory_1.Factory.addGetterSetter(Node, 'listening', 'inherit', function (val) {\\n    var isValid = val === true || val === false || val === 'inherit';\\n    if (!isValid) {\\n        Util_1.Util.warn(val +\\n            ' is a not valid value for \\\"listening\\\" attribute. The value may be true, false or \\\"inherit\\\".');\\n    }\\n    return val;\\n});\\nFactory_1.Factory.addGetterSetter(Node, 'preventDefault', true, Validators_1.getBooleanValidator());\\nFactory_1.Factory.addGetterSetter(Node, 'filters', null, function (val) {\\n    this._filterUpToDate = false;\\n    return val;\\n});\\nFactory_1.Factory.addGetterSetter(Node, 'visible', 'inherit', function (val) {\\n    var isValid = val === true || val === false || val === 'inherit';\\n    if (!isValid) {\\n        Util_1.Util.warn(val +\\n            ' is a not valid value for \\\"visible\\\" attribute. The value may be true, false or \\\"inherit\\\".');\\n    }\\n    return val;\\n});\\nFactory_1.Factory.addGetterSetter(Node, 'transformsEnabled', 'all', Validators_1.getStringValidator());\\nFactory_1.Factory.addGetterSetter(Node, 'size');\\nFactory_1.Factory.addGetterSetter(Node, 'dragBoundFunc');\\nFactory_1.Factory.addGetterSetter(Node, 'draggable', false, Validators_1.getBooleanValidator());\\nFactory_1.Factory.backCompat(Node, {\\n    rotateDeg: 'rotate',\\n    setRotationDeg: 'setRotation',\\n    getRotationDeg: 'getRotation'\\n});\\nUtil_1.Collection.mapMethods(Node);\\n\\n};\"],\n\"names\":[\"shadow$provide\",\"global\",\"require\",\"module\",\"exports\",\"Object\",\"defineProperty\",\"value\",\"Util_1\",\"Factory_1\",\"Canvas_1\",\"Global_1\",\"DragAndDrop_1\",\"Validators_1\",\"ids\",\"names\",\"_removeId\",\"exports._removeId\",\"id\",\"node\",\"_addName\",\"exports._addName\",\"name\",\"push\",\"_removeName\",\"exports._removeName\",\"_id\",\"nodes\",\"n\",\"length\",\"no\",\"splice\",\"CLONE_BLACK_LIST\",\"emptyChildren\",\"Collection\",\"idCounter\",\"Node\",\"config\",\"_this\",\"eventListeners\",\"attrs\",\"index\",\"parent\",\"_cache\",\"Map\",\"_lastPos\",\"_isUnderCache\",\"_filterUpToDate\",\"children\",\"_dragEventId\",\"setAttrs\",\"on\",\"TRANSFORM_CHANGE_STR\",\"_clearCache\",\"TRANSFORM\",\"_clearSelfAndDescendantCache\",\"ABSOLUTE_TRANSFORM\",\"SCALE_CHANGE_STR\",\"ABSOLUTE_SCALE\",\"VISIBLE\",\"LISTENING\",\"ABSOLUTE_OPACITY\",\"prototype\",\"hasChildren\",\"Node.prototype.hasChildren\",\"getChildren\",\"Node.prototype.getChildren\",\"Node.prototype._clearCache\",\"attr\",\"delete\",\"clear\",\"_getCache\",\"Node.prototype._getCache\",\"privateGetter\",\"cache\",\"get\",\"undefined\",\"call\",\"set\",\"_getCanvasCache\",\"Node.prototype._getCanvasCache\",\"CANVAS\",\"Node.prototype._clearSelfAndDescendantCache\",\"each\",\"clearCache\",\"Node.prototype.clearCache\",\"Node.prototype.cache\",\"conf\",\"rect\",\"x\",\"y\",\"width\",\"height\",\"getClientRect\",\"skipTransform\",\"relativeTo\",\"getParent\",\"pixelRatio\",\"offset\",\"drawBorder\",\"cachedSceneCanvas\",\"SceneCanvas\",\"cachedFilterCanvas\",\"cachedHitCanvas\",\"HitCanvas\",\"sceneContext\",\"getContext\",\"hitContext\",\"isCache\",\"imageSmoothingEnabled\",\"_context\",\"save\",\"translate\",\"drawScene\",\"drawHit\",\"restore\",\"beginPath\",\"closePath\",\"setAttr\",\"stroke\",\"scene\",\"filter\",\"hit\",\"Util\",\"error\",\"isCached\",\"Node.prototype.isCached\",\"has\",\"Node.prototype.getClientRect\",\"Error\",\"_transformedRect\",\"Node.prototype._transformedRect\",\"top\",\"points\",\"minX\",\"minY\",\"maxX\",\"maxY\",\"trans\",\"getAbsoluteTransform\",\"forEach\",\"point\",\"transformed\",\"Math\",\"min\",\"max\",\"_drawCachedSceneCanvas\",\"Node.prototype._drawCachedSceneCanvas\",\"context\",\"_applyOpacity\",\"_applyGlobalCompositeOperation\",\"canvasCache\",\"cacheCanvas\",\"_getCachedSceneCanvas\",\"ratio\",\"drawImage\",\"_canvas\",\"_drawCachedHitCanvas\",\"Node.prototype._drawCachedHitCanvas\",\"hitCanvas\",\"Node.prototype._getCachedSceneCanvas\",\"filters\",\"cachedCanvas\",\"sceneCanvas\",\"filterCanvas\",\"filterContext\",\"len\",\"getWidth\",\"getHeight\",\"imageData\",\"getImageData\",\"putImageData\",\"e\",\"message\",\"Node.prototype.on\",\"evtStr\",\"handler\",\"arguments\",\"_delegate\",\"apply\",\"events\",\"split\",\"SPACE\",\"event\",\"parts\",\"baseEvent\",\"off\",\"Node.prototype.off\",\"callback\",\"t\",\"_off\",\"dispatchEvent\",\"Node.prototype.dispatchEvent\",\"evt\",\"fire\",\"type\",\"target\",\"addEventListener\",\"Node.prototype.addEventListener\",\"removeEventListener\",\"Node.prototype.removeEventListener\",\"Node.prototype._delegate\",\"selector\",\"stopNode\",\"targets\",\"findAncestors\",\"i\",\"cloneObject\",\"currentTarget\",\"remove\",\"Node.prototype.remove\",\"isDragging\",\"stopDrag\",\"DD\",\"_dragElements\",\"_remove\",\"Node.prototype._remove\",\"STAGE\",\"_setChildrenIndices\",\"destroy\",\"Node.prototype.destroy\",\"subname\",\"getAttr\",\"Node.prototype.getAttr\",\"method\",\"_capitalize\",\"_isFunction\",\"getAncestors\",\"Node.prototype.getAncestors\",\"ancestors\",\"getAttrs\",\"Node.prototype.getAttrs\",\"Node.prototype.setAttrs\",\"key\",\"CHILDREN\",\"SET\",\"_setAttr\",\"isListening\",\"Node.prototype.isListening\",\"_isListening\",\"Node.prototype._isListening\",\"listening\",\"isVisible\",\"Node.prototype.isVisible\",\"_isVisible\",\"Node.prototype._isVisible\",\"visible\",\"shouldDrawHit\",\"Node.prototype.shouldDrawHit\",\"layer\",\"getLayer\",\"hitGraphEnabled\",\"show\",\"Node.prototype.show\",\"hide\",\"Node.prototype.hide\",\"getZIndex\",\"Node.prototype.getZIndex\",\"getAbsoluteZIndex\",\"Node.prototype.getAbsoluteZIndex\",\"addChildren\",\"child\",\"SHAPE\",\"nodeType\",\"concat\",\"toArray\",\"that\",\"getDepth\",\"depth\",\"UPPER_STAGE\",\"getStage\",\"Node.prototype.getDepth\",\"setPosition\",\"Node.prototype.setPosition\",\"pos\",\"getPosition\",\"Node.prototype.getPosition\",\"getAbsolutePosition\",\"Node.prototype.getAbsolutePosition\",\"absoluteMatrix\",\"getMatrix\",\"absoluteTransform\",\"Transform\",\"m\",\"slice\",\"getTranslation\",\"setAbsolutePosition\",\"Node.prototype.setAbsolutePosition\",\"origTrans\",\"_clearTransform\",\"it\",\"invert\",\"_setTransform\",\"Node.prototype._setTransform\",\"Node.prototype._clearTransform\",\"rotation\",\"scaleX\",\"scaleY\",\"offsetX\",\"offsetY\",\"skewX\",\"skewY\",\"move\",\"Node.prototype.move\",\"change\",\"changeX\",\"changeY\",\"_eachAncestorReverse\",\"Node.prototype._eachAncestorReverse\",\"func\",\"family\",\"unshift\",\"rotate\",\"Node.prototype.rotate\",\"theta\",\"moveToTop\",\"Node.prototype.moveToTop\",\"warn\",\"moveUp\",\"Node.prototype.moveUp\",\"moveDown\",\"Node.prototype.moveDown\",\"moveToBottom\",\"Node.prototype.moveToBottom\",\"setZIndex\",\"Node.prototype.setZIndex\",\"zIndex\",\"getAbsoluteOpacity\",\"Node.prototype.getAbsoluteOpacity\",\"_getAbsoluteOpacity\",\"Node.prototype._getAbsoluteOpacity\",\"absOpacity\",\"opacity\",\"moveTo\",\"Node.prototype.moveTo\",\"newContainer\",\"add\",\"toObject\",\"Node.prototype.toObject\",\"obj\",\"val\",\"nonPlainObject\",\"isObject\",\"_isPlainObject\",\"_isArray\",\"getter\",\"defaultValue\",\"className\",\"getClassName\",\"_prepareToStringify\",\"toJSON\",\"Node.prototype.toJSON\",\"JSON\",\"stringify\",\"Node.prototype.getParent\",\"Node.prototype.findAncestors\",\"includeSelf\",\"res\",\"_isMatch\",\"ancestor\",\"isAncestorOf\",\"Node.prototype.isAncestorOf\",\"findAncestor\",\"Node.prototype.findAncestor\",\"Node.prototype._isMatch\",\"selectorArr\",\"replace\",\"sel\",\"isValidSelector\",\"charAt\",\"hasName\",\"Node.prototype.getLayer\",\"Node.prototype.getStage\",\"_getStage\",\"Node.prototype._getStage\",\"Node.prototype.fire\",\"eventType\",\"bubble\",\"_fireAndBubble\",\"_fire\",\"Node.prototype.getAbsoluteTransform\",\"_getAbsoluteTransform\",\"Node.prototype._getAbsoluteTransform\",\"at\",\"transformsEnabled\",\"getTransformsEnabled\",\"multiply\",\"getTransform\",\"getX\",\"getOffsetX\",\"getY\",\"getOffsetY\",\"getAbsoluteScale\",\"Node.prototype.getAbsoluteScale\",\"_getAbsoluteScale\",\"Node.prototype._getAbsoluteScale\",\"Node.prototype.getTransform\",\"_getTransform\",\"Node.prototype._getTransform\",\"Konva\",\"getAngle\",\"skew\",\"scale\",\"clone\",\"Node.prototype.clone\",\"blockAttr\",\"constructor\",\"allListeners\",\"listener\",\"indexOf\",\"KONVA\",\"_toKonvaCanvas\",\"Node.prototype._toKonvaCanvas\",\"box\",\"stage\",\"canvas\",\"toCanvas\",\"Node.prototype.toCanvas\",\"toDataURL\",\"Node.prototype.toDataURL\",\"mimeType\",\"quality\",\"url\",\"toImage\",\"Node.prototype.toImage\",\"_urlToImage\",\"img\",\"setSize\",\"Node.prototype.setSize\",\"size\",\"getSize\",\"Node.prototype.getSize\",\"Node.prototype.getClassName\",\"getType\",\"Node.prototype.getType\",\"getDragDistance\",\"Node.prototype.getDragDistance\",\"dragDistance\",\"Node.prototype._off\",\"evtListeners\",\"evtName\",\"_fireChangeEvent\",\"Node.prototype._fireChangeEvent\",\"oldVal\",\"newVal\",\"CHANGE\",\"setId\",\"Node.prototype.setId\",\"oldId\",\"setName\",\"Node.prototype.setName\",\"oldNames\",\"newNames\",\"NAME\",\"addName\",\"Node.prototype.addName\",\"oldName\",\"newName\",\"Node.prototype.hasName\",\"fullName\",\"removeName\",\"Node.prototype.removeName\",\"join\",\"Node.prototype.setAttr\",\"Node.prototype._setAttr\",\"_setComponentAttr\",\"Node.prototype._setComponentAttr\",\"component\",\"Node.prototype._fireAndBubble\",\"compareShape\",\"MOUSEENTER\",\"MOUSELEAVE\",\"stopBubble\",\"cancelBubble\",\"Node.prototype._fire\",\"draw\",\"Node.prototype.draw\",\"_createDragElement\",\"Node.prototype._createDragElement\",\"pointerId\",\"ap\",\"_getPointerById\",\"_changedPointerPositions\",\"startPointerPos\",\"dragStatus\",\"startDrag\",\"Node.prototype.startDrag\",\"elem\",\"_setDragPosition\",\"Node.prototype._setDragPosition\",\"dbf\",\"dragBoundFunc\",\"newNodePos\",\"batchDraw\",\"Node.prototype.stopDrag\",\"_endDragBefore\",\"_endDragAfter\",\"setDraggable\",\"Node.prototype.setDraggable\",\"draggable\",\"_dragChange\",\"Node.prototype.isDragging\",\"_listenDrag\",\"Node.prototype._listenDrag\",\"_dragCleanup\",\"dragButtons\",\"hasDraggingChild\",\"Node.prototype._dragChange\",\"Node.prototype._dragCleanup\",\"create\",\"Node.create\",\"data\",\"container\",\"_isString\",\"parse\",\"_createNode\",\"Node._createNode\",\"_NODES_REGISTRY\",\"Class\",\"_attrsAffectingSize\",\"Factory\",\"addGetterSetter\",\"getNumberValidator\",\"getStringValidator\",\"addComponentsGetterSetter\",\"getBooleanValidator\",\"backCompat\",\"rotateDeg\",\"setRotationDeg\",\"getRotationDeg\",\"mapMethods\"]\n}\n"]