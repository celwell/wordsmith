shadow$provide.module$node_modules$konva$lib$Shape=function(global,require,module,exports){function getDummyContext(){return dummyContext?dummyContext:dummyContext=Util_1.Util.createCanvasElement().getContext("2d")}function _clearHasShadowCache(){this._clearCache("hasShadow")}function _clearGetShadowRGBACache(){this._clearCache("shadowRGBA")}function _clearFillPatternCache(){this._clearCache("patternImage")}function _clearLinearGradientCache(){this._clearCache("linearGradient")}function _clearRadialGradientCache(){this._clearCache("radialGradient")}
var __extends=this&&this.__extends||function(){var extendStatics=function(d$jscomp$0,b$jscomp$0){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return extendStatics(d$jscomp$0,b$jscomp$0)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});
var Util_1=require("module$node_modules$konva$lib$Util");global=require("module$node_modules$konva$lib$Factory");var Node_1=require("module$node_modules$konva$lib$Node");module=require("module$node_modules$konva$lib$Validators");var Global_1=require("module$node_modules$konva$lib$Global"),PointerEvents=require("module$node_modules$konva$lib$PointerEvents"),dummyContext;exports.shapes={};require=function(_super){function Shape(config){config=_super.call(this,config)||this;for(var key;!(key=Util_1.Util.getRandomColor())||
key in exports.shapes;);config.colorKey=key;exports.shapes[key]=config;config.on("shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",_clearHasShadowCache);config.on("shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",_clearGetShadowRGBACache);config.on("fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva",_clearFillPatternCache);
config.on("fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",_clearLinearGradientCache);config.on("fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",
_clearRadialGradientCache);return config}__extends(Shape,_super);Shape.prototype.getContext=function(){return this.getLayer().getContext()};Shape.prototype.getCanvas=function(){return this.getLayer().getCanvas()};Shape.prototype.getSceneFunc=function(){return this.attrs.sceneFunc||this._sceneFunc};Shape.prototype.getHitFunc=function(){return this.attrs.hitFunc||this._hitFunc};Shape.prototype.hasShadow=function(){return this._getCache("hasShadow",this._hasShadow)};Shape.prototype._hasShadow=function(){return this.shadowEnabled()&&
0!==this.shadowOpacity()&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())};Shape.prototype._getFillPattern=function(){return this._getCache("patternImage",this.__getFillPattern)};Shape.prototype.__getFillPattern=function(){if(this.fillPatternImage())return getDummyContext().createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat")};Shape.prototype._getLinearGradient=function(){return this._getCache("linearGradient",this.__getLinearGradient)};Shape.prototype.__getLinearGradient=
function(){var colorStops=this.fillLinearGradientColorStops();if(colorStops){var ctx=getDummyContext(),start=this.fillLinearGradientStartPoint(),end=this.fillLinearGradientEndPoint();ctx=ctx.createLinearGradient(start.x,start.y,end.x,end.y);for(start=0;start<colorStops.length;start+=2)ctx.addColorStop(colorStops[start],colorStops[start+1]);return ctx}};Shape.prototype._getRadialGradient=function(){return this._getCache("radialGradient",this.__getRadialGradient)};Shape.prototype.__getRadialGradient=
function(){var colorStops=this.fillRadialGradientColorStops();if(colorStops){var ctx=getDummyContext(),start=this.fillRadialGradientStartPoint(),end=this.fillRadialGradientEndPoint();ctx=ctx.createRadialGradient(start.x,start.y,this.fillRadialGradientStartRadius(),end.x,end.y,this.fillRadialGradientEndRadius());for(start=0;start<colorStops.length;start+=2)ctx.addColorStop(colorStops[start],colorStops[start+1]);return ctx}};Shape.prototype.getShadowRGBA=function(){return this._getCache("shadowRGBA",
this._getShadowRGBA)};Shape.prototype._getShadowRGBA=function(){if(this.hasShadow()){var rgba=Util_1.Util.colorToRGBA(this.shadowColor());return"rgba("+rgba.r+","+rgba.g+","+rgba.b+","+rgba.a*(this.shadowOpacity()||1)+")"}};Shape.prototype.hasFill=function(){return!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops())};Shape.prototype.hasStroke=function(){return this.strokeEnabled()&&this.strokeWidth()&&!(!this.stroke()&&!this.strokeLinearGradientColorStops())};
Shape.prototype.intersects=function(point){var bufferHitCanvas=this.getStage().bufferHitCanvas;bufferHitCanvas.getContext().clear();this.drawHit(bufferHitCanvas);return 0<bufferHitCanvas.context.getImageData(Math.round(point.x),Math.round(point.y),1,1).data[3]};Shape.prototype.destroy=function(){Node_1.Node.prototype.destroy.call(this);delete exports.shapes[this.colorKey];delete this.colorKey;return this};Shape.prototype._useBufferCanvas=function(caching){return!(caching&&!this.hasShadow()||!this.perfectDrawEnabled()||
1===this.getAbsoluteOpacity()||!this.hasFill()||!this.hasStroke()||!this.getStage())};Shape.prototype.setStrokeHitEnabled=function(val){val?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)};Shape.prototype.getStrokeHitEnabled=function(){return 0===this.hitStrokeWidth()?!1:!0};Shape.prototype.getSelfRect=function(){var size=this.size();return{x:this._centroid?Math.round(-size.width/2):0,y:this._centroid?Math.round(-size.height/2):0,width:size.width,height:size.height}};Shape.prototype.getClientRect=
function(attrs){attrs=attrs||{};var skipTransform=attrs.skipTransform,relativeTo=attrs.relativeTo,fillRect=this.getSelfRect(),strokeWidth=!attrs.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,fillAndStrokeWidth=fillRect.width+strokeWidth,fillAndStrokeHeight=fillRect.height+strokeWidth,applyShadow=!attrs.skipShadow&&this.hasShadow();attrs=applyShadow?this.shadowOffsetX():0;var shadowOffsetY=applyShadow?this.shadowOffsetY():0;fillAndStrokeWidth+=Math.abs(attrs);fillAndStrokeHeight+=Math.abs(shadowOffsetY);
applyShadow=applyShadow&&this.shadowBlur()||0;var roundingOffset=0;Math.round(strokeWidth/2)!==strokeWidth/2&&(roundingOffset=1);fillRect={width:fillAndStrokeWidth+2*applyShadow+roundingOffset,height:fillAndStrokeHeight+2*applyShadow+roundingOffset,x:-Math.round(strokeWidth/2+applyShadow)+Math.min(attrs,0)+fillRect.x,y:-Math.round(strokeWidth/2+applyShadow)+Math.min(shadowOffsetY,0)+fillRect.y};return skipTransform?fillRect:this._transformedRect(fillRect,relativeTo)};Shape.prototype.drawScene=function(can,
top,caching,skipBuffer){var layer=this.getLayer();can=can||layer.getCanvas();var context=can.getContext(),cachedCanvas=this._getCanvasCache(),drawFunc=this.sceneFunc(),hasShadow=this.hasShadow(),hasStroke=this.hasStroke();if(!this.isVisible()&&!caching)return this;if(cachedCanvas)return context.save(),layer._applyTransform(this,context,top),this._drawCachedSceneCanvas(context),context.restore(),this;if(!drawFunc)return this;context.save();this._useBufferCanvas(caching)&&!skipBuffer?(skipBuffer=this.getStage(),
skipBuffer=skipBuffer.bufferCanvas,hasStroke=skipBuffer.getContext(),hasStroke.clear(),hasStroke.save(),hasStroke._applyLineJoin(this),caching||(layer?layer._applyTransform(this,hasStroke,top):(caching=this.getAbsoluteTransform(top).getMatrix(),context.transform(caching[0],caching[1],caching[2],caching[3],caching[4],caching[5]))),drawFunc.call(this,hasStroke,this),hasStroke.restore(),caching=skipBuffer.pixelRatio,hasShadow&&!can.hitCanvas?(context.save(),context._applyShadow(this),context._applyOpacity(this),
context._applyGlobalCompositeOperation(this),context.drawImage(skipBuffer._canvas,0,0,skipBuffer.width/caching,skipBuffer.height/caching),context.restore()):(context._applyOpacity(this),context._applyGlobalCompositeOperation(this),context.drawImage(skipBuffer._canvas,0,0,skipBuffer.width/caching,skipBuffer.height/caching))):(context._applyLineJoin(this),caching||(layer?layer._applyTransform(this,context,top):(top=this.getAbsoluteTransform(top).getMatrix(),context.transform(top[0],top[1],top[2],top[3],
top[4],top[5]))),hasShadow&&hasStroke&&!can.hitCanvas?(context.save(),caching||(context._applyOpacity(this),context._applyGlobalCompositeOperation(this)),context._applyShadow(this),drawFunc.call(this,context,this),context.restore(),this.hasFill()&&this.shadowForStrokeEnabled()&&drawFunc.call(this,context,this)):hasShadow&&!can.hitCanvas?(context.save(),caching||(context._applyOpacity(this),context._applyGlobalCompositeOperation(this)),context._applyShadow(this),drawFunc.call(this,context,this),context.restore()):
(caching||(context._applyOpacity(this),context._applyGlobalCompositeOperation(this)),drawFunc.call(this,context,this)));context.restore();return this};Shape.prototype.drawHit=function(can,top,caching){var layer=this.getLayer();can=(can=can||layer.hitCanvas)&&can.getContext();var drawFunc=this.hitFunc()||this.sceneFunc(),cachedCanvas=this._getCanvasCache();cachedCanvas=cachedCanvas&&cachedCanvas.hit;this.colorKey||(console.log(this),Util_1.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. See the shape in logs above. If you want to reuse shape you should call remove() instead of destroy()"));
if(!this.shouldDrawHit()&&!caching)return this;if(cachedCanvas)return can.save(),layer._applyTransform(this,can,top),this._drawCachedHitCanvas(can),can.restore(),this;if(!drawFunc)return this;can.save();can._applyLineJoin(this);caching||(layer?layer._applyTransform(this,can,top):(top=this.getAbsoluteTransform(top).getMatrix(),can.transform(top[0],top[1],top[2],top[3],top[4],top[5])));drawFunc.call(this,can,this);can.restore();return this};Shape.prototype.drawHitFromCache=function(alphaThreshold){void 0===
alphaThreshold&&(alphaThreshold=0);var cachedCanvas=this._getCanvasCache(),sceneCanvas=this._getCachedSceneCanvas(),hitCanvas=cachedCanvas.hit;cachedCanvas=hitCanvas.getContext();var hitWidth=hitCanvas.getWidth();hitCanvas=hitCanvas.getHeight();var i;cachedCanvas.clear();cachedCanvas.drawImage(sceneCanvas._canvas,0,0,hitWidth,hitCanvas);try{var hitImageData=cachedCanvas.getImageData(0,0,hitWidth,hitCanvas);var hitData=hitImageData.data;var len=hitData.length;var rgbColorKey=Util_1.Util._hexToRgb(this.colorKey);
for(i=0;i<len;i+=4){var alpha=hitData[i+3];alpha>alphaThreshold?(hitData[i]=rgbColorKey.r,hitData[i+1]=rgbColorKey.g,hitData[i+2]=rgbColorKey.b,hitData[i+3]=255):hitData[i+3]=0}cachedCanvas.putImageData(hitImageData,0,0)}catch(e){Util_1.Util.error("Unable to draw hit graph from cached scene canvas. "+e.message)}return this};Shape.prototype.hasPointerCapture=function(pointerId){return PointerEvents.hasPointerCapture(pointerId,this)};Shape.prototype.setPointerCapture=function(pointerId){PointerEvents.setPointerCapture(pointerId,
this)};Shape.prototype.releaseCapture=function(pointerId){PointerEvents.releaseCapture(pointerId,this)};return Shape}(Node_1.Node);exports.Shape=require;require.prototype._fillFunc=function(context){context.fill()};require.prototype._strokeFunc=function(context){context.stroke()};require.prototype._fillFuncHit=function(context){context.fill()};require.prototype._strokeFuncHit=function(context){context.stroke()};require.prototype._centroid=!1;require.prototype.nodeType="Shape";Global_1._registerNode(require);
global.Factory.addGetterSetter(require,"stroke",void 0,module.getStringValidator());global.Factory.addGetterSetter(require,"strokeWidth",2,module.getNumberValidator());global.Factory.addGetterSetter(require,"hitStrokeWidth","auto",module.getNumberOrAutoValidator());global.Factory.addGetterSetter(require,"strokeHitEnabled",!0,module.getBooleanValidator());global.Factory.addGetterSetter(require,"perfectDrawEnabled",!0,module.getBooleanValidator());global.Factory.addGetterSetter(require,"shadowForStrokeEnabled",
!0,module.getBooleanValidator());global.Factory.addGetterSetter(require,"lineJoin");global.Factory.addGetterSetter(require,"lineCap");global.Factory.addGetterSetter(require,"sceneFunc");global.Factory.addGetterSetter(require,"hitFunc");global.Factory.addGetterSetter(require,"dash");global.Factory.addGetterSetter(require,"dashOffset",0,module.getNumberValidator());global.Factory.addGetterSetter(require,"shadowColor",void 0,module.getStringValidator());global.Factory.addGetterSetter(require,"shadowBlur",
0,module.getNumberValidator());global.Factory.addGetterSetter(require,"shadowOpacity",1,module.getNumberValidator());global.Factory.addComponentsGetterSetter(require,"shadowOffset",["x","y"]);global.Factory.addGetterSetter(require,"shadowOffsetX",0,module.getNumberValidator());global.Factory.addGetterSetter(require,"shadowOffsetY",0,module.getNumberValidator());global.Factory.addGetterSetter(require,"fillPatternImage");global.Factory.addGetterSetter(require,"fill",void 0,module.getStringValidator());
global.Factory.addGetterSetter(require,"fillPatternX",0,module.getNumberValidator());global.Factory.addGetterSetter(require,"fillPatternY",0,module.getNumberValidator());global.Factory.addGetterSetter(require,"fillLinearGradientColorStops");global.Factory.addGetterSetter(require,"strokeLinearGradientColorStops");global.Factory.addGetterSetter(require,"fillRadialGradientStartRadius",0);global.Factory.addGetterSetter(require,"fillRadialGradientEndRadius",0);global.Factory.addGetterSetter(require,"fillRadialGradientColorStops");
global.Factory.addGetterSetter(require,"fillPatternRepeat","repeat");global.Factory.addGetterSetter(require,"fillEnabled",!0);global.Factory.addGetterSetter(require,"strokeEnabled",!0);global.Factory.addGetterSetter(require,"shadowEnabled",!0);global.Factory.addGetterSetter(require,"dashEnabled",!0);global.Factory.addGetterSetter(require,"strokeScaleEnabled",!0);global.Factory.addGetterSetter(require,"fillPriority","color");global.Factory.addComponentsGetterSetter(require,"fillPatternOffset",["x",
"y"]);global.Factory.addGetterSetter(require,"fillPatternOffsetX",0,module.getNumberValidator());global.Factory.addGetterSetter(require,"fillPatternOffsetY",0,module.getNumberValidator());global.Factory.addComponentsGetterSetter(require,"fillPatternScale",["x","y"]);global.Factory.addGetterSetter(require,"fillPatternScaleX",1,module.getNumberValidator());global.Factory.addGetterSetter(require,"fillPatternScaleY",1,module.getNumberValidator());global.Factory.addComponentsGetterSetter(require,"fillLinearGradientStartPoint",
["x","y"]);global.Factory.addComponentsGetterSetter(require,"strokeLinearGradientStartPoint",["x","y"]);global.Factory.addGetterSetter(require,"fillLinearGradientStartPointX",0);global.Factory.addGetterSetter(require,"strokeLinearGradientStartPointX",0);global.Factory.addGetterSetter(require,"fillLinearGradientStartPointY",0);global.Factory.addGetterSetter(require,"strokeLinearGradientStartPointY",0);global.Factory.addComponentsGetterSetter(require,"fillLinearGradientEndPoint",["x","y"]);global.Factory.addComponentsGetterSetter(require,
"strokeLinearGradientEndPoint",["x","y"]);global.Factory.addGetterSetter(require,"fillLinearGradientEndPointX",0);global.Factory.addGetterSetter(require,"strokeLinearGradientEndPointX",0);global.Factory.addGetterSetter(require,"fillLinearGradientEndPointY",0);global.Factory.addGetterSetter(require,"strokeLinearGradientEndPointY",0);global.Factory.addComponentsGetterSetter(require,"fillRadialGradientStartPoint",["x","y"]);global.Factory.addGetterSetter(require,"fillRadialGradientStartPointX",0);global.Factory.addGetterSetter(require,
"fillRadialGradientStartPointY",0);global.Factory.addComponentsGetterSetter(require,"fillRadialGradientEndPoint",["x","y"]);global.Factory.addGetterSetter(require,"fillRadialGradientEndPointX",0);global.Factory.addGetterSetter(require,"fillRadialGradientEndPointY",0);global.Factory.addGetterSetter(require,"fillPatternRotation",0);global.Factory.backCompat(require,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",
drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"});Util_1.Collection.mapMethods(require)}
//# sourceMappingURL=module$node_modules$konva$lib$Shape.js.map
