shadow$provide.module$node_modules$konva$lib$shapes$Text=function(global,require,module,exports){function getDummyContext(){return dummyContext?dummyContext:dummyContext=Util_1.Util.createCanvasElement().getContext("2d")}function checkDefaultFill(config){config=config||{};config.fillLinearGradientColorStops||config.fillRadialGradientColorStops||config.fillPatternImage||(config.fill=config.fill||"black");return config}var __extends=this&&this.__extends||function(){var extendStatics=function(d$jscomp$0,
b$jscomp$0){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return extendStatics(d$jscomp$0,b$jscomp$0)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});var Util_1=require("module$node_modules$konva$lib$Util");global=require("module$node_modules$konva$lib$Factory");
var Shape_1=require("module$node_modules$konva$lib$Shape"),Global_1=require("module$node_modules$konva$lib$Global");module=require("module$node_modules$konva$lib$Validators");require=require("module$node_modules$konva$lib$Global");var ATTR_CHANGE_LIST="fontFamily fontSize fontStyle fontVariant padding align verticalAlign lineHeight text width height wrap ellipsis letterSpacing".split(" "),attrChangeListLen=ATTR_CHANGE_LIST.length,dummyContext;Shape_1=function(_super){function Text(config){config=
_super.call(this,checkDefaultFill(config))||this;config._partialTextX=0;for(var n=config._partialTextY=0;n<attrChangeListLen;n++)config.on(ATTR_CHANGE_LIST[n]+"Change.konva",config._setTextData);config._setTextData();return config}__extends(Text,_super);Text.prototype._sceneFunc=function(context){var padding=this.padding(),fontSize=this.fontSize(),lineHeightPx=this.lineHeight()*fontSize,textArr=this.textArr,textArrLen=textArr.length,verticalAlign=this.verticalAlign(),alignY=0,align=this.align(),totalWidth=
this.getWidth(),letterSpacing=this.letterSpacing(),fill=this.fill(),textDecoration=this.textDecoration(),shouldUnderline=-1!==textDecoration.indexOf("underline");textDecoration=-1!==textDecoration.indexOf("line-through");var translateY=lineHeightPx/2;context.setAttr("font",this._getContextFont());context.setAttr("textBaseline","middle");context.setAttr("textAlign","left");"middle"===verticalAlign?alignY=(this.getHeight()-textArrLen*lineHeightPx-2*padding)/2:"bottom"===verticalAlign&&(alignY=this.getHeight()-
textArrLen*lineHeightPx-2*padding);context.translate(padding,alignY+padding);for(verticalAlign=0;verticalAlign<textArrLen;verticalAlign++){alignY=0;var obj=textArr[verticalAlign],text=obj.text;obj=obj.width;var lastLine=verticalAlign!==textArrLen-1;context.save();"right"===align?alignY+=totalWidth-obj-2*padding:"center"===align&&(alignY+=(totalWidth-obj-2*padding)/2);if(shouldUnderline){context.save();context.beginPath();context.moveTo(alignY,translateY+0+Math.round(fontSize/2));var spacesNumber=
text.split(" ").length-1;spacesNumber=0===spacesNumber;spacesNumber="justify"===align&&lastLine&&!spacesNumber?totalWidth-2*padding:obj;context.lineTo(alignY+Math.round(spacesNumber),translateY+0+Math.round(fontSize/2));context.lineWidth=fontSize/15;context.strokeStyle=fill;context.stroke();context.restore()}textDecoration&&(context.save(),context.beginPath(),context.moveTo(alignY,translateY+0),spacesNumber=text.split(" ").length-1,spacesNumber=0===spacesNumber,spacesNumber="justify"===align&&lastLine&&
!spacesNumber?totalWidth-2*padding:obj,context.lineTo(alignY+Math.round(spacesNumber),translateY+0),context.lineWidth=fontSize/15,context.strokeStyle=fill,context.stroke(),context.restore());if(0!==letterSpacing||"justify"===align)for(spacesNumber=text.split(" ").length-1,lastLine=0;lastLine<text.length;lastLine++){var letter=text[lastLine];" "===letter&&verticalAlign!==textArrLen-1&&"justify"===align&&(alignY+=Math.floor((totalWidth-2*padding-obj)/spacesNumber));this._partialTextX=alignY;this._partialTextY=
translateY+0;this._partialText=letter;context.fillStrokeShape(this);alignY+=Math.round(this.measureSize(letter).width)+letterSpacing}else this._partialTextX=alignY,this._partialTextY=translateY+0,this._partialText=text,context.fillStrokeShape(this);context.restore();1<textArrLen&&(translateY+=lineHeightPx)}};Text.prototype._hitFunc=function(context){var width=this.getWidth(),height=this.getHeight();context.beginPath();context.rect(0,0,width,height);context.closePath();context.fillStrokeShape(this)};
Text.prototype.setText=function(text){text=Util_1.Util._isString(text)?text:(text||"").toString();this._setAttr("text",text);return this};Text.prototype.getWidth=function(){return"auto"===this.attrs.width||void 0===this.attrs.width?this.getTextWidth()+2*this.padding():this.attrs.width};Text.prototype.getHeight=function(){return"auto"===this.attrs.height||void 0===this.attrs.height?this.fontSize()*this.textArr.length*this.lineHeight()+2*this.padding():this.attrs.height};Text.prototype.getTextWidth=
function(){return this.textWidth};Text.prototype.getTextHeight=function(){Util_1.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height.");return this.textHeight};Text.prototype.measureSize=function(text){var _context=getDummyContext(),fontSize=this.fontSize();_context.save();_context.font=this._getContextFont();text=_context.measureText(text);_context.restore();return{width:text.width,height:fontSize}};Text.prototype._getContextFont=
function(){return Global_1.Konva.UA.isIE?this.fontStyle()+" "+this.fontSize()+"px "+this.fontFamily():this.fontStyle()+" "+this.fontVariant()+" "+this.fontSize()+"px "+this.fontFamily()};Text.prototype._addTextLine=function(line){"justify"===this.align()&&(line=line.trim());var width=this._getTextWidth(line);return this.textArr.push({text:line,width:width})};Text.prototype._getTextWidth=function(text){var letterSpacing=this.letterSpacing(),length=text.length;return getDummyContext().measureText(text).width+
(length?letterSpacing*(length-1):0)};Text.prototype._setTextData=function(){var lines=this.text().split("\n"),fontSize=+this.fontSize(),textWidth=0,lineHeightPx=this.lineHeight()*fontSize,width=this.attrs.width,height=this.attrs.height,fixedWidth="auto"!==width&&void 0!==width,fixedHeight="auto"!==height&&void 0!==height,padding=this.padding();width-=2*padding;height-=2*padding;padding=0;var wrap=this.wrap(),shouldWrap="none"!==wrap;wrap="char"!==wrap&&shouldWrap;var shouldAddEllipsis=this.ellipsis()&&
!shouldWrap;this.textArr=[];getDummyContext().font=this._getContextFont();for(var additionalWidth=shouldAddEllipsis?this._getTextWidth("…"):0,i=0,max=lines.length;i<max;++i){var line=lines[i],lineWidth=this._getTextWidth(line);if(fixedWidth&&lineWidth>width)for(;0<line.length;){lineWidth=0;for(var high=line.length,match="",matchWidth=0;lineWidth<high;){var mid=lineWidth+high>>>1,substr=line.slice(0,mid+1),substrWidth=this._getTextWidth(substr)+additionalWidth;substrWidth<=width?(lineWidth=mid+1,match=
substr+(shouldAddEllipsis?"…":""),matchWidth=substrWidth):high=mid}if(match){wrap&&(high=line[match.length],high=(" "===high||"-"===high)&&matchWidth<=width?match.length:Math.max(match.lastIndexOf(" "),match.lastIndexOf("-"))+1,0<high&&(lineWidth=high,match=match.slice(0,lineWidth),matchWidth=this._getTextWidth(match)));match=match.trimRight();this._addTextLine(match);textWidth=Math.max(textWidth,matchWidth);padding+=lineHeightPx;if(!shouldWrap||fixedHeight&&padding+lineHeightPx>height)break;line=
line.slice(lineWidth);line=line.trimLeft();if(0<line.length&&(lineWidth=this._getTextWidth(line),lineWidth<=width)){this._addTextLine(line);padding+=lineHeightPx;textWidth=Math.max(textWidth,lineWidth);break}}else break}else this._addTextLine(line),padding+=lineHeightPx,textWidth=Math.max(textWidth,lineWidth);if(fixedHeight&&padding+lineHeightPx>height)break}this.textHeight=fontSize;this.textWidth=textWidth};Text.prototype.getStrokeScaleEnabled=function(){return!0};return Text}(Shape_1.Shape);exports.Text=
Shape_1;Shape_1.prototype._fillFunc=function(context){context.fillText(this._partialText,this._partialTextX,this._partialTextY)};Shape_1.prototype._strokeFunc=function(context){context.strokeText(this._partialText,this._partialTextX,this._partialTextY)};Shape_1.prototype.className="Text";Shape_1.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight"];require._registerNode(Shape_1);global.Factory.overWriteSetter(Shape_1,"width",module.getNumberOrAutoValidator());global.Factory.overWriteSetter(Shape_1,
"height",module.getNumberOrAutoValidator());global.Factory.addGetterSetter(Shape_1,"fontFamily","Arial");global.Factory.addGetterSetter(Shape_1,"fontSize",12,module.getNumberValidator());global.Factory.addGetterSetter(Shape_1,"fontStyle","normal");global.Factory.addGetterSetter(Shape_1,"fontVariant","normal");global.Factory.addGetterSetter(Shape_1,"padding",0,module.getNumberValidator());global.Factory.addGetterSetter(Shape_1,"align","left");global.Factory.addGetterSetter(Shape_1,"verticalAlign",
"top");global.Factory.addGetterSetter(Shape_1,"lineHeight",1,module.getNumberValidator());global.Factory.addGetterSetter(Shape_1,"wrap","word");global.Factory.addGetterSetter(Shape_1,"ellipsis",!1);global.Factory.addGetterSetter(Shape_1,"letterSpacing",0,module.getNumberValidator());global.Factory.addGetterSetter(Shape_1,"text","",module.getStringValidator());global.Factory.addGetterSetter(Shape_1,"textDecoration","");Util_1.Collection.mapMethods(Shape_1)}
//# sourceMappingURL=module$node_modules$konva$lib$shapes$Text.js.map
