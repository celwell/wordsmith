shadow$provide.module$node_modules$konva$lib$Tween=function(global,require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var Util_1=require("module$node_modules$konva$lib$Util"),Animation_1=require("module$node_modules$konva$lib$Animation");global=require("module$node_modules$konva$lib$Node");var Global_1=require("module$node_modules$konva$lib$Global"),blacklist={node:1,duration:1,easing:1,onFinish:1,yoyo:1},idCounter=0,colorAttrs=["fill","stroke","shadowColor"],TweenEngine=
function(){function TweenEngine(prop,propFunc,func,begin,finish,duration,yoyo){this.prop=prop;this.propFunc=propFunc;this._pos=this.begin=begin;this.duration=duration;this.prevPos=0;this.yoyo=yoyo;this._finish=this._startTime=this._position=this._time=0;this.func=func;this._change=finish-this.begin;this.pause()}TweenEngine.prototype.fire=function(str){(str=this[str])&&str()};TweenEngine.prototype.setTime=function(t){t>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():
0>t?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=t,this.update())};TweenEngine.prototype.getTime=function(){return this._time};TweenEngine.prototype.setPosition=function(p){this.prevPos=this._pos;this.propFunc(p);this._pos=p};TweenEngine.prototype.getPosition=function(t){void 0===t&&(t=this._time);return this.func(t,this.begin,this._change,this.duration)};TweenEngine.prototype.play=function(){this.state=2;this._startTime=this.getTimer()-this._time;this.onEnterFrame();this.fire("onPlay")};
TweenEngine.prototype.reverse=function(){this.state=3;this._time=this.duration-this._time;this._startTime=this.getTimer()-this._time;this.onEnterFrame();this.fire("onReverse")};TweenEngine.prototype.seek=function(t){this.pause();this._time=t;this.update();this.fire("onSeek")};TweenEngine.prototype.reset=function(){this.pause();this._time=0;this.update();this.fire("onReset")};TweenEngine.prototype.finish=function(){this.pause();this._time=this.duration;this.update();this.fire("onFinish")};TweenEngine.prototype.update=
function(){this.setPosition(this.getPosition(this._time))};TweenEngine.prototype.onEnterFrame=function(){var t=this.getTimer()-this._startTime;2===this.state?this.setTime(t):3===this.state&&this.setTime(this.duration-t)};TweenEngine.prototype.pause=function(){this.state=1;this.fire("onPause")};TweenEngine.prototype.getTimer=function(){return(new Date).getTime()};return TweenEngine}(),Tween=function(){function Tween(config){var that=this,node=config.node,nodeId=node._id,easing=config.easing||exports.Easings.Linear,
yoyo=!!config.yoyo,key;var duration="undefined"===typeof config.duration?.3:0===config.duration?.001:config.duration;this.node=node;this._id=idCounter++;(node=node.getLayer()||(node instanceof Global_1.Konva.Stage?node.getLayers():null))||Util_1.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first.");this.anim=new Animation_1.Animation(function(){that.tween.onEnterFrame()},node);this.tween=new TweenEngine(key,function(i){that._tweenFunc(i)},easing,0,1,
1E3*duration,yoyo);this._addListeners();Tween.attrs[nodeId]||(Tween.attrs[nodeId]={});Tween.attrs[nodeId][this._id]||(Tween.attrs[nodeId][this._id]={});Tween.tweens[nodeId]||(Tween.tweens[nodeId]={});for(key in config)void 0===blacklist[key]&&this._addAttr(key,config[key]);this.reset();this.onFinish=config.onFinish;this.onReset=config.onReset}Tween.prototype._addAttr=function(key,end){var node=this.node,nodeId=node._id,start;(start=Tween.tweens[nodeId][key])&&delete Tween.attrs[nodeId][start][key];
start=node.getAttr(key);if(Util_1.Util._isArray(end)){var diff=[];var len=Math.max(end.length,start.length);if("points"===key&&end.length!==start.length)if(end.length>start.length){var trueStart=start;start=Util_1.Util._prepareArrayForTween(start,end,node.closed())}else{var trueEnd=end;end=Util_1.Util._prepareArrayForTween(end,start,node.closed())}if(0===key.indexOf("fill"))for(node=0;node<len;node++)if(0===node%2)diff.push(end[node]-start[node]);else{var startRGBA=Util_1.Util.colorToRGBA(start[node]);
var endRGBA=Util_1.Util.colorToRGBA(end[node]);start[node]=startRGBA;diff.push({r:endRGBA.r-startRGBA.r,g:endRGBA.g-startRGBA.g,b:endRGBA.b-startRGBA.b,a:endRGBA.a-startRGBA.a})}else for(node=0;node<len;node++)diff.push(end[node]-start[node])}else-1!==colorAttrs.indexOf(key)?(start=Util_1.Util.colorToRGBA(start),endRGBA=Util_1.Util.colorToRGBA(end),diff={r:endRGBA.r-start.r,g:endRGBA.g-start.g,b:endRGBA.b-start.b,a:endRGBA.a-start.a}):diff=end-start;Tween.attrs[nodeId][this._id][key]={start:start,
diff:diff,end:end,trueEnd:trueEnd,trueStart:trueStart};Tween.tweens[nodeId][key]=this._id};Tween.prototype._tweenFunc=function(i){var node=this.node,attrs=Tween.attrs[node._id][this._id],key;for(key in attrs){var attr=attrs[key];var start=attr.start;var diff=attr.diff;var n=attr.end;if(Util_1.Util._isArray(start)){attr=[];var len=Math.max(start.length,n.length);if(0===key.indexOf("fill"))for(n=0;n<len;n++)0===n%2?attr.push((start[n]||0)+diff[n]*i):attr.push("rgba("+Math.round(start[n].r+diff[n].r*
i)+","+Math.round(start[n].g+diff[n].g*i)+","+Math.round(start[n].b+diff[n].b*i)+","+(start[n].a+diff[n].a*i)+")");else for(n=0;n<len;n++)attr.push((start[n]||0)+diff[n]*i)}else attr=-1!==colorAttrs.indexOf(key)?"rgba("+Math.round(start.r+diff.r*i)+","+Math.round(start.g+diff.g*i)+","+Math.round(start.b+diff.b*i)+","+(start.a+diff.a*i)+")":start+diff*i;node.setAttr(key,attr)}};Tween.prototype._addListeners=function(){var _this=this;this.tween.onPlay=function(){_this.anim.start()};this.tween.onReverse=
function(){_this.anim.start()};this.tween.onPause=function(){_this.anim.stop()};this.tween.onFinish=function(){var node=_this.node,attrs=Tween.attrs[node._id][_this._id];attrs.points&&attrs.points.trueEnd&&node.setAttr("points",attrs.points.trueEnd);_this.onFinish&&_this.onFinish.call(_this)};this.tween.onReset=function(){var node=_this.node,attrs=Tween.attrs[node._id][_this._id];attrs.points&&attrs.points.trueStart&&node.points(attrs.points.trueStart);if(_this.onReset)_this.onReset()}};Tween.prototype.play=
function(){this.tween.play();return this};Tween.prototype.reverse=function(){this.tween.reverse();return this};Tween.prototype.reset=function(){this.tween.reset();return this};Tween.prototype.seek=function(t){this.tween.seek(1E3*t);return this};Tween.prototype.pause=function(){this.tween.pause();return this};Tween.prototype.finish=function(){this.tween.finish();return this};Tween.prototype.destroy=function(){var nodeId=this.node._id,thisId=this._id,attrs=Tween.tweens[nodeId],key;this.pause();for(key in attrs)delete Tween.tweens[nodeId][key];
delete Tween.attrs[nodeId][thisId]};Tween.attrs={};Tween.tweens={};return Tween}();exports.Tween=Tween;global.Node.prototype.to=function(params){var onFinish=params.onFinish;params.node=this;params.onFinish=function(){this.destroy();onFinish&&onFinish()};(new Tween(params)).play()};exports.Easings={BackEaseIn:function(t,b,c,d){return c*(t/=d)*t*(2.70158*t-1.70158)+b},BackEaseOut:function(t,b,c,d){return c*((t=t/d-1)*t*(2.70158*t+1.70158)+1)+b},BackEaseInOut:function(t,b,c,d){var s=1.70158;return 1>
(t/=d/2)?c/2*t*t*(((s*=1.525)+1)*t-s)+b:c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b},ElasticEaseIn:function(t,b,c,d,a,p){if(0===t)return b;if(1===(t/=d))return b+c;p||(p=.3*d);!a||a<Math.abs(c)?(a=c,c=p/4):c=p/(2*Math.PI)*Math.asin(c/a);return-(a*Math.pow(2,10*--t)*Math.sin(2*(t*d-c)*Math.PI/p))+b},ElasticEaseOut:function(t,b,c,d,a,p){if(0===t)return b;if(1===(t/=d))return b+c;p||(p=.3*d);if(!a||a<Math.abs(c)){a=c;var s=p/4}else s=p/(2*Math.PI)*Math.asin(c/a);return a*Math.pow(2,-10*t)*Math.sin(2*(t*
d-s)*Math.PI/p)+c+b},ElasticEaseInOut:function(t,b,c,d,a,p){if(0===t)return b;if(2===(t/=d/2))return b+c;p||(p=.3*d*1.5);if(!a||a<Math.abs(c)){a=c;var s=p/4}else s=p/(2*Math.PI)*Math.asin(c/a);return 1>t?-.5*a*Math.pow(2,10*--t)*Math.sin(2*(t*d-s)*Math.PI/p)+b:a*Math.pow(2,-10*--t)*Math.sin(2*(t*d-s)*Math.PI/p)*.5+c+b},BounceEaseOut:function(t,b,c,d){return(t/=d)<1/2.75?7.5625*c*t*t+b:t<2/2.75?c*(7.5625*(t-=1.5/2.75)*t+.75)+b:t<2.5/2.75?c*(7.5625*(t-=2.25/2.75)*t+.9375)+b:c*(7.5625*(t-=2.625/2.75)*
t+.984375)+b},BounceEaseIn:function(t,b,c,d){return c-exports.Easings.BounceEaseOut(d-t,0,c,d)+b},BounceEaseInOut:function(t,b,c,d){return t<d/2?.5*exports.Easings.BounceEaseIn(2*t,0,c,d)+b:.5*exports.Easings.BounceEaseOut(2*t-d,0,c,d)+.5*c+b},EaseIn:function(t,b,c,d){return c*(t/=d)*t+b},EaseOut:function(t,b,c,d){return-c*(t/=d)*(t-2)+b},EaseInOut:function(t,b,c,d){return 1>(t/=d/2)?c/2*t*t+b:-c/2*(--t*(t-2)-1)+b},StrongEaseIn:function(t,b,c,d){return c*(t/=d)*t*t*t*t+b},StrongEaseOut:function(t,
b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b},StrongEaseInOut:function(t,b,c,d){return 1>(t/=d/2)?c/2*t*t*t*t*t+b:c/2*((t-=2)*t*t*t*t+2)+b},Linear:function(t,b,c,d){return c*t/d+b}}}
//# sourceMappingURL=module$node_modules$konva$lib$Tween.js.map
