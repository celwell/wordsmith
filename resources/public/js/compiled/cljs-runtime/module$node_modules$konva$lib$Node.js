shadow$provide.module$node_modules$konva$lib$Node=function(global,require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0});var Util_1=require("module$node_modules$konva$lib$Util");global=require("module$node_modules$konva$lib$Factory");var Canvas_1=require("module$node_modules$konva$lib$Canvas"),Global_1=require("module$node_modules$konva$lib$Global"),DragAndDrop_1=require("module$node_modules$konva$lib$DragAndDrop");require=require("module$node_modules$konva$lib$Validators");
exports.ids={};exports.names={};exports._removeId=function(id,node){id&&exports.ids[id]===node&&delete exports.ids[id]};exports._addName=function(node,name){name&&(exports.names[name]||(exports.names[name]=[]),exports.names[name].push(node))};exports._removeName=function(name,_id){if(name){var nodes=exports.names[name];if(nodes){for(var n=0;n<nodes.length;n++)nodes[n]._id===_id&&nodes.splice(n,1);0===nodes.length&&delete exports.names[name]}}};var CLONE_BLACK_LIST=["id"],emptyChildren=new Util_1.Collection,
idCounter=1;module=function(){function Node(config){var _this=this;this._id=idCounter++;this.eventListeners={};this.attrs={};this.index=0;this.parent=null;this._cache=new Map;this._lastPos=null;this._isUnderCache=this._filterUpToDate=!1;this.children=emptyChildren;this._dragEventId=null;this.setAttrs(config);this.on("xChange.konva yChange.konva scaleXChange.konva scaleYChange.konva skewXChange.konva skewYChange.konva rotationChange.konva offsetXChange.konva offsetYChange.konva transformsEnabledChange.konva",
function(){_this._clearCache("transform");_this._clearSelfAndDescendantCache("absoluteTransform")});this.on("scaleXChange.konva scaleYChange.konva",function(){_this._clearSelfAndDescendantCache("absoluteScale")});this.on("visibleChange.konva",function(){_this._clearSelfAndDescendantCache("visible")});this.on("listeningChange.konva",function(){_this._clearSelfAndDescendantCache("listening")});this.on("opacityChange.konva",function(){_this._clearSelfAndDescendantCache("absoluteOpacity")})}Node.prototype.hasChildren=
function(){return!1};Node.prototype.getChildren=function(){return emptyChildren};Node.prototype._clearCache=function(attr){attr?this._cache.delete(attr):this._cache.clear()};Node.prototype._getCache=function(attr,privateGetter){var cache=this._cache.get(attr);void 0===cache&&(cache=privateGetter.call(this),this._cache.set(attr,cache));return cache};Node.prototype._getCanvasCache=function(){return this._cache.get("canvas")};Node.prototype._clearSelfAndDescendantCache=function(attr){this._clearCache(attr);
this._getCanvasCache()||this.children&&this.children.each(function(node){node._clearSelfAndDescendantCache(attr)})};Node.prototype.clearCache=function(){this._cache.delete("canvas");this._clearSelfAndDescendantCache();return this};Node.prototype.cache=function(config){config=config||{};var rect={};if(void 0===config.x||void 0===config.y||void 0===config.width||void 0===config.height)rect=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()});var width=config.width||rect.width,height=config.height||
rect.height,pixelRatio=config.pixelRatio,x=void 0===config.x?rect.x:config.x;rect=void 0===config.y?rect.y:config.y;var offset=config.offset||0,drawBorder=config.drawBorder||!1;if(width&&height){width+=2*offset;height+=2*offset;x-=offset;rect-=offset;offset=new Canvas_1.SceneCanvas({pixelRatio:pixelRatio,width:width,height:height});pixelRatio=new Canvas_1.SceneCanvas({pixelRatio:pixelRatio,width:width,height:height});var cachedHitCanvas=new Canvas_1.HitCanvas({pixelRatio:1,width:width,height:height}),
sceneContext=offset.getContext(),hitContext=cachedHitCanvas.getContext();cachedHitCanvas.isCache=!0;this._cache.delete("canvas");this._filterUpToDate=!1;!1===config.imageSmoothingEnabled&&(offset.getContext()._context.imageSmoothingEnabled=!1,pixelRatio.getContext()._context.imageSmoothingEnabled=!1,cachedHitCanvas.getContext()._context.imageSmoothingEnabled=!1);sceneContext.save();hitContext.save();sceneContext.translate(-x,-rect);hitContext.translate(-x,-rect);this._isUnderCache=!0;this._clearSelfAndDescendantCache("absoluteOpacity");
this._clearSelfAndDescendantCache("absoluteScale");this.drawScene(offset,this,!0);this.drawHit(cachedHitCanvas,this,!0);this._isUnderCache=!1;sceneContext.restore();hitContext.restore();drawBorder&&(sceneContext.save(),sceneContext.beginPath(),sceneContext.rect(0,0,width,height),sceneContext.closePath(),sceneContext.setAttr("strokeStyle","red"),sceneContext.setAttr("lineWidth",5),sceneContext.stroke(),sceneContext.restore());this._cache.set("canvas",{scene:offset,filter:pixelRatio,hit:cachedHitCanvas,
x:x,y:rect});return this}Util_1.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.")};Node.prototype.isCached=function(){return this._cache.has("canvas")};Node.prototype.getClientRect=function(config){throw Error('abstract "getClientRect" method call');};Node.prototype._transformedRect=function(rect,top){rect=[{x:rect.x,y:rect.y},{x:rect.x+rect.width,y:rect.y},{x:rect.x+rect.width,y:rect.y+rect.height},{x:rect.x,y:rect.y+rect.height}];var minX,minY,maxX,
maxY,trans=this.getAbsoluteTransform(top);rect.forEach(function(point){point=trans.point(point);void 0===minX&&(minX=maxX=point.x,minY=maxY=point.y);minX=Math.min(minX,point.x);minY=Math.min(minY,point.y);maxX=Math.max(maxX,point.x);maxY=Math.max(maxY,point.y)});return{x:minX,y:minY,width:maxX-minX,height:maxY-minY}};Node.prototype._drawCachedSceneCanvas=function(context){context.save();context._applyOpacity(this);context._applyGlobalCompositeOperation(this);var canvasCache=this._getCanvasCache();
context.translate(canvasCache.x,canvasCache.y);canvasCache=this._getCachedSceneCanvas();var ratio=canvasCache.pixelRatio;context.drawImage(canvasCache._canvas,0,0,canvasCache.width/ratio,canvasCache.height/ratio);context.restore()};Node.prototype._drawCachedHitCanvas=function(context){var canvasCache=this._getCanvasCache(),hitCanvas=canvasCache.hit;context.save();context._applyGlobalCompositeOperation(this);context.translate(canvasCache.x,canvasCache.y);context.drawImage(hitCanvas._canvas,0,0);context.restore()};
Node.prototype._getCachedSceneCanvas=function(){var filters=this.filters(),cachedCanvas=this._getCanvasCache(),sceneCanvas=cachedCanvas.scene;cachedCanvas=cachedCanvas.filter;var filterContext=cachedCanvas.getContext(),n;if(filters){if(!this._filterUpToDate){var ratio=sceneCanvas.pixelRatio;try{var len=filters.length;filterContext.clear();filterContext.drawImage(sceneCanvas._canvas,0,0,sceneCanvas.getWidth()/ratio,sceneCanvas.getHeight()/ratio);var imageData=filterContext.getImageData(0,0,cachedCanvas.getWidth(),
cachedCanvas.getHeight());for(n=0;n<len;n++){var filter=filters[n];"function"!==typeof filter?Util_1.Util.error("Filter should be type of function, but got "+typeof filter+" insted. Please check correct filters"):(filter.call(this,imageData),filterContext.putImageData(imageData,0,0))}}catch(e){Util_1.Util.error("Unable to apply filter. "+e.message)}this._filterUpToDate=!0}return cachedCanvas}return sceneCanvas};Node.prototype.on=function(evtStr,handler){if(3===arguments.length)return this._delegate.apply(this,
arguments);var events=evtStr.split(" "),len=events.length,n;for(n=0;n<len;n++){var event=events[n];var parts=event.split(".");event=parts[0];parts=parts[1]||"";this.eventListeners[event]||(this.eventListeners[event]=[]);this.eventListeners[event].push({name:parts,handler:handler})}return this};Node.prototype.off=function(evtStr,callback){var events=(evtStr||"").split(" "),len=events.length,t;if(!evtStr)for(t in this.eventListeners)this._off(t);for(evtStr=0;evtStr<len;evtStr++){var event=events[evtStr];
var parts=event.split(".");event=parts[0];parts=parts[1];if(event)this.eventListeners[event]&&this._off(event,parts,callback);else for(t in this.eventListeners)this._off(t,parts,callback)}return this};Node.prototype.dispatchEvent=function(evt){this.fire(evt.type,{target:this,type:evt.type,evt:evt});return this};Node.prototype.addEventListener=function(type,handler){this.on(type,function(evt){handler.call(this,evt.evt)});return this};Node.prototype.removeEventListener=function(type){this.off(type);
return this};Node.prototype._delegate=function(event,selector,handler){var stopNode=this;this.on(event,function(evt){for(var targets=evt.target.findAncestors(selector,!0,stopNode),i=0;i<targets.length;i++)evt=Util_1.Util.cloneObject(evt),evt.currentTarget=targets[i],handler.call(targets[i],evt)})};Node.prototype.remove=function(){this.isDragging()&&this.stopDrag();DragAndDrop_1.DD._dragElements.delete(this._id);this._remove();return this};Node.prototype._remove=function(){this._clearSelfAndDescendantCache("stage");
this._clearSelfAndDescendantCache("absoluteTransform");this._clearSelfAndDescendantCache("visible");this._clearSelfAndDescendantCache("listening");this._clearSelfAndDescendantCache("absoluteOpacity");var parent=this.getParent();parent&&parent.children&&(parent.children.splice(this.index,1),parent._setChildrenIndices(),this.parent=null)};Node.prototype.destroy=function(){exports._removeId(this.id(),this);for(var names=(this.name()||"").split(/\s/g),i=0;i<names.length;i++)exports._removeName(names[i],
this._id);this.remove();return this};Node.prototype.getAttr=function(attr){var method="get"+Util_1.Util._capitalize(attr);return Util_1.Util._isFunction(this[method])?this[method]():this.attrs[attr]};Node.prototype.getAncestors=function(){for(var parent=this.getParent(),ancestors=new Util_1.Collection;parent;)ancestors.push(parent),parent=parent.getParent();return ancestors};Node.prototype.getAttrs=function(){return this.attrs||{}};Node.prototype.setAttrs=function(config){var key;if(!config)return this;
for(key in config)if("children"!==key){var method="set"+Util_1.Util._capitalize(key);if(Util_1.Util._isFunction(this[method]))this[method](config[key]);else this._setAttr(key,config[key])}return this};Node.prototype.isListening=function(){return this._getCache("listening",this._isListening)};Node.prototype._isListening=function(){var listening=this.listening(),parent=this.getParent();return"inherit"===listening?parent?parent.isListening():!0:listening};Node.prototype.isVisible=function(){return this._getCache("visible",
this._isVisible)};Node.prototype._isVisible=function(relativeTo){var visible=this.visible(),parent=this.getParent();return"inherit"===visible?parent&&parent!==relativeTo?parent._isVisible(relativeTo):!0:visible};Node.prototype.shouldDrawHit=function(){var layer=this.getLayer();return!layer&&this.isListening()&&this.isVisible()||layer&&layer.hitGraphEnabled()&&this.isListening()&&this.isVisible()};Node.prototype.show=function(){this.visible(!0);return this};Node.prototype.hide=function(){this.visible(!1);
return this};Node.prototype.getZIndex=function(){return this.index||0};Node.prototype.getAbsoluteZIndex=function(){function addChildren(children){nodes=[];len=children.length;for(n=0;n<len;n++)child=children[n],index++,"Shape"!==child.nodeType&&(nodes=nodes.concat(child.getChildren().toArray())),child._id===that._id&&(n=len);0<nodes.length&&nodes[0].getDepth()<=depth&&addChildren(nodes)}var depth=this.getDepth(),that=this,index=0,nodes,len,n,child;"Stage"!==that.nodeType&&addChildren(that.getStage().getChildren());
return index};Node.prototype.getDepth=function(){for(var depth=0,parent=this.parent;parent;)depth++,parent=parent.parent;return depth};Node.prototype.setPosition=function(pos){this.x(pos.x);this.y(pos.y);return this};Node.prototype.getPosition=function(){return{x:this.x(),y:this.y()}};Node.prototype.getAbsolutePosition=function(top){top=this.getAbsoluteTransform(top).getMatrix();var absoluteTransform=new Util_1.Transform,offset=this.offset();absoluteTransform.m=top.slice();absoluteTransform.translate(offset.x,
offset.y);return absoluteTransform.getTranslation()};Node.prototype.setAbsolutePosition=function(pos){var origTrans=this._clearTransform();this.attrs.x=origTrans.x;this.attrs.y=origTrans.y;delete origTrans.x;delete origTrans.y;var it=this.getAbsoluteTransform();it.invert();it.translate(pos.x,pos.y);pos={x:this.attrs.x+it.getTranslation().x,y:this.attrs.y+it.getTranslation().y};this.setPosition({x:pos.x,y:pos.y});this._setTransform(origTrans);return this};Node.prototype._setTransform=function(trans){for(var key in trans)this.attrs[key]=
trans[key];this._clearCache("transform");this._clearSelfAndDescendantCache("absoluteTransform")};Node.prototype._clearTransform=function(){var trans={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};this.attrs.x=0;this.attrs.y=0;this.attrs.rotation=0;this.attrs.scaleX=1;this.attrs.scaleY=1;this.attrs.offsetX=0;this.attrs.offsetY=0;this.attrs.skewX=0;this.attrs.skewY=0;this._clearCache("transform");
this._clearSelfAndDescendantCache("absoluteTransform");return trans};Node.prototype.move=function(change){var changeX=change.x;change=change.y;var x=this.x(),y=this.y();void 0!==changeX&&(x+=changeX);void 0!==change&&(y+=change);this.setPosition({x:x,y:y});return this};Node.prototype._eachAncestorReverse=function(func,top){var family=[],parent=this.getParent();if(top&&top._id===this._id)func(this);else{for(family.unshift(this);parent&&(!top||parent._id!==top._id);)family.unshift(parent),parent=parent.parent;
top=family.length;for(parent=0;parent<top;parent++)func(family[parent])}};Node.prototype.rotate=function(theta){this.rotation(this.rotation()+theta);return this};Node.prototype.moveToTop=function(){if(!this.parent)return Util_1.Util.warn("Node has no parent. moveToTop function is ignored."),!1;this.parent.children.splice(this.index,1);this.parent.children.push(this);this.parent._setChildrenIndices();return!0};Node.prototype.moveUp=function(){if(!this.parent)return Util_1.Util.warn("Node has no parent. moveUp function is ignored."),
!1;var index=this.index,len=this.parent.getChildren().length;return index<len-1?(this.parent.children.splice(index,1),this.parent.children.splice(index+1,0,this),this.parent._setChildrenIndices(),!0):!1};Node.prototype.moveDown=function(){if(!this.parent)return Util_1.Util.warn("Node has no parent. moveDown function is ignored."),!1;var index=this.index;return 0<index?(this.parent.children.splice(index,1),this.parent.children.splice(index-1,0,this),this.parent._setChildrenIndices(),!0):!1};Node.prototype.moveToBottom=
function(){if(!this.parent)return Util_1.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;var index=this.index;return 0<index?(this.parent.children.splice(index,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1};Node.prototype.setZIndex=function(zIndex){if(!this.parent)return Util_1.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(0>zIndex||zIndex>=this.parent.children.length)&&Util_1.Util.warn("Unexpected value "+zIndex+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+
(this.parent.children.length-1)+".");this.parent.children.splice(this.index,1);this.parent.children.splice(zIndex,0,this);this.parent._setChildrenIndices();return this};Node.prototype.getAbsoluteOpacity=function(){return this._getCache("absoluteOpacity",this._getAbsoluteOpacity)};Node.prototype._getAbsoluteOpacity=function(){var absOpacity=this.opacity(),parent=this.getParent();parent&&!parent._isUnderCache&&(absOpacity*=parent.getAbsoluteOpacity());return absOpacity};Node.prototype.moveTo=function(newContainer){this.getParent()!==
newContainer&&(this._remove(),newContainer.add(this));return this};Node.prototype.toObject=function(){var obj={},attrs=this.getAttrs(),key;obj.attrs={};for(key in attrs){var val=attrs[key];var getter=Util_1.Util.isObject(val)&&!Util_1.Util._isPlainObject(val)&&!Util_1.Util._isArray(val);getter||(getter="function"===typeof this[key]&&this[key],delete attrs[key],getter=getter?getter.call(this):null,attrs[key]=val,getter!==val&&(obj.attrs[key]=val))}obj.className=this.getClassName();return Util_1.Util._prepareToStringify(obj)};
Node.prototype.toJSON=function(){return JSON.stringify(this.toObject())};Node.prototype.getParent=function(){return this.parent};Node.prototype.findAncestors=function(selector,includeSelf,stopNode){var res=[];includeSelf&&this._isMatch(selector)&&res.push(this);for(includeSelf=this.parent;includeSelf&&includeSelf!==stopNode;)includeSelf._isMatch(selector)&&res.push(includeSelf),includeSelf=includeSelf.parent;return res};Node.prototype.isAncestorOf=function(node){return!1};Node.prototype.findAncestor=
function(selector,includeSelf,stopNode){return this.findAncestors(selector,includeSelf,stopNode)[0]};Node.prototype._isMatch=function(selector){if(!selector)return!1;if("function"===typeof selector)return selector(this);selector=selector.replace(/ /g,"").split(",");var len=selector.length,n;for(n=0;n<len;n++){var sel=selector[n];Util_1.Util.isValidSelector(sel)||(Util_1.Util.warn('Selector "'+sel+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),Util_1.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),
Util_1.Util.warn("Konva is awesome, right?"));if("#"===sel.charAt(0)){if(this.id()===sel.slice(1))return!0}else if("."===sel.charAt(0)){if(this.hasName(sel.slice(1)))return!0}else if(this.className===sel||this.nodeType===sel)return!0}return!1};Node.prototype.getLayer=function(){var parent=this.getParent();return parent?parent.getLayer():null};Node.prototype.getStage=function(){return this._getCache("stage",this._getStage)};Node.prototype._getStage=function(){var parent=this.getParent();if(parent)return parent.getStage()};
Node.prototype.fire=function(eventType,evt,bubble){evt=evt||{};evt.target=evt.target||this;bubble?this._fireAndBubble(eventType,evt):this._fire(eventType,evt);return this};Node.prototype.getAbsoluteTransform=function(top){return top?this._getAbsoluteTransform(top):this._getCache("absoluteTransform",this._getAbsoluteTransform)};Node.prototype._getAbsoluteTransform=function(top){var at=new Util_1.Transform;this._eachAncestorReverse(function(node){var transformsEnabled=node.getTransformsEnabled();"all"===
transformsEnabled?at.multiply(node.getTransform()):"position"===transformsEnabled&&at.translate(node.getX()-node.getOffsetX(),node.getY()-node.getOffsetY())},top);return at};Node.prototype.getAbsoluteScale=function(top){return top?this._getAbsoluteScale(top):this._getCache("absoluteScale",this._getAbsoluteScale)};Node.prototype._getAbsoluteScale=function(top){for(var parent=this;parent;)parent._isUnderCache&&(top=parent),parent=parent.getParent();var scaleX=1,scaleY=1;this._eachAncestorReverse(function(node){scaleX*=
node.scaleX();scaleY*=node.scaleY()},top);return{x:scaleX,y:scaleY}};Node.prototype.getTransform=function(){return this._getCache("transform",this._getTransform)};Node.prototype._getTransform=function(){var m=new Util_1.Transform,x=this.x(),y=this.y(),rotation=Global_1.Konva.getAngle(this.rotation()),scaleX=this.scaleX(),scaleY=this.scaleY(),skewX=this.skewX(),skewY=this.skewY(),offsetX=this.offsetX(),offsetY=this.offsetY();0===x&&0===y||m.translate(x,y);0!==rotation&&m.rotate(rotation);0===skewX&&
0===skewY||m.skew(skewX,skewY);1===scaleX&&1===scaleY||m.scale(scaleX,scaleY);0===offsetX&&0===offsetY||m.translate(-1*offsetX,-1*offsetY);return m};Node.prototype.clone=function(obj){var attrs=Util_1.Util.cloneObject(this.attrs),key,n;for(n in CLONE_BLACK_LIST)delete attrs[CLONE_BLACK_LIST[n]];for(key in obj)attrs[key]=obj[key];var node=new this.constructor(attrs);for(key in this.eventListeners)for(obj=this.eventListeners[key],attrs=obj.length,n=0;n<attrs;n++){var listener=obj[n];0>listener.name.indexOf("konva")&&
(node.eventListeners[key]||(node.eventListeners[key]=[]),node.eventListeners[key].push(listener))}return node};Node.prototype._toKonvaCanvas=function(config){config=config||{};var box=this.getClientRect(),stage=this.getStage(),x=void 0!==config.x?config.x:box.x,y=void 0!==config.y?config.y:box.y,pixelRatio=config.pixelRatio||1;config=new Canvas_1.SceneCanvas({width:config.width||box.width||(stage?stage.width():0),height:config.height||box.height||(stage?stage.height():0),pixelRatio:pixelRatio});box=
config.getContext();box.save();(x||y)&&box.translate(-1*x,-1*y);this.drawScene(config);box.restore();return config};Node.prototype.toCanvas=function(config){return this._toKonvaCanvas(config)._canvas};Node.prototype.toDataURL=function(config){config=config||{};var mimeType=config.mimeType||null,quality=config.quality||null;mimeType=this._toKonvaCanvas(config).toDataURL(mimeType,quality);config.callback&&config.callback(mimeType);return mimeType};Node.prototype.toImage=function(config){if(!config||
!config.callback)throw"callback required for toImage method config argument";var callback=config.callback;delete config.callback;Util_1.Util._urlToImage(this.toDataURL(config),function(img){callback(img)})};Node.prototype.setSize=function(size){this.width(size.width);this.height(size.height);return this};Node.prototype.getSize=function(){return{width:this.width(),height:this.height()}};Node.prototype.getClassName=function(){return this.className||this.nodeType};Node.prototype.getType=function(){return this.nodeType};
Node.prototype.getDragDistance=function(){return void 0!==this.attrs.dragDistance?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():Global_1.Konva.dragDistance};Node.prototype._off=function(type,name,callback){var evtListeners=this.eventListeners[type],i;for(i=0;i<evtListeners.length;i++){var evtName=evtListeners[i].name;var handler=evtListeners[i].handler;if(!("konva"===evtName&&"konva"!==name||name&&evtName!==name||callback&&callback!==handler)){evtListeners.splice(i,1);if(0===evtListeners.length){delete this.eventListeners[type];
break}i--}}};Node.prototype._fireChangeEvent=function(attr,oldVal,newVal){this._fire(attr+"Change",{oldVal:oldVal,newVal:newVal})};Node.prototype.setId=function(id){var oldId=this.id();exports._removeId(oldId,this);id&&(exports.ids[id]=this);this._setAttr("id",id);return this};Node.prototype.setName=function(name){var oldNames=(this.name()||"").split(/\s/g),newNames=(name||"").split(/\s/g),i;for(i=0;i<oldNames.length;i++){var subname=oldNames[i];-1===newNames.indexOf(subname)&&subname&&exports._removeName(subname,
this._id)}for(i=0;i<newNames.length;i++)subname=newNames[i],-1===oldNames.indexOf(subname)&&subname&&exports._addName(this,subname);this._setAttr("name",name);return this};Node.prototype.addName=function(name){if(!this.hasName(name)){var oldName=this.name();this.setName(oldName?oldName+" "+name:name)}return this};Node.prototype.hasName=function(name){if(!name)return!1;var fullName=this.name();return fullName?-1!==(fullName||"").split(/\s/g).indexOf(name):!1};Node.prototype.removeName=function(name){var names=
(this.name()||"").split(/\s/g);name=names.indexOf(name);-1!==name&&(names.splice(name,1),this.setName(names.join(" ")));return this};Node.prototype.setAttr=function(attr,val){var func=this["set"+Util_1.Util._capitalize(attr)];Util_1.Util._isFunction(func)?func.call(this,val):this._setAttr(attr,val);return this};Node.prototype._setAttr=function(key,val){var oldVal=this.attrs[key];if(oldVal!==val||Util_1.Util.isObject(val))void 0===val||null===val?delete this.attrs[key]:this.attrs[key]=val,this._fireChangeEvent(key,
oldVal,val)};Node.prototype._setComponentAttr=function(key,component,val){var oldVal;void 0!==val&&((oldVal=this.attrs[key])||(this.attrs[key]=this.getAttr(key)),this.attrs[key][component]=val,this._fireChangeEvent(key,oldVal,val))};Node.prototype._fireAndBubble=function(eventType,evt,compareShape){evt&&"Shape"===this.nodeType&&(evt.target=this);if("mouseenter"!==eventType&&"mouseleave"!==eventType||!(compareShape&&(this===compareShape||this.isAncestorOf&&this.isAncestorOf(compareShape))||"Stage"===
this.nodeType&&!compareShape)){this._fire(eventType,evt);var stopBubble=("mouseenter"===eventType||"mouseleave"===eventType)&&compareShape&&compareShape.isAncestorOf&&compareShape.isAncestorOf(this)&&!compareShape.isAncestorOf(this.parent);(evt&&!evt.cancelBubble||!evt)&&this.parent&&this.parent.isListening()&&!stopBubble&&(compareShape&&compareShape.parent?this._fireAndBubble.call(this.parent,eventType,evt,compareShape.parent):this._fireAndBubble.call(this.parent,eventType,evt))}};Node.prototype._fire=
function(eventType,evt){var events=this.eventListeners[eventType];if(events)for(evt=evt||{},evt.currentTarget=this,evt.type=eventType,eventType=0;eventType<events.length;eventType++)events[eventType].handler.call(this,evt)};Node.prototype.draw=function(){this.drawScene();this.drawHit();return this};Node.prototype._createDragElement=function(evt){evt=evt?evt.pointerId:void 0;var stage=this.getStage(),ap=this.getAbsolutePosition();stage=stage._getPointerById(evt)||stage._changedPointerPositions[0]||
ap;DragAndDrop_1.DD._dragElements.set(this._id,{node:this,startPointerPos:stage,offset:{x:stage.x-ap.x,y:stage.y-ap.y},dragStatus:"ready",pointerId:evt})};Node.prototype.startDrag=function(evt){DragAndDrop_1.DD._dragElements.has(this._id)||this._createDragElement(evt);DragAndDrop_1.DD._dragElements.get(this._id).dragStatus="dragging";this.fire("dragstart",{type:"dragstart",target:this,evt:evt&&evt.evt},!0)};Node.prototype._setDragPosition=function(evt,elem){var pos=this.getStage()._getPointerById(elem.pointerId),
dbf=this.dragBoundFunc();pos&&(elem={x:pos.x-elem.offset.x,y:pos.y-elem.offset.y},void 0!==dbf&&(elem=dbf.call(this,elem,evt)),this._lastPos&&this._lastPos.x===elem.x&&this._lastPos.y===elem.y||(this.setAbsolutePosition(elem),this.getLayer()?this.getLayer().batchDraw():this.getStage()&&this.getStage().batchDraw()),this._lastPos=elem)};Node.prototype.stopDrag=function(evt){var elem=DragAndDrop_1.DD._dragElements.get(this._id);elem&&(elem.dragStatus="stopped");DragAndDrop_1.DD._endDragBefore(evt);DragAndDrop_1.DD._endDragAfter(evt)};
Node.prototype.setDraggable=function(draggable){this._setAttr("draggable",draggable);this._dragChange()};Node.prototype.isDragging=function(){var elem=DragAndDrop_1.DD._dragElements.get(this._id);return elem?"dragging"===elem.dragStatus:!1};Node.prototype._listenDrag=function(){this._dragCleanup();this.on("mousedown.konva touchstart.konva",function(evt){var _this=this;if((void 0===evt.evt.button||0<=Global_1.Konva.dragButtons.indexOf(evt.evt.button))&&!this.isDragging()){var hasDraggingChild=!1;DragAndDrop_1.DD._dragElements.forEach(function(elem){_this.isAncestorOf(elem.node)&&
(hasDraggingChild=!0)});hasDraggingChild||this._createDragElement(evt)}})};Node.prototype._dragChange=function(){this.attrs.draggable?this._listenDrag():(this._dragCleanup(),this.getStage()&&DragAndDrop_1.DD._dragElements.has(this._id)&&this.stopDrag())};Node.prototype._dragCleanup=function(){this.off("mousedown.konva");this.off("touchstart.konva")};Node.create=function(data,container){Util_1.Util._isString(data)&&(data=JSON.parse(data));return this._createNode(data,container)};Node._createNode=function(obj,
container){var className=Node.prototype.getClassName.call(obj),children=obj.children;container&&(obj.attrs.container=container);Global_1._NODES_REGISTRY[className]||(Util_1.Util.warn('Can not find a node with class name "'+className+'". Fallback to "Shape".'),className="Shape");obj=new Global_1._NODES_REGISTRY[className](obj.attrs);if(children)for(container=children.length,className=0;className<container;className++)obj.add(Node._createNode(children[className]));return obj};return Node}();exports.Node=
module;module.prototype.nodeType="Node";module.prototype._attrsAffectingSize=[];global.Factory.addGetterSetter(module,"zIndex");global.Factory.addGetterSetter(module,"absolutePosition");global.Factory.addGetterSetter(module,"position");global.Factory.addGetterSetter(module,"x",0,require.getNumberValidator());global.Factory.addGetterSetter(module,"y",0,require.getNumberValidator());global.Factory.addGetterSetter(module,"globalCompositeOperation","source-over",require.getStringValidator());global.Factory.addGetterSetter(module,
"opacity",1,require.getNumberValidator());global.Factory.addGetterSetter(module,"name","",require.getStringValidator());global.Factory.addGetterSetter(module,"id","",require.getStringValidator());global.Factory.addGetterSetter(module,"rotation",0,require.getNumberValidator());global.Factory.addComponentsGetterSetter(module,"scale",["x","y"]);global.Factory.addGetterSetter(module,"scaleX",1,require.getNumberValidator());global.Factory.addGetterSetter(module,"scaleY",1,require.getNumberValidator());
global.Factory.addComponentsGetterSetter(module,"skew",["x","y"]);global.Factory.addGetterSetter(module,"skewX",0,require.getNumberValidator());global.Factory.addGetterSetter(module,"skewY",0,require.getNumberValidator());global.Factory.addComponentsGetterSetter(module,"offset",["x","y"]);global.Factory.addGetterSetter(module,"offsetX",0,require.getNumberValidator());global.Factory.addGetterSetter(module,"offsetY",0,require.getNumberValidator());global.Factory.addGetterSetter(module,"dragDistance",
null,require.getNumberValidator());global.Factory.addGetterSetter(module,"width",0,require.getNumberValidator());global.Factory.addGetterSetter(module,"height",0,require.getNumberValidator());global.Factory.addGetterSetter(module,"listening","inherit",function(val){!0!==val&&!1!==val&&"inherit"!==val&&Util_1.Util.warn(val+' is a not valid value for "listening" attribute. The value may be true, false or "inherit".');return val});global.Factory.addGetterSetter(module,"preventDefault",!0,require.getBooleanValidator());
global.Factory.addGetterSetter(module,"filters",null,function(val){this._filterUpToDate=!1;return val});global.Factory.addGetterSetter(module,"visible","inherit",function(val){!0!==val&&!1!==val&&"inherit"!==val&&Util_1.Util.warn(val+' is a not valid value for "visible" attribute. The value may be true, false or "inherit".');return val});global.Factory.addGetterSetter(module,"transformsEnabled","all",require.getStringValidator());global.Factory.addGetterSetter(module,"size");global.Factory.addGetterSetter(module,
"dragBoundFunc");global.Factory.addGetterSetter(module,"draggable",!1,require.getBooleanValidator());global.Factory.backCompat(module,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"});Util_1.Collection.mapMethods(module)}
//# sourceMappingURL=module$node_modules$konva$lib$Node.js.map
