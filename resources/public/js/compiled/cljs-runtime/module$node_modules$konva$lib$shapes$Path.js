shadow$provide.module$node_modules$konva$lib$shapes$Path=function(global,require,module,exports){var __extends=this&&this.__extends||function(){var extendStatics=function(d$jscomp$0,b$jscomp$0){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b){d.__proto__=b}||function(d,b){for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p])};return extendStatics(d$jscomp$0,b$jscomp$0)};return function(d,b){function __(){this.constructor=d}extendStatics(d,b);d.prototype=null===b?Object.create(b):
(__.prototype=b.prototype,new __)}}();Object.defineProperty(exports,"__esModule",{value:!0});global=require("module$node_modules$konva$lib$Util");module=require("module$node_modules$konva$lib$Factory");var Shape_1=require("module$node_modules$konva$lib$Shape");require=require("module$node_modules$konva$lib$Global");Shape_1=function(_super){function Path(config){config=_super.call(this,config)||this;config.dataArray=[];config.pathLength=0;config.dataArray=Path.parsePathData(config.data());for(var i$jscomp$0=
config.pathLength=0;i$jscomp$0<config.dataArray.length;++i$jscomp$0)config.pathLength+=config.dataArray[i$jscomp$0].pathLength;config.on("dataChange.konva",function(){this.dataArray=Path.parsePathData(this.data());for(var i=this.pathLength=0;i<this.dataArray.length;++i)this.pathLength+=this.dataArray[i].pathLength});return config}__extends(Path,_super);Path.prototype._sceneFunc=function(context){var ca=this.dataArray;context.beginPath();for(var n=0;n<ca.length;n++){var p=ca[n].points;switch(ca[n].command){case "L":context.lineTo(p[0],
p[1]);break;case "M":context.moveTo(p[0],p[1]);break;case "C":context.bezierCurveTo(p[0],p[1],p[2],p[3],p[4],p[5]);break;case "Q":context.quadraticCurveTo(p[0],p[1],p[2],p[3]);break;case "A":var cx=p[0],cy=p[1],rx=p[2],ry=p[3],theta=p[4],dTheta=p[5],psi=p[6];p=p[7];var r=rx>ry?rx:ry,scaleX=rx>ry?1:rx/ry;rx=rx>ry?ry/rx:1;context.translate(cx,cy);context.rotate(psi);context.scale(scaleX,rx);context.arc(0,0,r,theta,theta+dTheta,1-p);context.scale(1/scaleX,1/rx);context.rotate(-psi);context.translate(-cx,
-cy);break;case "z":context.closePath()}}context.fillStrokeShape(this)};Path.prototype.getSelfRect=function(){var points=[];this.dataArray.forEach(function(data){points=points.concat(data.points)});for(var minX=points[0],maxX=points[0],minY=points[1],maxY=points[1],x,y,i=0;i<points.length/2;i++)x=points[2*i],y=points[2*i+1],isNaN(x)||(minX=Math.min(minX,x),maxX=Math.max(maxX,x)),isNaN(y)||(minY=Math.min(minY,y),maxY=Math.max(maxY,y));return{x:Math.round(minX),y:Math.round(minY),width:Math.round(maxX-
minX),height:Math.round(maxY-minY)}};Path.prototype.getLength=function(){return this.pathLength};Path.prototype.getPointAtLength=function(length){var i=0,ii=this.dataArray.length;if(!ii)return null;for(;i<ii&&length>this.dataArray[i].pathLength;)length-=this.dataArray[i].pathLength,++i;if(i===ii)return length=this.dataArray[i-1].points.slice(-2),{x:length[0],y:length[1]};if(.01>length)return length=this.dataArray[i].points.slice(0,2),{x:length[0],y:length[1]};i=this.dataArray[i];ii=i.points;switch(i.command){case "L":return Path.getPointOnLine(length,
i.start.x,i.start.y,ii[0],ii[1]);case "C":return Path.getPointOnCubicBezier(length/i.pathLength,i.start.x,i.start.y,ii[0],ii[1],ii[2],ii[3],ii[4],ii[5]);case "Q":return Path.getPointOnQuadraticBezier(length/i.pathLength,i.start.x,i.start.y,ii[0],ii[1],ii[2],ii[3]);case "A":var cx=ii[0],cy=ii[1],rx=ii[2],ry=ii[3],theta=ii[4],psi=ii[6];theta+=ii[5]*length/i.pathLength;return Path.getPointOnEllipticalArc(cx,cy,rx,ry,theta,psi)}return null};Path.getLineLength=function(x1,y1,x2,y2){return Math.sqrt((x2-
x1)*(x2-x1)+(y2-y1)*(y2-y1))};Path.getPointOnLine=function(dist,P1x,P1y,P2x,P2y,fromX,fromY){void 0===fromX&&(fromX=P1x);void 0===fromY&&(fromY=P1y);var m=(P2y-P1y)/(P2x-P1x+1E-8),run=Math.sqrt(dist*dist/(1+m*m));P2x<P1x&&(run*=-1);var rise=m*run;if(P2x===P1x)P1x={x:fromX,y:fromY+rise};else if((fromY-P1y)/(fromX-P1x+1E-8)===m)P1x={x:fromX+run,y:fromY+rise};else{rise=this.getLineLength(P1x,P1y,P2x,P2y);if(1E-8>rise)return;run=((fromX-P1x)*(P2x-P1x)+(fromY-P1y)*(P2y-P1y))/(rise*rise);rise=P1x+run*(P2x-
P1x);P1y+=run*(P2y-P1y);fromX=this.getLineLength(fromX,fromY,rise,P1y);dist=Math.sqrt(dist*dist-fromX*fromX);run=Math.sqrt(dist*dist/(1+m*m));P2x<P1x&&(run*=-1);P1x={x:rise+run,y:P1y+m*run}}return P1x};Path.getPointOnCubicBezier=function(pct,P1x,P1y,P2x,P2y,P3x,P3y,P4x,P4y){return{x:P4x*pct*pct*pct+3*P3x*pct*pct*(1-pct)+3*P2x*pct*(1-pct)*(1-pct)+P1x*(1-pct)*(1-pct)*(1-pct),y:P4y*pct*pct*pct+3*P3y*pct*pct*(1-pct)+3*P2y*pct*(1-pct)*(1-pct)+P1y*(1-pct)*(1-pct)*(1-pct)}};Path.getPointOnQuadraticBezier=
function(pct,P1x,P1y,P2x,P2y,P3x,P3y){return{x:P3x*pct*pct+2*P2x*pct*(1-pct)+P1x*(1-pct)*(1-pct),y:P3y*pct*pct+2*P2y*pct*(1-pct)+P1y*(1-pct)*(1-pct)}};Path.getPointOnEllipticalArc=function(cx,cy,rx,ry,theta,psi){var cosPsi=Math.cos(psi);psi=Math.sin(psi);rx*=Math.cos(theta);ry*=Math.sin(theta);return{x:cx+(rx*cosPsi-ry*psi),y:cy+(rx*psi+ry*cosPsi)}};Path.parsePathData=function(data){if(!data)return[];var cc="mMlLvVhHzZcCqQtTsSaA".split("");var cs=data.replace(/ /g,",");for(data=0;data<cc.length;data++)cs=
cs.replace(new RegExp(cc[data],"g"),"|"+cc[data]);cc=cs.split("|");cs=[];var coords=[],cpx=0,cpy=0,re=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,match;for(data=1;data<cc.length;data++){var str=cc[data],c=str.charAt(0);str=str.slice(1);for(coords.length=0;match=re.exec(str);)coords.push(match[0]);match=[];str=0;for(var jlen=coords.length;str<jlen;str++){var parsed=parseFloat(coords[str]);isNaN(parsed)?match.push(0):match.push(parsed)}for(;0<match.length&&!isNaN(match[0]);){parsed=null;var points=
[];str=cpx;jlen=cpy;var ctlPty;switch(c){case "l":cpx+=match.shift();cpy+=match.shift();parsed="L";points.push(cpx,cpy);break;case "L":cpx=match.shift();cpy=match.shift();points.push(cpx,cpy);break;case "m":c=match.shift();var ctlPtx=match.shift();cpx+=c;cpy+=ctlPtx;parsed="M";if(2<cs.length&&"z"===cs[cs.length-1].command)for(ctlPty=cs.length-2;0<=ctlPty;ctlPty--)if("M"===cs[ctlPty].command){cpx=cs[ctlPty].points[0]+c;cpy=cs[ctlPty].points[1]+ctlPtx;break}points.push(cpx,cpy);c="l";break;case "M":cpx=
match.shift();cpy=match.shift();parsed="M";points.push(cpx,cpy);c="L";break;case "h":cpx+=match.shift();parsed="L";points.push(cpx,cpy);break;case "H":cpx=match.shift();parsed="L";points.push(cpx,cpy);break;case "v":cpy+=match.shift();parsed="L";points.push(cpx,cpy);break;case "V":cpy=match.shift();parsed="L";points.push(cpx,cpy);break;case "C":points.push(match.shift(),match.shift(),match.shift(),match.shift());cpx=match.shift();cpy=match.shift();points.push(cpx,cpy);break;case "c":points.push(cpx+
match.shift(),cpy+match.shift(),cpx+match.shift(),cpy+match.shift());cpx+=match.shift();cpy+=match.shift();parsed="C";points.push(cpx,cpy);break;case "S":ctlPtx=cpx;ctlPty=cpy;parsed=cs[cs.length-1];"C"===parsed.command&&(ctlPtx=cpx+(cpx-parsed.points[2]),ctlPty=cpy+(cpy-parsed.points[3]));points.push(ctlPtx,ctlPty,match.shift(),match.shift());cpx=match.shift();cpy=match.shift();parsed="C";points.push(cpx,cpy);break;case "s":ctlPtx=cpx;ctlPty=cpy;parsed=cs[cs.length-1];"C"===parsed.command&&(ctlPtx=
cpx+(cpx-parsed.points[2]),ctlPty=cpy+(cpy-parsed.points[3]));points.push(ctlPtx,ctlPty,cpx+match.shift(),cpy+match.shift());cpx+=match.shift();cpy+=match.shift();parsed="C";points.push(cpx,cpy);break;case "Q":points.push(match.shift(),match.shift());cpx=match.shift();cpy=match.shift();points.push(cpx,cpy);break;case "q":points.push(cpx+match.shift(),cpy+match.shift());cpx+=match.shift();cpy+=match.shift();parsed="Q";points.push(cpx,cpy);break;case "T":ctlPtx=cpx;ctlPty=cpy;parsed=cs[cs.length-1];
"Q"===parsed.command&&(ctlPtx=cpx+(cpx-parsed.points[0]),ctlPty=cpy+(cpy-parsed.points[1]));cpx=match.shift();cpy=match.shift();parsed="Q";points.push(ctlPtx,ctlPty,cpx,cpy);break;case "t":ctlPtx=cpx;ctlPty=cpy;parsed=cs[cs.length-1];"Q"===parsed.command&&(ctlPtx=cpx+(cpx-parsed.points[0]),ctlPty=cpy+(cpy-parsed.points[1]));cpx+=match.shift();cpy+=match.shift();parsed="Q";points.push(ctlPtx,ctlPty,cpx,cpy);break;case "A":points=match.shift();ctlPtx=match.shift();ctlPty=match.shift();var fa=match.shift();
var fs=match.shift();var x1=cpx;var y1=cpy;cpx=match.shift();cpy=match.shift();parsed="A";points=this.convertEndpointToCenterParameterization(x1,y1,cpx,cpy,fa,fs,points,ctlPtx,ctlPty);break;case "a":points=match.shift(),ctlPtx=match.shift(),ctlPty=match.shift(),fa=match.shift(),fs=match.shift(),x1=cpx,y1=cpy,cpx+=match.shift(),cpy+=match.shift(),parsed="A",points=this.convertEndpointToCenterParameterization(x1,y1,cpx,cpy,fa,fs,points,ctlPtx,ctlPty)}cs.push({command:parsed||c,points:points,start:{x:str,
y:jlen},pathLength:this.calcLength(str,jlen,parsed||c,points)})}"z"!==c&&"Z"!==c||cs.push({command:"z",points:[],start:void 0,pathLength:0})}return cs};Path.calcLength=function(x,y,cmd,points){var t;switch(cmd){case "L":return Path.getLineLength(x,y,points[0],points[1]);case "C":cmd=0;var p1=Path.getPointOnCubicBezier(0,x,y,points[0],points[1],points[2],points[3],points[4],points[5]);for(t=.01;1>=t;t+=.01){var p2=Path.getPointOnCubicBezier(t,x,y,points[0],points[1],points[2],points[3],points[4],points[5]);
cmd+=Path.getLineLength(p1.x,p1.y,p2.x,p2.y);p1=p2}return cmd;case "Q":cmd=0;p1=Path.getPointOnQuadraticBezier(0,x,y,points[0],points[1],points[2],points[3]);for(t=.01;1>=t;t+=.01)p2=Path.getPointOnQuadraticBezier(t,x,y,points[0],points[1],points[2],points[3]),cmd+=Path.getLineLength(p1.x,p1.y,p2.x,p2.y),p1=p2;return cmd;case "A":cmd=0;p2=points[4];t=points[5];x=points[4]+t;y=Math.PI/180;Math.abs(p2-x)<y&&(y=Math.abs(p2-x));p1=Path.getPointOnEllipticalArc(points[0],points[1],points[2],points[3],p2,
0);if(0>t)for(t=p2-y;t>x;t-=y)p2=Path.getPointOnEllipticalArc(points[0],points[1],points[2],points[3],t,0),cmd+=Path.getLineLength(p1.x,p1.y,p2.x,p2.y),p1=p2;else for(t=p2+y;t<x;t+=y)p2=Path.getPointOnEllipticalArc(points[0],points[1],points[2],points[3],t,0),cmd+=Path.getLineLength(p1.x,p1.y,p2.x,p2.y),p1=p2;p2=Path.getPointOnEllipticalArc(points[0],points[1],points[2],points[3],x,0);return cmd+=Path.getLineLength(p1.x,p1.y,p2.x,p2.y)}return 0};Path.convertEndpointToCenterParameterization=function(x1,
y1,x2,y2,fa,fs,rx,ry,psiDeg){psiDeg*=Math.PI/180;var xp=Math.cos(psiDeg)*(x1-x2)/2+Math.sin(psiDeg)*(y1-y2)/2,yp=-1*Math.sin(psiDeg)*(x1-x2)/2+Math.cos(psiDeg)*(y1-y2)/2,lambda=xp*xp/(rx*rx)+yp*yp/(ry*ry);1<lambda&&(rx*=Math.sqrt(lambda),ry*=Math.sqrt(lambda));lambda=Math.sqrt((rx*rx*ry*ry-rx*rx*yp*yp-ry*ry*xp*xp)/(rx*rx*yp*yp+ry*ry*xp*xp));fa===fs&&(lambda*=-1);isNaN(lambda)&&(lambda=0);fa=lambda*rx*yp/ry;lambda=lambda*-ry*xp/rx;x1=(x1+x2)/2+Math.cos(psiDeg)*fa-Math.sin(psiDeg)*lambda;y1=(y1+y2)/
2+Math.sin(psiDeg)*fa+Math.cos(psiDeg)*lambda;var vRatio=function(u,v){return(u[0]*v[0]+u[1]*v[1])/(Math.sqrt(u[0]*u[0]+u[1]*u[1])*Math.sqrt(v[0]*v[0]+v[1]*v[1]))},vAngle=function(u,v){return(u[0]*v[1]<u[1]*v[0]?-1:1)*Math.acos(vRatio(u,v))};y2=vAngle([1,0],[(xp-fa)/rx,(yp-lambda)/ry]);x2=[(xp-fa)/rx,(yp-lambda)/ry];xp=[(-1*xp-fa)/rx,(-1*yp-lambda)/ry];yp=vAngle(x2,xp);-1>=vRatio(x2,xp)&&(yp=Math.PI);1<=vRatio(x2,xp)&&(yp=0);0===fs&&0<yp&&(yp-=2*Math.PI);1===fs&&0>yp&&(yp+=2*Math.PI);return[x1,y1,
rx,ry,y2,yp,psiDeg,fs]};return Path}(Shape_1.Shape);exports.Path=Shape_1;Shape_1.prototype.className="Path";Shape_1.prototype._attrsAffectingSize=["data"];require._registerNode(Shape_1);module.Factory.addGetterSetter(Shape_1,"data");global.Collection.mapMethods(Shape_1)}
//# sourceMappingURL=module$node_modules$konva$lib$shapes$Path.js.map
